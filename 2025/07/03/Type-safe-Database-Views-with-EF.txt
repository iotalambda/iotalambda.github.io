1:HL["/_next/static/media/583a894d7b920fb7-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/e807dee2426166ad-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/css/628175db981e71d1.css",{"as":"style"}]
0:["EN5UhbQRznfrkzMi4y6PP",[[["",{"children":[["id","2025/07/03/Type-safe-Database-Views-with-EF","c"],{"children":["__PAGE__?{\"id\":[\"2025\",\"07\",\"03\",\"Type-safe-Database-Views-with-EF\"]}",{}]}]},"$undefined","$undefined",true],"$L4",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/628175db981e71d1.css","precedence":"next"}]],"$L5"]]]]
6:HL["/_next/static/css/301e7291452e98cd.css",{"as":"style"}]
7:I{"id":6685,"chunks":["685:static/chunks/685-a8c11ad368fada34.js","185:static/chunks/app/layout-2e1bbcbb1be95a7d.js"],"name":"","async":false}
8:I{"id":7767,"chunks":["272:static/chunks/webpack-cf90cbaabf0d0d8b.js","971:static/chunks/fd9d1056-a99b58d3cc150217.js","596:static/chunks/596-9d43875837bd0b65.js"],"name":"default","async":false}
9:I{"id":7920,"chunks":["272:static/chunks/webpack-cf90cbaabf0d0d8b.js","971:static/chunks/fd9d1056-a99b58d3cc150217.js","596:static/chunks/596-9d43875837bd0b65.js"],"name":"default","async":false}
4:[null,["$","html",null,{"lang":"en","className":"__variable_eb9fb7 __variable_2fad4c","children":["$","body",null,{"className":"bg-slate-200 dark:bg-slate-700","children":[["$","nav",null,{"className":"w-full flex flex-row justify-between bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans","children":["$","div",null,{"className":"p-2","children":["$","$L7",null,{"className":"text-2xl font-semibold text-neutral-100 dark:text-neutral-200","href":"/","children":[["$","h1",null,{"className":"inline","children":"üçî food for ai"}]," ",["$","span",null,{"className":"font-mono font-light text-xs","children":"food.joona.cloud"}]]}]}]}],["$","main",null,{"className":"mt-4","children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children",["id","2025/07/03/Type-safe-Database-Views-with-EF","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La","$Lb",null],"segment":"__PAGE__?{\"id\":[\"2025\",\"07\",\"03\",\"Type-safe-Database-Views-with-EF\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/301e7291452e98cd.css","precedence":"next"}]]}],"segment":["id","2025/07/03/Type-safe-Database-Views-with-EF","c"]},"styles":[]}]}]]}]}],null]
5:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Type-safe Database Views with EF | Food for AI blog"}],["$","meta","2",{"name":"description","content":"Blog about .NET, Azure, React and whatever comes to mind."}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","5",{"name":"next-size-adjust"}]]
c:T3a29,<p>At times, it can be beneficial to have a stable, normalized view into the data in your database tables. For example, if you wish to synchronize your transaction data periodically to a reporting system, like Power BI, you might want to provide the synchronization process with limited but stable read access to your data. The simplest way to achieve this is <strong>views</strong>. Nowadays, views don't tend to get a lot of love, but this use case is definitely one where views still come in handy.</p>
<p>You can naturally manufacture and manage views completely manually, but this leaves room for DB migrations in the underlying tables attempting to make contradicting changes, and thus either the migrations fail or the views are left in a broken state. In the .NET world, Entity Framework is great for managing your tables code-first and running migrations, but it doesn't support views out-of-box. Luckily, it's not too hard to implement basic support for having managed views as well. EF has the awesome capability to translate .NET expressions to SQL, and we can leverage this capability.</p>
<p>Let's say we have a <code>DbContext</code> with the following entities: <code>Order</code>s, <code>OrderRow</code>s and <code>Product</code>s, and we'd like to create a view that displays <code>OrderProduct</code>s with total prices of each ordered product of each order. The query would look something like this:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="c#" data-theme="light"><code data-language="c#" data-theme="light"><span class="line"><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #6F42C1">o</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ctx.Orders</span></span>
<span class="line"><span style="color: #D73A49">join</span><span style="color: #24292E"> </span><span style="color: #6F42C1">or</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ctx.OrderRows </span><span style="color: #D73A49">on</span><span style="color: #24292E"> o.Id </span><span style="color: #D73A49">equals</span><span style="color: #24292E"> or.OrderId</span></span>
<span class="line"><span style="color: #D73A49">join</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ctx.Products </span><span style="color: #D73A49">on</span><span style="color: #24292E"> or.ProductId </span><span style="color: #D73A49">equals</span><span style="color: #24292E"> p.Id</span></span>
<span class="line"><span style="color: #D73A49">select</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OrderProduct</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    OrderNumber </span><span style="color: #D73A49">=</span><span style="color: #24292E"> o.OrderNumber,</span></span>
<span class="line"><span style="color: #24292E">    EAN </span><span style="color: #D73A49">=</span><span style="color: #24292E"> or.Product</span><span style="color: #D73A49">!</span><span style="color: #24292E">.EAN,</span></span>
<span class="line"><span style="color: #24292E">    Amount </span><span style="color: #D73A49">=</span><span style="color: #24292E"> or.Amount,</span></span>
<span class="line"><span style="color: #24292E">    TotalPriceEur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> or.Amount </span><span style="color: #D73A49">*</span><span style="color: #24292E"> or.Product.PriceEur</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="c#" data-theme="dark"><code data-language="c#" data-theme="dark"><span class="line"><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">o</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> ctx.Orders</span></span>
<span class="line"><span style="color: #F97583">join</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">or</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> ctx.OrderRows </span><span style="color: #F97583">on</span><span style="color: #E1E4E8"> o.Id </span><span style="color: #F97583">equals</span><span style="color: #E1E4E8"> or.OrderId</span></span>
<span class="line"><span style="color: #F97583">join</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">p</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> ctx.Products </span><span style="color: #F97583">on</span><span style="color: #E1E4E8"> or.ProductId </span><span style="color: #F97583">equals</span><span style="color: #E1E4E8"> p.Id</span></span>
<span class="line"><span style="color: #F97583">select</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">OrderProduct</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    OrderNumber </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> o.OrderNumber,</span></span>
<span class="line"><span style="color: #E1E4E8">    EAN </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> or.Product</span><span style="color: #F97583">!</span><span style="color: #E1E4E8">.EAN,</span></span>
<span class="line"><span style="color: #E1E4E8">    Amount </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> or.Amount,</span></span>
<span class="line"><span style="color: #E1E4E8">    TotalPriceEur </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> or.Amount </span><span style="color: #F97583">*</span><span style="color: #E1E4E8"> or.Product.PriceEur</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>We can get the raw SQL of this query using <code>ToQueryString</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="c#" data-theme="light"><code data-language="c#" data-theme="light"><span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">orderProductsQuerySql</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span></span>
<span class="line"><span style="color: #24292E">    (</span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #6F42C1">o</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ctx.Orders</span></span>
<span class="line"><span style="color: #24292E">     </span><span style="color: #D73A49">join</span><span style="color: #24292E"> </span><span style="color: #6F42C1">or</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ctx.OrderRows </span><span style="color: #D73A49">on</span><span style="color: #24292E"> o.Id </span><span style="color: #D73A49">equals</span><span style="color: #24292E"> or.OrderId</span></span>
<span class="line"><span style="color: #24292E">     </span><span style="color: #D73A49">join</span><span style="color: #24292E"> </span><span style="color: #6F42C1">p</span><span style="color: #24292E"> </span><span style="color: #D73A49">in</span><span style="color: #24292E"> ctx.Products </span><span style="color: #D73A49">on</span><span style="color: #24292E"> or.ProductId </span><span style="color: #D73A49">equals</span><span style="color: #24292E"> p.Id</span></span>
<span class="line"><span style="color: #24292E">     </span><span style="color: #D73A49">select</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OrderProduct</span></span>
<span class="line"><span style="color: #24292E">     {</span></span>
<span class="line"><span style="color: #24292E">         OrderNumber </span><span style="color: #D73A49">=</span><span style="color: #24292E"> o.OrderNumber,</span></span>
<span class="line"><span style="color: #24292E">         EAN </span><span style="color: #D73A49">=</span><span style="color: #24292E"> or.Product</span><span style="color: #D73A49">!</span><span style="color: #24292E">.EAN,</span></span>
<span class="line"><span style="color: #24292E">         Amount </span><span style="color: #D73A49">=</span><span style="color: #24292E"> or.Amount,</span></span>
<span class="line"><span style="color: #24292E">         TotalPriceEur </span><span style="color: #D73A49">=</span><span style="color: #24292E"> or.Amount </span><span style="color: #D73A49">*</span><span style="color: #24292E"> or.Product.PriceEur</span></span>
<span class="line"><span style="color: #24292E">     }).</span><span style="color: #6F42C1">ToQueryString</span><span style="color: #24292E">();</span></span></code></pre><pre data-language="c#" data-theme="dark"><code data-language="c#" data-theme="dark"><span class="line"><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">orderProductsQuerySql</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span></span>
<span class="line"><span style="color: #E1E4E8">    (</span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">o</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> ctx.Orders</span></span>
<span class="line"><span style="color: #E1E4E8">     </span><span style="color: #F97583">join</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">or</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> ctx.OrderRows </span><span style="color: #F97583">on</span><span style="color: #E1E4E8"> o.Id </span><span style="color: #F97583">equals</span><span style="color: #E1E4E8"> or.OrderId</span></span>
<span class="line"><span style="color: #E1E4E8">     </span><span style="color: #F97583">join</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">p</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> ctx.Products </span><span style="color: #F97583">on</span><span style="color: #E1E4E8"> or.ProductId </span><span style="color: #F97583">equals</span><span style="color: #E1E4E8"> p.Id</span></span>
<span class="line"><span style="color: #E1E4E8">     </span><span style="color: #F97583">select</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">OrderProduct</span></span>
<span class="line"><span style="color: #E1E4E8">     {</span></span>
<span class="line"><span style="color: #E1E4E8">         OrderNumber </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> o.OrderNumber,</span></span>
<span class="line"><span style="color: #E1E4E8">         EAN </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> or.Product</span><span style="color: #F97583">!</span><span style="color: #E1E4E8">.EAN,</span></span>
<span class="line"><span style="color: #E1E4E8">         Amount </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> or.Amount,</span></span>
<span class="line"><span style="color: #E1E4E8">         TotalPriceEur </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> or.Amount </span><span style="color: #F97583">*</span><span style="color: #E1E4E8"> or.Product.PriceEur</span></span>
<span class="line"><span style="color: #E1E4E8">     }).</span><span style="color: #B392F0">ToQueryString</span><span style="color: #E1E4E8">();</span></span></code></pre></div>
<p>Then we can simply create the view using <code>ExecuteSqlRaw</code> and the SQL dialect of the RDBMS of our choice:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="c#" data-theme="light"><code data-language="c#" data-theme="light"><span class="line"><span style="color: #24292E">ctx.Database.</span><span style="color: #6F42C1">ExecuteSqlRaw</span><span style="color: #24292E">(</span><span style="color: #032F62">$"CREATE VIEW vwOrderProducts AS {</span><span style="color: #24292E">orderProductsQuerySql</span><span style="color: #032F62">}"</span><span style="color: #24292E">);</span></span></code></pre><pre data-language="c#" data-theme="dark"><code data-language="c#" data-theme="dark"><span class="line"><span style="color: #E1E4E8">ctx.Database.</span><span style="color: #B392F0">ExecuteSqlRaw</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">$"CREATE VIEW vwOrderProducts AS {</span><span style="color: #E1E4E8">orderProductsQuerySql</span><span style="color: #9ECBFF">}"</span><span style="color: #E1E4E8">);</span></span></code></pre></div>
<p>Finally, we can test that the view works as it should:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="c#" data-theme="light"><code data-language="c#" data-theme="light"><span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">orderProducts</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ctx.Database.</span><span style="color: #6F42C1">SqlQueryRaw</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">OrderProduct</span><span style="color: #24292E">>(</span><span style="color: #032F62">"SELECT * FROM vwOrderProducts"</span><span style="color: #24292E">);</span></span></code></pre><pre data-language="c#" data-theme="dark"><code data-language="c#" data-theme="dark"><span class="line"><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">orderProducts</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> ctx.Database.</span><span style="color: #B392F0">SqlQueryRaw</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">OrderProduct</span><span style="color: #E1E4E8">>(</span><span style="color: #9ECBFF">"SELECT * FROM vwOrderProducts"</span><span style="color: #E1E4E8">);</span></span></code></pre></div>
<p>And thus, we've created a view whose schema and query logic are guaranteed by the C# type system.</p>b:["$","div",null,{"className":"flex justify-center","children":["$","div",null,{"className":"md:px-10 min-w-0 max-w-7xl mb-12","children":["$","article",null,{"children":[["$","header",null,{"className":"px-5 mb-4 py-10 relative","children":[["$","h1",null,{"className":"text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100","children":"Type-safe Database Views with EF"}],["$","time",null,{"dateTime":"2025-07-03 16:00","className":"pl-1 font-serif text-slate-400 bottom-0 absolute","children":[["$","svg",null,{"className":"h-4 w-4 inline-block","width":"24","height":"24","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":"2","strokeLinecap":"round","strokeLinejoin":"round","children":[["$","path",null,{"d":"M12 19l7-7 3 3-7 7-3-3z"}]," ",["$","path",null,{"d":"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}]," ",["$","path",null,{"d":"M2 2l7.586 7.586"}]," ",["$","circle",null,{"cx":"11","cy":"11","r":"2"}]]}]," ","2025-07-03 16:00"]}]]}],["$","div",null,{"className":"bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg","children":[[["$","p",null,{"className":"italic text-slate-400 p-4","dangerouslySetInnerHTML":{"__html":"You can find the full code for the example discussed here in its <a href=\"https://github.com/iotalambda/EFCodeFirstCreateView\">Github repo</a>."}}],["$","hr",null,{"className":"h-px my-4 bg-gray-200 border-0 dark:bg-gray-700"}]],["$","div",null,{"className":"space-y-4","dangerouslySetInnerHTML":{"__html":"$c"}}]]}]]}]}]}]
a:null
