<!DOCTYPE html><html lang="en" class="__variable_eb9fb7 __variable_2fad4c"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="font" href="/_next/static/media/583a894d7b920fb7-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/e807dee2426166ad-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/cf6d346f04b2f900.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/4823b726c835f640.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-efd16f5debe934f5.js" as="script" fetchPriority="low"/><script src="/_next/static/chunks/fd9d1056-9200b628bfbdc6da.js" async=""></script><script src="/_next/static/chunks/596-98393ace57ba3968.js" async=""></script><script src="/_next/static/chunks/main-app-40cca1cf35ae5286.js" async=""></script><title>Fully Automated EasyAuth | Food for AI blog</title><meta name="description" content="Blog about .NET, Azure, React and whatever comes to mind."/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="bg-slate-200 dark:bg-slate-700"><nav class="w-full flex flex-row justify-between items-center bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans"><div class="p-2"><a class="text-2xl font-semibold text-neutral-100 dark:text-neutral-200" href="/"><h1 class="inline">üçî food for ai</h1> <span class="font-mono font-light text-xs">food.joona.cloud</span></a></div></nav><main class="mt-4"><div class="flex justify-center"><div class="md:px-10 min-w-0 max-w-7xl mb-12"><article><header class="px-5 mb-4 py-10 relative"><h1 class="text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100">Fully Automated EasyAuth</h1><time dateTime="2025-05-05 20:00" class="pl-1 font-serif text-slate-400 bottom-0 absolute"><svg class="h-4 w-4 inline-block" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path> <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path> <path d="M2 2l7.586 7.586"></path> <circle cx="11" cy="11" r="2"></circle></svg> <!-- -->2025-05-05 20:00</time></header><div class="bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg"><div class="space-y-4"><p>When setting up Entra authentication ‚Äî like configuring EasyAuth for App Services or Container Apps, or managing App Registrations and Enterprise Apps on the Entra side ‚Äî official tutorials generally lean heavily on manual clicking ("click-ops") in the Azure Portal. This article demonstrates how all such clicking can be avoided by scripting the whole thing.</p>
<p>In this article, Terraform is used for Infrastructure as Code (IaC), PowerShell for scripting, and GitHub Actions for pipelines, but achieving the same thing using Bicep, Bash, and Azure DevOps is equally straightforward.</p>
<p>The code examples presented are based on the "JavaCMS" toy project, whose source code is available in its <a href="https://github.com/iotalambda/javacms/commit/fe2256177a9ed3a8c844c09ae8e64571af430a06">GitHub repo</a>.</p>
<h2 id="entra-resources"><a href="#entra-resources">Entra resources</a></h2>
<p>An <code>az cli</code> heavy, <em>idempotent</em> script is first created to set up the Entra resources ‚Äî an App Registration and an Enterprise App. To begin, some variables are needed:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #6A737D"># The name of the App Registration shown in Azure Portal.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$appRegName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-app"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Key Vault instance in which secrets can be stored.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$keyVaultName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-dev-mgmt-kv"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Service Principal used by GitHub Actions.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$githubSpName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-github"</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #6A737D"># The name of the App Registration shown in Azure Portal.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$appRegName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-app"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Key Vault instance in which secrets can be stored.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$keyVaultName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-dev-mgmt-kv"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Service Principal used by GitHub Actions.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$githubSpName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-github"</span></span></code></pre></div>
<p>A hash-set for the <em>redirect URIs</em> is also needed, ensuring they're kept updated for the App Registration and preventing duplicates:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$redirectUris </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">@</span><span style="color: #24292E">{ </span><span style="color: #032F62">"http://localhost:3000/api/auth/callback/microsoft-entra-id"</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">$true</span><span style="color: #24292E"> }</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$redirectUris </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">@</span><span style="color: #E1E4E8">{ </span><span style="color: #9ECBFF">"http://localhost:3000/api/auth/callback/microsoft-entra-id"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">$true</span><span style="color: #E1E4E8"> }</span></span></code></pre></div>
<p>Note that the hash-set includes a localhost address, allowing Entra authentication to be used even when the app is running locally. If local support isn't needed, the array can remain empty.</p>
<p>To keep the script idempotent ‚Äî meaning running it multiple times always results in the same outcome ‚Äî it first needs to be checked whether an App Registration named <code>$appRegName</code> already exists. If it does, the existing one and its redirect URIs are reused; otherwise, a new one is created:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Checking if app registration exists..."</span></span>
<span class="line"><span style="color: #24292E">$existingAppRegDetails </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (az ad app list </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">ConvertFrom-Json</span><span style="color: #24292E">) </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.displayName </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegName</span><span style="color: #032F62">"</span><span style="color: #24292E"> }[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> ($existingAppRegDetails) {</span></span>
<span class="line"><span style="color: #24292E">    $appRegId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $existingAppRegDetails.appId</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"App registration exists. Extracting redirect uris..."</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ($existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">foreach</span><span style="color: #24292E"> ($uri </span><span style="color: #D73A49">in</span><span style="color: #24292E"> $existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6A737D"># NOTE: The hash-set approach is useful here, as it prevents duplication</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6A737D">#       of the initial localhost redirect URL.</span></span>
<span class="line"><span style="color: #24292E">            $redirectUris[$uri] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">$true</span><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Redirect uris extracted."</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"No redirect uris."</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"App registration doesn't exist. Creating app registration..."</span></span>
<span class="line"><span style="color: #24292E">    $appRegId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> az ad app create </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">display</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegName</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">query </span><span style="color: #032F62">"appId"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"tsv"</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"App registration created."</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Checking if app registration exists..."</span></span>
<span class="line"><span style="color: #E1E4E8">$existingAppRegDetails </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (az ad app list </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">ConvertFrom-Json</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.displayName </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> }[</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($existingAppRegDetails) {</span></span>
<span class="line"><span style="color: #E1E4E8">    $appRegId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> $existingAppRegDetails.appId</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"App registration exists. Extracting redirect uris..."</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">foreach</span><span style="color: #E1E4E8"> ($uri </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> $existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D"># NOTE: The hash-set approach is useful here, as it prevents duplication</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">#       of the initial localhost redirect URL.</span></span>
<span class="line"><span style="color: #E1E4E8">            $redirectUris[$uri] </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">$true</span><span style="color: #E1E4E8"> </span></span>
<span class="line"><span style="color: #E1E4E8">        }</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Redirect uris extracted."</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"No redirect uris."</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"App registration doesn't exist. Creating app registration..."</span></span>
<span class="line"><span style="color: #E1E4E8">    $appRegId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> az ad app create </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">display</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">query </span><span style="color: #9ECBFF">"appId"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"tsv"</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"App registration created."</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>The ID of the existing/created App Registration is also stored in the <code>$appRegId</code> variable.</p>
<p>Whether newly created or not, the App Registration is then ensured to have the correct redirect URIs:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Updating redirect uris..."</span></span>
<span class="line"><span style="color: #24292E">az ad app update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">web</span><span style="color: #D73A49">-</span><span style="color: #24292E">redirect</span><span style="color: #D73A49">-</span><span style="color: #24292E">uris $redirectUris.Keys </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Redirect uris updated."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Updating redirect uris..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">web</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">redirect</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">uris $redirectUris.Keys </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Redirect uris updated."</span></span></code></pre></div>
<p>An <em>Identifier URI</em> (<code>api://...</code>) must also be configured for the App Registration. This Identifier URI globally identifies the App Registration as a resource in OAuth flows:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding identifier URI..."</span></span>
<span class="line"><span style="color: #24292E">az ad app update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">identifier</span><span style="color: #D73A49">-</span><span style="color: #24292E">uris </span><span style="color: #032F62">"api://</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Identifier URI added."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding identifier URI..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">identifier</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">uris </span><span style="color: #9ECBFF">"api://</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Identifier URI added."</span></span></code></pre></div>
<p>Next, <em>ID token issuance</em> is enabled, allowing the App Registration to authenticate users and issue claims about them:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Enabling ID tokens..."</span></span>
<span class="line"><span style="color: #24292E">az ad app update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #005CC5">enable-id</span><span style="color: #D73A49">-</span><span style="color: #24292E">token</span><span style="color: #D73A49">-</span><span style="color: #24292E">issuance </span><span style="color: #032F62">"true"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"ID tokens enabled."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Enabling ID tokens..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #79B8FF">enable-id</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">token</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">issuance </span><span style="color: #9ECBFF">"true"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"ID tokens enabled."</span></span></code></pre></div>
<p>The <code>User.Read</code> permission must be configured for the App Registration. This allows the authentication flow to request the <code>User.Read</code> scope on behalf of the app, enabling access to the user's email address and other necessary claims. The current permission list of the App Registration is retrieved, and it is ensured that permission for that scope exists in an idempotent way:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Getting existing permissions..."</span></span>
<span class="line"><span style="color: #24292E">$existingPermissions </span><span style="color: #D73A49">=</span><span style="color: #24292E"> az ad app permission list </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">ConvertFrom-Json</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Existing permissions gotten."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">$graphApiAppId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"00000003-0000-0000-c000-000000000000"</span></span>
<span class="line"><span style="color: #24292E">$userReadResourceAccessId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"e1fe6dd8-ba31-4d61-89e7-88639da4683d"</span></span>
<span class="line"><span style="color: #24292E">$existingUserReadPermission </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $existingPermissions </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.resourceAppId </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> $graphApiAppId </span><span style="color: #D73A49">-and</span><span style="color: #24292E"> (</span><span style="color: #005CC5">$_</span><span style="color: #24292E">.resourceAccess </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.id </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> $userReadResourceAccessId }) }</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> ($existingUserReadPermission) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"User.Read permission exists."</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding User.Read permission..."</span></span>
<span class="line"><span style="color: #24292E">    az ad app permission add </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">api $graphApiAppId </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">api</span><span style="color: #D73A49">-</span><span style="color: #24292E">permissions </span><span style="color: #032F62">"</span><span style="color: #24292E">$userReadResourceAccessId</span><span style="color: #032F62">=Scope"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"User.Read permission added."</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Getting existing permissions..."</span></span>
<span class="line"><span style="color: #E1E4E8">$existingPermissions </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> az ad app permission list </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">ConvertFrom-Json</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Existing permissions gotten."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">$graphApiAppId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"00000003-0000-0000-c000-000000000000"</span></span>
<span class="line"><span style="color: #E1E4E8">$userReadResourceAccessId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"e1fe6dd8-ba31-4d61-89e7-88639da4683d"</span></span>
<span class="line"><span style="color: #E1E4E8">$existingUserReadPermission </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> $existingPermissions </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.resourceAppId </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> $graphApiAppId </span><span style="color: #F97583">-and</span><span style="color: #E1E4E8"> (</span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.resourceAccess </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.id </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> $userReadResourceAccessId }) }</span></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($existingUserReadPermission) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"User.Read permission exists."</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding User.Read permission..."</span></span>
<span class="line"><span style="color: #E1E4E8">    az ad app permission add </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">api $graphApiAppId </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">api</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">permissions </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$userReadResourceAccessId</span><span style="color: #9ECBFF">=Scope"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"User.Read permission added."</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>The value of <code>$userReadResourceAccessId</code> corresponds to <a href="https://learn.microsoft.com/en-us/graph/migrate-azure-ad-graph-permissions-differences#delegated-12">a "well-known" globally unique identifier of the delegated <code>User.Read</code> permission in Microsoft Graph</a>.</p>
<p>Since the example application's users belong to the current tenant, admin consent is granted to the App Registration:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Granting admin consent..."</span></span>
<span class="line"><span style="color: #24292E">az ad app permission admin</span><span style="color: #D73A49">-</span><span style="color: #24292E">consent </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Admin consent granted."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Granting admin consent..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app permission admin</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">consent </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Admin consent granted."</span></span></code></pre></div>
<p>Next, the Enterprise App is set up by creating one with the same ID as the App Registration:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Creating enterprise app..."</span></span>
<span class="line"><span style="color: #24292E">az ad sp create </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Enterprise app created."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Creating enterprise app..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad sp create </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Enterprise app created."</span></span></code></pre></div>
<p>The example application uses the Enterprise App‚Äôs <em>App Roles</em> for authorization. To enforce this, an assignment to an App Role is required:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Setting assignment required..."</span></span>
<span class="line"><span style="color: #24292E">az ad sp update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">set appRoleAssignmentRequired</span><span style="color: #D73A49">=</span><span style="color: #24292E">true </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Assignment set required."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Setting assignment required..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad sp update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">set appRoleAssignmentRequired</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">true </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Assignment set required."</span></span></code></pre></div>
<p>Later, when the application's infrastructure is set up in GitHub Actions, the Entra resources will need to be further configured using the GitHub Actions‚Äìassociated Service Principal. To grant sufficient privileges, ownership of the Enterprise App is assigned to this Service Principal. First, its Object ID is retrieved:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Getting github service principal object id..."</span></span>
<span class="line"><span style="color: #24292E">$githubSpObjectId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ((az ad sp list </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">ConvertFrom-Json</span><span style="color: #24292E">) </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.displayName </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$githubSpName</span><span style="color: #032F62">"</span><span style="color: #24292E"> })[</span><span style="color: #005CC5">0</span><span style="color: #24292E">].id</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Github service principal object id gotten."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Getting github service principal object id..."</span></span>
<span class="line"><span style="color: #E1E4E8">$githubSpObjectId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> ((az ad sp list </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">ConvertFrom-Json</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.displayName </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$githubSpName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> })[</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">].id</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Github service principal object id gotten."</span></span></code></pre></div>
<p>The Service Principal is then assigned as the owner of the Enterprise App:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding github service principal as the owner of the app..."</span></span>
<span class="line"><span style="color: #24292E">az ad app owner add </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">owner</span><span style="color: #D73A49">-</span><span style="color: #24292E">object</span><span style="color: #D73A49">-</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$githubSpObjectId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Github SP added as the owner of the app."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding github service principal as the owner of the app..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app owner add </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">owner</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">object</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$githubSpObjectId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Github SP added as the owner of the app."</span></span></code></pre></div>
<p>Finally, a <em>client secret</em> is created for the application to use when accessing the App Registration:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Creating client secret..."</span></span>
<span class="line"><span style="color: #24292E">$clientSecret </span><span style="color: #D73A49">=</span><span style="color: #24292E"> az ad app credential reset </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">display</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"client-secret"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">years </span><span style="color: #005CC5">2</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">query </span><span style="color: #032F62">"password"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"tsv"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Client secret created."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Creating client secret..."</span></span>
<span class="line"><span style="color: #E1E4E8">$clientSecret </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> az ad app credential reset </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">display</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"client-secret"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">years </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">query </span><span style="color: #9ECBFF">"password"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"tsv"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Client secret created."</span></span></code></pre></div>
<p>The <em>client secret</em> and the App Registration's <em>client ID</em> (which ‚Äî incidentally ‚Äî is equal to <code>$appRegId</code>) are stored in Key Vault, allowing easy synchronization with Azure based applications:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding client id to key vault..."</span></span>
<span class="line"><span style="color: #24292E">az keyvault secret set </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">vault</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"</span><span style="color: #24292E">$keyVaultName</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">name </span><span style="color: #032F62">"jcms-entra-clientid"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span><span style="color: #24292E"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">value </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Client id added to key vault."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding client secret to key vault..."</span></span>
<span class="line"><span style="color: #24292E">az keyvault secret set </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">vault</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"</span><span style="color: #24292E">$keyVaultName</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">name </span><span style="color: #032F62">"jcms-entra-clientsecret"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span><span style="color: #24292E"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">value </span><span style="color: #032F62">"</span><span style="color: #24292E">$clientSecret</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Client secret added to key vault."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding client id to key vault..."</span></span>
<span class="line"><span style="color: #E1E4E8">az keyvault secret set </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">vault</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$keyVaultName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"jcms-entra-clientid"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">value </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Client id added to key vault."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding client secret to key vault..."</span></span>
<span class="line"><span style="color: #E1E4E8">az keyvault secret set </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">vault</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$keyVaultName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"jcms-entra-clientsecret"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">value </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$clientSecret</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Client secret added to key vault."</span></span></code></pre></div>
<h2 id="iac"><a href="#iac">IaC</a></h2>
<p>The example application runs on Azure Container Apps, so next a Container App is created using Terraform (irrelevant parts removed for brevity):</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="light"><code data-language="hcl" data-theme="light"><span class="line"><span style="color: #6F42C1">resource</span><span style="color: #24292E"> </span><span style="color: #005CC5">"azurerm_container_app"</span><span style="color: #24292E"> </span><span style="color: #005CC5">"ca_jcmsui"</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">template</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">container</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">env</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        name</span><span style="color: #E36209">  </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"WEBSITE_AUTH_AAD_ALLOWED_TENANTS"</span></span>
<span class="line"><span style="color: #24292E">        value</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_client_config</span><span style="color: #D73A49">.</span><span style="color: #24292E">current</span><span style="color: #D73A49">.</span><span style="color: #24292E">tenant_id</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">secret</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    name</span><span style="color: #E36209">                </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #24292E">    key_vault_secret_id</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_key_vault_secret</span><span style="color: #D73A49">.</span><span style="color: #24292E">entra_clientsecret</span><span style="color: #D73A49">.</span><span style="color: #24292E">id</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="hcl" data-theme="dark"><code data-language="hcl" data-theme="dark"><span class="line"><span style="color: #B392F0">resource</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"azurerm_container_app"</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"ca_jcmsui"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">template</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">container</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #B392F0">env</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        name</span><span style="color: #FFAB70">  </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"WEBSITE_AUTH_AAD_ALLOWED_TENANTS"</span></span>
<span class="line"><span style="color: #E1E4E8">        value</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_client_config</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">current</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">tenant_id</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">secret</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    name</span><span style="color: #FFAB70">                </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #E1E4E8">    key_vault_secret_id</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_key_vault_secret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">entra_clientsecret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">id</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>The <code>WEBSITE_AUTH_AAD_ALLOWED_TENANTS</code> env variable is a standard setting for EasyAuth. In the example application, access is restricted to users of the current tenant. The client secret is also synchronized from Key Vault. Since the AzureRM Terraform provider does not (<em>naturally</em>) support configuring EasyAuth, it's hacked together using <code>azapi</code> and <code>null_resource</code>s instead. First, an <code>authConfigs</code> resource is created using <code>azapi</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="light"><code data-language="hcl" data-theme="light"><span class="line"><span style="color: #6F42C1">resource</span><span style="color: #24292E"> </span><span style="color: #005CC5">"azapi_resource"</span><span style="color: #24292E"> </span><span style="color: #005CC5">"auth_ca_jcmsui"</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  type</span><span style="color: #E36209">      </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"Microsoft.App/containerApps/authConfigs@2024-10-02-preview"</span></span>
<span class="line"><span style="color: #24292E">  name</span><span style="color: #E36209">      </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"current"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># This `authConfigs` resource is a child of the Container App.</span></span>
<span class="line"><span style="color: #24292E">  parent_id</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">azurerm_container_app</span><span style="color: #D73A49">.</span><span style="color: #24292E">ca_jcmsui</span><span style="color: #D73A49">.</span><span style="color: #24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  body</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    properties </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># The globalValidation section redirects any unauthorized users to the</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># Entra login page. The nice thing is that this process is handled entirely</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># by Azure-managed reverse proxies in front of Container Apps,</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># ensuring that unauthorized requests never reach the application itself.</span></span>
<span class="line"><span style="color: #24292E">      globalValidation </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        redirectToProvider          </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"azureActiveDirectory"</span></span>
<span class="line"><span style="color: #24292E">        unauthenticatedClientAction </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"RedirectToLoginPage"</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># Only a single identity provider, Entra, is configured.</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># The secret synchronized from Key Vault is also used here.</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># The current tenant's ID serves as the issuer, limiting access to </span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># (a subset of) users from the current tenant.</span></span>
<span class="line"><span style="color: #24292E">      identityProviders </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        azureActiveDirectory </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">          enabled </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span></span>
<span class="line"><span style="color: #24292E">          registration </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">            clientId                </span><span style="color: #D73A49">=</span><span style="color: #24292E"> data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #24292E">            clientSecretSettingName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #24292E">            openIdIssuer            </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"https://login.microsoftonline.com/</span><span style="color: #D73A49">${</span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_client_config</span><span style="color: #D73A49">.</span><span style="color: #24292E">current</span><span style="color: #D73A49">.</span><span style="color: #24292E">tenant_id</span><span style="color: #D73A49">}</span><span style="color: #032F62">/v2.0"</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">          validation </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">            defaultAuthorizationPolicy </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">              allowedApplications </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #6A737D"># This thing lets the App Registration to authorize</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #6A737D"># users to the application.</span></span>
<span class="line"><span style="color: #24292E">                data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #24292E">              ]</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="hcl" data-theme="dark"><code data-language="hcl" data-theme="dark"><span class="line"><span style="color: #B392F0">resource</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"azapi_resource"</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"auth_ca_jcmsui"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  type</span><span style="color: #FFAB70">      </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"Microsoft.App/containerApps/authConfigs@2024-10-02-preview"</span></span>
<span class="line"><span style="color: #E1E4E8">  name</span><span style="color: #FFAB70">      </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"current"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># This `authConfigs` resource is a child of the Container App.</span></span>
<span class="line"><span style="color: #E1E4E8">  parent_id</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">azurerm_container_app</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ca_jcmsui</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  body</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    properties </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># The globalValidation section redirects any unauthorized users to the</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># Entra login page. The nice thing is that this process is handled entirely</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># by Azure-managed reverse proxies in front of Container Apps,</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># ensuring that unauthorized requests never reach the application itself.</span></span>
<span class="line"><span style="color: #E1E4E8">      globalValidation </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        redirectToProvider          </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"azureActiveDirectory"</span></span>
<span class="line"><span style="color: #E1E4E8">        unauthenticatedClientAction </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"RedirectToLoginPage"</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># Only a single identity provider, Entra, is configured.</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># The secret synchronized from Key Vault is also used here.</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># The current tenant's ID serves as the issuer, limiting access to </span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># (a subset of) users from the current tenant.</span></span>
<span class="line"><span style="color: #E1E4E8">      identityProviders </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        azureActiveDirectory </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">          enabled </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">true</span></span>
<span class="line"><span style="color: #E1E4E8">          registration </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">            clientId                </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #E1E4E8">            clientSecretSettingName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #E1E4E8">            openIdIssuer            </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"https://login.microsoftonline.com/</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_client_config</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">current</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">tenant_id</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">/v2.0"</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">          validation </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">            defaultAuthorizationPolicy </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">              allowedApplications </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> [</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #6A737D"># This thing lets the App Registration to authorize</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #6A737D"># users to the application.</span></span>
<span class="line"><span style="color: #E1E4E8">                data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #E1E4E8">              ]</span></span>
<span class="line"><span style="color: #E1E4E8">            }</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">        }</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>Finally, the App Registration's redirect URIs are updated (in case the <code>authConfigs</code> resource was created or recreated), using the same hash-set approach as before. This time, the actual Container App's EasyAuth AAD redirect URI is enforced instead of the localhost one. Note that at this stage, the GitHub Actions‚Äìassociated Service Principal requires owner privileges:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="light"><code data-language="hcl" data-theme="light"><span class="line"><span style="color: #6F42C1">resource</span><span style="color: #24292E"> </span><span style="color: #005CC5">"null_resource"</span><span style="color: #24292E"> </span><span style="color: #005CC5">"app_redirect_uris"</span><span style="color: #24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># This lifecycle ensures that the redirect URIs are updated in the </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># App Registration only when necessary ‚Äî that is, when the Container App </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># is (re-)created and receives a new external ingress URL.</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">lifecycle</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    replace_triggered_by</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">[azurerm_container_app</span><span style="color: #D73A49">.</span><span style="color: #24292E">ca_jcmsui]</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  triggers</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    command </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&#x3C;&#x3C;-EOT</span></span>
<span class="line"><span style="color: #032F62">      $redirectUris = @{ "https://</span><span style="color: #D73A49">${</span><span style="color: #24292E">azurerm_container_app</span><span style="color: #D73A49">.</span><span style="color: #24292E">ca_jcmsui</span><span style="color: #D73A49">.</span><span style="color: #24292E">ingress</span><span style="color: #032F62">[</span><span style="color: #005CC5">0</span><span style="color: #032F62">]</span><span style="color: #D73A49">.</span><span style="color: #24292E">fqdn</span><span style="color: #D73A49">}</span><span style="color: #032F62">/.auth/login/aad/callback" = $true }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">      $appRegDetails = (az ad app show --id "</span><span style="color: #D73A49">${</span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_key_vault_secret</span><span style="color: #D73A49">.</span><span style="color: #24292E">entra_clientid</span><span style="color: #D73A49">.</span><span style="color: #24292E">value</span><span style="color: #D73A49">}</span><span style="color: #032F62">" | ConvertFrom-Json)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">      foreach ($uri in $appRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #032F62">        $redirectUris[$uri] = $true</span></span>
<span class="line"><span style="color: #032F62">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">      az ad app update `</span></span>
<span class="line"><span style="color: #032F62">        --id "</span><span style="color: #D73A49">${</span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_key_vault_secret</span><span style="color: #D73A49">.</span><span style="color: #24292E">entra_clientid</span><span style="color: #D73A49">.</span><span style="color: #24292E">value</span><span style="color: #D73A49">}</span><span style="color: #032F62">" `</span></span>
<span class="line"><span style="color: #032F62">        --web-redirect-uris $redirectUris.Keys `</span></span>
<span class="line"><span style="color: #032F62">        --output "none"</span></span>
<span class="line"><span style="color: #D73A49">    EOT</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">provisioner</span><span style="color: #24292E"> </span><span style="color: #005CC5">"local-exec"</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    command</span><span style="color: #E36209">     </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">self</span><span style="color: #D73A49">.</span><span style="color: #24292E">triggers</span><span style="color: #D73A49">.</span><span style="color: #24292E">command</span></span>
<span class="line"><span style="color: #24292E">    interpreter</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">[</span><span style="color: #032F62">"pwsh"</span><span style="color: #24292E">, </span><span style="color: #032F62">"-Command"</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="hcl" data-theme="dark"><code data-language="hcl" data-theme="dark"><span class="line"><span style="color: #B392F0">resource</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"null_resource"</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"app_redirect_uris"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># This lifecycle ensures that the redirect URIs are updated in the </span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># App Registration only when necessary ‚Äî that is, when the Container App </span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># is (re-)created and receives a new external ingress URL.</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">lifecycle</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    replace_triggered_by</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">[azurerm_container_app</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ca_jcmsui]</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">  triggers</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    command </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;-EOT</span></span>
<span class="line"><span style="color: #9ECBFF">      $redirectUris = @{ "https://</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">azurerm_container_app</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ca_jcmsui</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ingress</span><span style="color: #9ECBFF">[</span><span style="color: #79B8FF">0</span><span style="color: #9ECBFF">]</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">fqdn</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">/.auth/login/aad/callback" = $true }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9ECBFF">      $appRegDetails = (az ad app show --id "</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_key_vault_secret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">entra_clientid</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">value</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">" | ConvertFrom-Json)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9ECBFF">      foreach ($uri in $appRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #9ECBFF">        $redirectUris[$uri] = $true</span></span>
<span class="line"><span style="color: #9ECBFF">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9ECBFF">      az ad app update `</span></span>
<span class="line"><span style="color: #9ECBFF">        --id "</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_key_vault_secret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">entra_clientid</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">value</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">" `</span></span>
<span class="line"><span style="color: #9ECBFF">        --web-redirect-uris $redirectUris.Keys `</span></span>
<span class="line"><span style="color: #9ECBFF">        --output "none"</span></span>
<span class="line"><span style="color: #F97583">    EOT</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">provisioner</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"local-exec"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    command</span><span style="color: #FFAB70">     </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">self</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">triggers</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">command</span></span>
<span class="line"><span style="color: #E1E4E8">    interpreter</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">[</span><span style="color: #9ECBFF">"pwsh"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"-Command"</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>And just like that, a few hours of automation saved a few minutes of manual clicking. Happy coding!</p></div></div></article></div></div></main><script src="/_next/static/chunks/webpack-efd16f5debe934f5.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/583a894d7b920fb7-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/e807dee2426166ad-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/cf6d346f04b2f900.css\",{\"as\":\"style\"}]\n0:\"$L4\"\n"])</script><script>self.__next_f.push([1,"5:HL[\"/_next/static/css/4823b726c835f640.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"6:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-98393ace57ba3968.js\"],\"name\":\"default\",\"async\":false}\n8:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-98393ace57ba3968.js\"],\"name\":\"\",\"async\":false}\n9:I{\"id\":6685,\"chunks\":[\"685:static/chunks/685-8c2a2ee442f8842a.js\",\"185:static/chunks/app/layout-4978ca41370bd554.js\"],\"na"])</script><script>self.__next_f.push([1,"me\":\"\",\"async\":false}\na:I{\"id\":6112,\"chunks\":[\"685:static/chunks/685-8c2a2ee442f8842a.js\",\"185:static/chunks/app/layout-4978ca41370bd554.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-98393ace57ba3968.js\"],\"name\":\"default\",\"async\":false}\nc:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-983"])</script><script>self.__next_f.push([1,"93ace57ba3968.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"4:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cf6d346f04b2f900.css\",\"precedence\":\"next\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"7WZbNw5qMn6MG_bITJhGB\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/2025/05/05/Fully-Automated-EasyAuth\",\"initialTree\":[\"\",{\"children\":[[\"id\",\"2025/05/05/Fully-Automated-EasyAuth\",\"c\"],{\"children\":[\"__PAGE__?{\\\"id\\\":[\\\"2025\\\",\\\"05\\\",\\\"05\\\",\\\"Fully-Automated-EasyAuth\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L7\"],\"globalErrorComponent\":\"$8\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__variable_eb9fb7 __variable_2fad4c\",\"children\":[\"$\",\"body\",null,{\"className\":\"bg-slate-200 dark:bg-slate-700\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"w-full flex flex-row justify-between items-center bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans\",\"children\":[[\"$\",\"div\",null,{\"className\":\"p-2\",\"children\":[\"$\",\"$L9\",null,{\"className\":\"text-2xl font-semibold text-neutral-100 dark:text-neutral-200\",\"href\":\"/\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"inline\",\"children\":\"üçî food for ai\"}],\" \",[\"$\",\"span\",null,{\"className\":\"font-mono font-light text-xs\",\"children\":\"food.joona.cloud\"}]]}]}],[\"$\",\"$La\",null,{\"className\":\"mr-2\"}]]}],[\"$\",\"main\",null,{\"className\":\"mt-4\",\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",[\"id\",\"2025/05/05/Fully-Automated-EasyAuth\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Ld\",\"$Le\",null],\"segment\":\"__PAGE__?{\\\"id\\\":[\\\"2025\\\",\\\"05\\\",\\\"05\\\",\\\"Fully-Automated-EasyAuth\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4823b726c835f640.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"id\",\"2025/05/05/Fully-Automated-EasyAuth\",\"c\"]},\"styles\":[]}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"f:T17e03,"])</script><script>self.__next_f.push([1,"\u003cp\u003eWhen setting up Entra authentication ‚Äî like configuring EasyAuth for App Services or Container Apps, or managing App Registrations and Enterprise Apps on the Entra side ‚Äî official tutorials generally lean heavily on manual clicking (\"click-ops\") in the Azure Portal. This article demonstrates how all such clicking can be avoided by scripting the whole thing.\u003c/p\u003e\n\u003cp\u003eIn this article, Terraform is used for Infrastructure as Code (IaC), PowerShell for scripting, and GitHub Actions for pipelines, but achieving the same thing using Bicep, Bash, and Azure DevOps is equally straightforward.\u003c/p\u003e\n\u003cp\u003eThe code examples presented are based on the \"JavaCMS\" toy project, whose source code is available in its \u003ca href=\"https://github.com/iotalambda/javacms/commit/fe2256177a9ed3a8c844c09ae8e64571af430a06\"\u003eGitHub repo\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"entra-resources\"\u003e\u003ca href=\"#entra-resources\"\u003eEntra resources\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eAn \u003ccode\u003eaz cli\u003c/code\u003e heavy, \u003cem\u003eidempotent\u003c/em\u003e script is first created to set up the Entra resources ‚Äî an App Registration and an Enterprise App. To begin, some variables are needed:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# The name of the App Registration shown in Azure Portal.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegName \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"jcms-app\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# The name of the Key Vault instance in which secrets can be stored.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$keyVaultName \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"jcms-dev-mgmt-kv\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# The name of the Service Principal used by GitHub Actions.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$githubSpName \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"jcms-github\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# The name of the App Registration shown in Azure Portal.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegName \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"jcms-app\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# The name of the Key Vault instance in which secrets can be stored.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$keyVaultName \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"jcms-dev-mgmt-kv\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# The name of the Service Principal used by GitHub Actions.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$githubSpName \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"jcms-github\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eA hash-set for the \u003cem\u003eredirect URIs\u003c/em\u003e is also needed, ensuring they're kept updated for the App Registration and preventing duplicates:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$redirectUris \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e@\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e{ \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"http://localhost:3000/api/auth/callback/microsoft-entra-id\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$true\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace this with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$redirectUris \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e@\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e{ \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"http://localhost:3000/api/auth/callback/microsoft-entra-id\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$true\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNote that the hash-set includes a localhost address, allowing Entra authentication to be used even when the app is running locally. If local support isn't needed, the array can remain empty.\u003c/p\u003e\n\u003cp\u003eTo keep the script idempotent ‚Äî meaning running it multiple times always results in the same outcome ‚Äî it first needs to be checked whether an App Registration named \u003ccode\u003e$appRegName\u003c/code\u003e already exists. If it does, the existing one and its redirect URIs are reused; otherwise, a new one is created:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Checking if app registration exists...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$existingAppRegDetails \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (az ad app list \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eConvertFrom-Json\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e.displayName \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegName\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e }[\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ($existingAppRegDetails) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    $appRegId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $existingAppRegDetails.appId\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"App registration exists. Extracting redirect uris...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ($existingAppRegDetails.web.redirectUris) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eforeach\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ($uri \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $existingAppRegDetails.web.redirectUris) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# NOTE: The hash-set approach is useful here, as it prevents duplication\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e#       of the initial localhost redirect URL.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            $redirectUris[$uri] \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$true\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Redirect uris extracted.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"No redirect uris.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"App registration doesn't exist. Creating app registration...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    $appRegId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e az ad app create \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003edisplay\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegName\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003equery \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"appId\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"tsv\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"App registration created.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Checking if app registration exists...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$existingAppRegDetails \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e (az ad app list \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eConvertFrom-Json\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e.displayName \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegName\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e }[\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ($existingAppRegDetails) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    $appRegId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $existingAppRegDetails.appId\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"App registration exists. Extracting redirect uris...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ($existingAppRegDetails.web.redirectUris) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003eforeach\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ($uri \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ein\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $existingAppRegDetails.web.redirectUris) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# NOTE: The hash-set approach is useful here, as it prevents duplication\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e#       of the initial localhost redirect URL.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            $redirectUris[$uri] \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$true\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Redirect uris extracted.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"No redirect uris.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"App registration doesn't exist. Creating app registration...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    $appRegId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e az ad app create \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003edisplay\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegName\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003equery \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"appId\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"tsv\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"App registration created.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe ID of the existing/created App Registration is also stored in the \u003ccode\u003e$appRegId\u003c/code\u003e variable.\u003c/p\u003e\n\u003cp\u003eWhether newly created or not, the App Registration is then ensured to have the correct redirect URIs:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Updating redirect uris...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz ad app update \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eweb\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eredirect\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003euris $redirectUris.Keys \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Redirect uris updated.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Updating redirect uris...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz ad app update \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eweb\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eredirect\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003euris $redirectUris.Keys \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Redirect uris updated.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAn \u003cem\u003eIdentifier URI\u003c/em\u003e (\u003ccode\u003eapi://...\u003c/code\u003e) must also be configured for the App Registration. This Identifier URI globally identifies the App Registration as a resource in OAuth flows:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Adding identifier URI...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz ad app update \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eidentifier\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003euris \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"api://\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Identifier URI added.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Adding identifier URI...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz ad app update \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eidentifier\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003euris \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"api://\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Identifier URI added.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNext, \u003cem\u003eID token issuance\u003c/em\u003e is enabled, allowing the App Registration to authenticate users and issue claims about them:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Enabling ID tokens...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz ad app update \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eenable-id\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003etoken\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eissuance \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"true\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"ID tokens enabled.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Enabling ID tokens...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz ad app update \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eenable-id\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003etoken\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eissuance \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"true\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"ID tokens enabled.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003eUser.Read\u003c/code\u003e permission must be configured for the App Registration. This allows the authentication flow to request the \u003ccode\u003eUser.Read\u003c/code\u003e scope on behalf of the app, enabling access to the user's email address and other necessary claims. The current permission list of the App Registration is retrieved, and it is ensured that permission for that scope exists in an idempotent way:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Getting existing permissions...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$existingPermissions \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e az ad app permission list \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eConvertFrom-Json\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Existing permissions gotten.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$graphApiAppId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"00000003-0000-0000-c000-000000000000\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$userReadResourceAccessId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"e1fe6dd8-ba31-4d61-89e7-88639da4683d\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$existingUserReadPermission \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $existingPermissions \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e.resourceAppId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $graphApiAppId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-and\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e.resourceAccess \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e.id \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $userReadResourceAccessId }) }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ($existingUserReadPermission) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"User.Read permission exists.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Adding User.Read permission...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    az ad app permission add \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eapi $graphApiAppId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eapi\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003epermissions \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$userReadResourceAccessId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e=Scope\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"User.Read permission added.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Getting existing permissions...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$existingPermissions \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e az ad app permission list \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eConvertFrom-Json\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Existing permissions gotten.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$graphApiAppId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"00000003-0000-0000-c000-000000000000\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$userReadResourceAccessId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"e1fe6dd8-ba31-4d61-89e7-88639da4683d\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$existingUserReadPermission \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $existingPermissions \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e.resourceAppId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $graphApiAppId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-and\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e.resourceAccess \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e.id \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $userReadResourceAccessId }) }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ($existingUserReadPermission) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"User.Read permission exists.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eelse\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Adding User.Read permission...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    az ad app permission add \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eapi $graphApiAppId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eapi\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003epermissions \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$userReadResourceAccessId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e=Scope\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"User.Read permission added.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe value of \u003ccode\u003e$userReadResourceAccessId\u003c/code\u003e corresponds to \u003ca href=\"https://learn.microsoft.com/en-us/graph/migrate-azure-ad-graph-permissions-differences#delegated-12\"\u003ea \"well-known\" globally unique identifier of the delegated \u003ccode\u003eUser.Read\u003c/code\u003e permission in Microsoft Graph\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eSince the example application's users belong to the current tenant, admin consent is granted to the App Registration:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Granting admin consent...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz ad app permission admin\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003econsent \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Admin consent granted.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Granting admin consent...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz ad app permission admin\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003econsent \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Admin consent granted.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNext, the Enterprise App is set up by creating one with the same ID as the App Registration:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Creating enterprise app...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz ad sp create \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Enterprise app created.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Creating enterprise app...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz ad sp create \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Enterprise app created.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe example application uses the Enterprise App‚Äôs \u003cem\u003eApp Roles\u003c/em\u003e for authorization. To enforce this, an assignment to an App Role is required:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Setting assignment required...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz ad sp update \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eset appRoleAssignmentRequired\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003etrue \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Assignment set required.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Setting assignment required...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz ad sp update \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eset appRoleAssignmentRequired\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003etrue \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Assignment set required.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLater, when the application's infrastructure is set up in GitHub Actions, the Entra resources will need to be further configured using the GitHub Actions‚Äìassociated Service Principal. To grant sufficient privileges, ownership of the Enterprise App is assigned to this Service Principal. First, its Object ID is retrieved:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Getting github service principal object id...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$githubSpObjectId \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ((az ad sp list \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eConvertFrom-Json\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e.displayName \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$githubSpName\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e })[\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e].id\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Github service principal object id gotten.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Getting github service principal object id...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$githubSpObjectId \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ((az ad sp list \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eConvertFrom-Json\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eWhere-Object\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e { \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$_\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e.displayName \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-eq\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$githubSpName\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e })[\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e].id\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Github service principal object id gotten.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe Service Principal is then assigned as the owner of the Enterprise App:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Adding github service principal as the owner of the app...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz ad app owner add \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eowner\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$githubSpObjectId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Github SP added as the owner of the app.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Adding github service principal as the owner of the app...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz ad app owner add \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eowner\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eobject\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$githubSpObjectId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Github SP added as the owner of the app.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFinally, a \u003cem\u003eclient secret\u003c/em\u003e is created for the application to use when accessing the App Registration:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Creating client secret...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$clientSecret \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e az ad app credential reset \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003edisplay\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"client-secret\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eyears \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003equery \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"password\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"tsv\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Client secret created.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Creating client secret...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$clientSecret \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e az ad app credential reset \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003edisplay\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"client-secret\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eyears \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003equery \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"password\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"tsv\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Client secret created.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003cem\u003eclient secret\u003c/em\u003e and the App Registration's \u003cem\u003eclient ID\u003c/em\u003e (which ‚Äî incidentally ‚Äî is equal to \u003ccode\u003e$appRegId\u003c/code\u003e) are stored in Key Vault, allowing easy synchronization with Azure based applications:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"powershell\" data-theme=\"light\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Adding client id to key vault...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz keyvault secret set \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003evault\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$keyVaultName\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"jcms-entra-clientid\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace the secret name with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003evalue \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Client id added to key vault.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Adding client secret to key vault...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eaz keyvault secret set \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003evault\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$keyVaultName\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"jcms-entra-clientsecret\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace the secret name with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003evalue \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$clientSecret\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Client secret added to key vault.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"powershell\" data-theme=\"dark\"\u003e\u003ccode data-language=\"powershell\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Adding client id to key vault...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz keyvault secret set \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003evault\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$keyVaultName\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"jcms-entra-clientid\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace the secret name with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003evalue \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$appRegId\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Client id added to key vault.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Adding client secret to key vault...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eaz keyvault secret set \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003evault\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$keyVaultName\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ename \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"jcms-entra-clientsecret\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# ‚ö†Ô∏è Replace the secret name with your own!\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003evalue \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$clientSecret\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e--\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eoutput \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003eWrite-InfoLog\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Client secret added to key vault.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"iac\"\u003e\u003ca href=\"#iac\"\u003eIaC\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe example application runs on Azure Container Apps, so next a Container App is created using Terraform (irrelevant parts removed for brevity):\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"hcl\" data-theme=\"light\"\u003e\u003ccode data-language=\"hcl\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eresource\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"azurerm_container_app\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"ca_jcmsui\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003etemplate\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003econtainer\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eenv\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        name\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"WEBSITE_AUTH_AAD_ALLOWED_TENANTS\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        value\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eazurerm_client_config\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ecurrent\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003etenant_id\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esecret\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    name\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"jcms-entra-clientsecret\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    key_vault_secret_id\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eazurerm_key_vault_secret\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eentra_clientsecret\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"hcl\" data-theme=\"dark\"\u003e\u003ccode data-language=\"hcl\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eresource\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"azurerm_container_app\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"ca_jcmsui\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003etemplate\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003econtainer\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003eenv\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        name\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"WEBSITE_AUTH_AAD_ALLOWED_TENANTS\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        value\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eazurerm_client_config\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ecurrent\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003etenant_id\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003esecret\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    name\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"jcms-entra-clientsecret\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    key_vault_secret_id\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eazurerm_key_vault_secret\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eentra_clientsecret\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003eWEBSITE_AUTH_AAD_ALLOWED_TENANTS\u003c/code\u003e env variable is a standard setting for EasyAuth. In the example application, access is restricted to users of the current tenant. The client secret is also synchronized from Key Vault. Since the AzureRM Terraform provider does not (\u003cem\u003enaturally\u003c/em\u003e) support configuring EasyAuth, it's hacked together using \u003ccode\u003eazapi\u003c/code\u003e and \u003ccode\u003enull_resource\u003c/code\u003es instead. First, an \u003ccode\u003eauthConfigs\u003c/code\u003e resource is created using \u003ccode\u003eazapi\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"hcl\" data-theme=\"light\"\u003e\u003ccode data-language=\"hcl\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eresource\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"azapi_resource\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"auth_ca_jcmsui\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  type\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Microsoft.App/containerApps/authConfigs@2024-10-02-preview\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  name\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"current\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# This `authConfigs` resource is a child of the Container App.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  parent_id\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eazurerm_container_app\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eca_jcmsui\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eid\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  body\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    properties \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# The globalValidation section redirects any unauthorized users to the\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# Entra login page. The nice thing is that this process is handled entirely\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# by Azure-managed reverse proxies in front of Container Apps,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# ensuring that unauthorized requests never reach the application itself.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      globalValidation \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        redirectToProvider          \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"azureActiveDirectory\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        unauthenticatedClientAction \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"RedirectToLoginPage\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# Only a single identity provider, Entra, is configured.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# The secret synchronized from Key Vault is also used here.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# The current tenant's ID serves as the issuer, limiting access to \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# (a subset of) users from the current tenant.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      identityProviders \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        azureActiveDirectory \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          enabled \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003etrue\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          registration \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            clientId                \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e data.azurerm_key_vault_secret.entra_clientid.value\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            clientSecretSettingName \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"jcms-entra-clientsecret\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            openIdIssuer            \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"https://login.microsoftonline.com/\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eazurerm_client_config\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ecurrent\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003etenant_id\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/v2.0\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          validation \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            defaultAuthorizationPolicy \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e              allowedApplications \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# This thing lets the App Registration to authorize\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# users to the application.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e                data.azurerm_key_vault_secret.entra_clientid.value\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e              ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"hcl\" data-theme=\"dark\"\u003e\u003ccode data-language=\"hcl\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eresource\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"azapi_resource\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"auth_ca_jcmsui\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  type\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Microsoft.App/containerApps/authConfigs@2024-10-02-preview\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  name\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"current\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# This `authConfigs` resource is a child of the Container App.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  parent_id\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eazurerm_container_app\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eca_jcmsui\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eid\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  body\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    properties \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# The globalValidation section redirects any unauthorized users to the\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# Entra login page. The nice thing is that this process is handled entirely\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# by Azure-managed reverse proxies in front of Container Apps,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# ensuring that unauthorized requests never reach the application itself.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      globalValidation \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        redirectToProvider          \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"azureActiveDirectory\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        unauthenticatedClientAction \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"RedirectToLoginPage\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# Only a single identity provider, Entra, is configured.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# The secret synchronized from Key Vault is also used here.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# The current tenant's ID serves as the issuer, limiting access to \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# (a subset of) users from the current tenant.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      identityProviders \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        azureActiveDirectory \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          enabled \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003etrue\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          registration \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            clientId                \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e data.azurerm_key_vault_secret.entra_clientid.value\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            clientSecretSettingName \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"jcms-entra-clientsecret\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            openIdIssuer            \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"https://login.microsoftonline.com/\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eazurerm_client_config\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ecurrent\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003etenant_id\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/v2.0\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          validation \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            defaultAuthorizationPolicy \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e              allowedApplications \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# This thing lets the App Registration to authorize\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e                \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# users to the application.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e                data.azurerm_key_vault_secret.entra_clientid.value\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e              ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFinally, the App Registration's redirect URIs are updated (in case the \u003ccode\u003eauthConfigs\u003c/code\u003e resource was created or recreated), using the same hash-set approach as before. This time, the actual Container App's EasyAuth AAD redirect URI is enforced instead of the localhost one. Note that at this stage, the GitHub Actions‚Äìassociated Service Principal requires owner privileges:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"hcl\" data-theme=\"light\"\u003e\u003ccode data-language=\"hcl\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eresource\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"null_resource\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"app_redirect_uris\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# This lifecycle ensures that the redirect URIs are updated in the \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# App Registration only when necessary ‚Äî that is, when the Container App \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# is (re-)created and receives a new external ingress URL.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003elifecycle\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    replace_triggered_by\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e[azurerm_container_app\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eca_jcmsui]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  triggers\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    command \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e\u0026#x3C;\u0026#x3C;-EOT\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e      $redirectUris = @{ \"https://\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eazurerm_container_app\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eca_jcmsui\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eingress\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e]\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003efqdn\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/.auth/login/aad/callback\" = $true }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e      $appRegDetails = (az ad app show --id \"\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eazurerm_key_vault_secret\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eentra_clientid\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\" | ConvertFrom-Json)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e      foreach ($uri in $appRegDetails.web.redirectUris) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e        $redirectUris[$uri] = $true\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e      az ad app update `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e        --id \"\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eazurerm_key_vault_secret\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eentra_clientid\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\" `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e        --web-redirect-uris $redirectUris.Keys `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e        --output \"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003e    EOT\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eprovisioner\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"local-exec\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    command\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e     \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eself\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003etriggers\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003ecommand\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    interpreter\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003e \u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"pwsh\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"-Command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"hcl\" data-theme=\"dark\"\u003e\u003ccode data-language=\"hcl\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eresource\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"null_resource\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"app_redirect_uris\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# This lifecycle ensures that the redirect URIs are updated in the \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# App Registration only when necessary ‚Äî that is, when the Container App \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e# is (re-)created and receives a new external ingress URL.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003elifecycle\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    replace_triggered_by\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e[azurerm_container_app\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eca_jcmsui]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  triggers\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    command \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e\u0026#x3C;\u0026#x3C;-EOT\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e      $redirectUris = @{ \"https://\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eazurerm_container_app\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eca_jcmsui\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eingress\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e]\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003efqdn\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/.auth/login/aad/callback\" = $true }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e      $appRegDetails = (az ad app show --id \"\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eazurerm_key_vault_secret\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eentra_clientid\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\" | ConvertFrom-Json)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e      foreach ($uri in $appRegDetails.web.redirectUris) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e        $redirectUris[$uri] = $true\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e      az ad app update `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e        --id \"\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e${\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003edata\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eazurerm_key_vault_secret\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eentra_clientid\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003evalue\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e}\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\" `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e        --web-redirect-uris $redirectUris.Keys `\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e        --output \"none\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003e    EOT\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003eprovisioner\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"local-exec\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    command\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e     \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003eself\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003etriggers\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003ecommand\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    interpreter\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #FFAB70\"\u003e \u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e[\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"pwsh\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"-Command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd just like that, a few hours of automation saved a few minutes of manual clicking. Happy coding!\u003c/p\u003e"])</script><script>self.__next_f.push([1,"e:[\"$\",\"div\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"md:px-10 min-w-0 max-w-7xl mb-12\",\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"px-5 mb-4 py-10 relative\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100\",\"children\":\"Fully Automated EasyAuth\"}],[\"$\",\"time\",null,{\"dateTime\":\"2025-05-05 20:00\",\"className\":\"pl-1 font-serif text-slate-400 bottom-0 absolute\",\"children\":[[\"$\",\"svg\",null,{\"className\":\"h-4 w-4 inline-block\",\"width\":\"24\",\"height\":\"24\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":\"2\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12 19l7-7 3 3-7 7-3-3z\"}],\" \",[\"$\",\"path\",null,{\"d\":\"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\"}],\" \",[\"$\",\"path\",null,{\"d\":\"M2 2l7.586 7.586\"}],\" \",[\"$\",\"circle\",null,{\"cx\":\"11\",\"cy\":\"11\",\"r\":\"2\"}]]}],\" \",\"2025-05-05 20:00\"]}]]}],[\"$\",\"div\",null,{\"className\":\"bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg\",\"children\":[\"$undefined\",[\"$\",\"div\",null,{\"className\":\"space-y-4\",\"dangerouslySetInnerHTML\":{\"__html\":\"$f\"}}]]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Fully Automated EasyAuth | Food for AI blog\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Blog about .NET, Azure, React and whatever comes to mind.\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\nd:null\n"])</script></body></html>