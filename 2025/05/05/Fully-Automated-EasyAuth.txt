1:HL["/_next/static/media/3d9ea938b6afa941-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/7eaa4a2482b4df1a-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/css/488301a2e2aae266.css",{"as":"style"}]
0:["7qqd27EZmvDSdxWKQ8e4J",[[["",{"children":[["id","2025/05/05/Fully-Automated-EasyAuth","c"],{"children":["__PAGE__?{\"id\":[\"2025\",\"05\",\"05\",\"Fully-Automated-EasyAuth\"]}",{}]}]},"$undefined","$undefined",true],"$L4",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/488301a2e2aae266.css","precedence":"next"}]],"$L5"]]]]
6:HL["/_next/static/css/301e7291452e98cd.css",{"as":"style"}]
7:I{"id":6685,"chunks":["685:static/chunks/685-a8c11ad368fada34.js","185:static/chunks/app/layout-0afbb0e01943be7f.js"],"name":"","async":false}
8:I{"id":7767,"chunks":["272:static/chunks/webpack-b2aba447c1dc2205.js","971:static/chunks/fd9d1056-a99b58d3cc150217.js","596:static/chunks/596-9d43875837bd0b65.js"],"name":"default","async":false}
9:I{"id":7920,"chunks":["272:static/chunks/webpack-b2aba447c1dc2205.js","971:static/chunks/fd9d1056-a99b58d3cc150217.js","596:static/chunks/596-9d43875837bd0b65.js"],"name":"default","async":false}
4:[null,["$","html",null,{"lang":"en","className":"__variable_965427 __variable_9c011f","children":["$","body",null,{"className":"bg-slate-200 dark:bg-slate-700","children":[["$","nav",null,{"className":"w-full flex flex-row justify-between bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans","children":["$","div",null,{"className":"p-2","children":["$","$L7",null,{"className":"text-2xl font-semibold text-neutral-100 dark:text-neutral-200","href":"/","children":[["$","h1",null,{"className":"inline","children":"üçî food for ai"}]," ",["$","span",null,{"className":"font-mono font-light text-xs","children":"food.joona.cloud"}]]}]}]}],["$","main",null,{"className":"mt-4","children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children",["id","2025/05/05/Fully-Automated-EasyAuth","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La","$Lb",null],"segment":"__PAGE__?{\"id\":[\"2025\",\"05\",\"05\",\"Fully-Automated-EasyAuth\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/301e7291452e98cd.css","precedence":"next"}]]}],"segment":["id","2025/05/05/Fully-Automated-EasyAuth","c"]},"styles":[]}]}]]}]}],null]
5:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Fully Automated EasyAuth | Food for AI blog"}],["$","meta","2",{"name":"description","content":"Blog about .NET, Azure, React and whatever comes to mind."}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","5",{"name":"next-size-adjust"}]]
c:T17e03,<p>When setting up Entra authentication ‚Äî like configuring EasyAuth for App Services or Container Apps, or managing App Registrations and Enterprise Apps on the Entra side ‚Äî official tutorials generally lean heavily on manual clicking ("click-ops") in the Azure Portal. This article demonstrates how all such clicking can be avoided by scripting the whole thing.</p>
<p>In this article, Terraform is used for Infrastructure as Code (IaC), PowerShell for scripting, and GitHub Actions for pipelines, but achieving the same thing using Bicep, Bash, and Azure DevOps is equally straightforward.</p>
<p>The code examples presented are based on the "JavaCMS" toy project, whose source code is available in its <a href="https://github.com/iotalambda/javacms/commit/fe2256177a9ed3a8c844c09ae8e64571af430a06">GitHub repo</a>.</p>
<h2 id="entra-resources"><a href="#entra-resources">Entra resources</a></h2>
<p>An <code>az cli</code> heavy, <em>idempotent</em> script is first created to set up the Entra resources ‚Äî an App Registration and an Enterprise App. To begin, some variables are needed:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #6A737D"># The name of the App Registration shown in Azure Portal.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$appRegName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-app"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Key Vault instance in which secrets can be stored.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$keyVaultName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-dev-mgmt-kv"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Service Principal used by GitHub Actions.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$githubSpName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-github"</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #6A737D"># The name of the App Registration shown in Azure Portal.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$appRegName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-app"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Key Vault instance in which secrets can be stored.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$keyVaultName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-dev-mgmt-kv"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># The name of the Service Principal used by GitHub Actions.</span></span>
<span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$githubSpName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-github"</span></span></code></pre></div>
<p>A hash-set for the <em>redirect URIs</em> is also needed, ensuring they're kept updated for the App Registration and preventing duplicates:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #24292E">$redirectUris </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">@</span><span style="color: #24292E">{ </span><span style="color: #032F62">"http://localhost:3000/api/auth/callback/microsoft-entra-id"</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">$true</span><span style="color: #24292E"> }</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #6A737D"># ‚ö†Ô∏è Replace this with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">$redirectUris </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">@</span><span style="color: #E1E4E8">{ </span><span style="color: #9ECBFF">"http://localhost:3000/api/auth/callback/microsoft-entra-id"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">$true</span><span style="color: #E1E4E8"> }</span></span></code></pre></div>
<p>Note that the hash-set includes a localhost address, allowing Entra authentication to be used even when the app is running locally. If local support isn't needed, the array can remain empty.</p>
<p>To keep the script idempotent ‚Äî meaning running it multiple times always results in the same outcome ‚Äî it first needs to be checked whether an App Registration named <code>$appRegName</code> already exists. If it does, the existing one and its redirect URIs are reused; otherwise, a new one is created:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Checking if app registration exists..."</span></span>
<span class="line"><span style="color: #24292E">$existingAppRegDetails </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (az ad app list </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">ConvertFrom-Json</span><span style="color: #24292E">) </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.displayName </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegName</span><span style="color: #032F62">"</span><span style="color: #24292E"> }[</span><span style="color: #005CC5">0</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> ($existingAppRegDetails) {</span></span>
<span class="line"><span style="color: #24292E">    $appRegId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $existingAppRegDetails.appId</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"App registration exists. Extracting redirect uris..."</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ($existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">foreach</span><span style="color: #24292E"> ($uri </span><span style="color: #D73A49">in</span><span style="color: #24292E"> $existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6A737D"># NOTE: The hash-set approach is useful here, as it prevents duplication</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #6A737D">#       of the initial localhost redirect URL.</span></span>
<span class="line"><span style="color: #24292E">            $redirectUris[$uri] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">$true</span><span style="color: #24292E"> </span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Redirect uris extracted."</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"No redirect uris."</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"App registration doesn't exist. Creating app registration..."</span></span>
<span class="line"><span style="color: #24292E">    $appRegId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> az ad app create </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">display</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegName</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">query </span><span style="color: #032F62">"appId"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"tsv"</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"App registration created."</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Checking if app registration exists..."</span></span>
<span class="line"><span style="color: #E1E4E8">$existingAppRegDetails </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (az ad app list </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">ConvertFrom-Json</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.displayName </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> }[</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($existingAppRegDetails) {</span></span>
<span class="line"><span style="color: #E1E4E8">    $appRegId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> $existingAppRegDetails.appId</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"App registration exists. Extracting redirect uris..."</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">foreach</span><span style="color: #E1E4E8"> ($uri </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> $existingAppRegDetails.web.redirectUris) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D"># NOTE: The hash-set approach is useful here, as it prevents duplication</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #6A737D">#       of the initial localhost redirect URL.</span></span>
<span class="line"><span style="color: #E1E4E8">            $redirectUris[$uri] </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">$true</span><span style="color: #E1E4E8"> </span></span>
<span class="line"><span style="color: #E1E4E8">        }</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Redirect uris extracted."</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"No redirect uris."</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"App registration doesn't exist. Creating app registration..."</span></span>
<span class="line"><span style="color: #E1E4E8">    $appRegId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> az ad app create </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">display</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">query </span><span style="color: #9ECBFF">"appId"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"tsv"</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"App registration created."</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>The ID of the existing/created App Registration is also stored in the <code>$appRegId</code> variable.</p>
<p>Whether newly created or not, the App Registration is then ensured to have the correct redirect URIs:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Updating redirect uris..."</span></span>
<span class="line"><span style="color: #24292E">az ad app update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">web</span><span style="color: #D73A49">-</span><span style="color: #24292E">redirect</span><span style="color: #D73A49">-</span><span style="color: #24292E">uris $redirectUris.Keys </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Redirect uris updated."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Updating redirect uris..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">web</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">redirect</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">uris $redirectUris.Keys </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Redirect uris updated."</span></span></code></pre></div>
<p>An <em>Identifier URI</em> (<code>api://...</code>) must also be configured for the App Registration. This Identifier URI globally identifies the App Registration as a resource in OAuth flows:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding identifier URI..."</span></span>
<span class="line"><span style="color: #24292E">az ad app update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">identifier</span><span style="color: #D73A49">-</span><span style="color: #24292E">uris </span><span style="color: #032F62">"api://</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Identifier URI added."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding identifier URI..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">identifier</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">uris </span><span style="color: #9ECBFF">"api://</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Identifier URI added."</span></span></code></pre></div>
<p>Next, <em>ID token issuance</em> is enabled, allowing the App Registration to authenticate users and issue claims about them:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Enabling ID tokens..."</span></span>
<span class="line"><span style="color: #24292E">az ad app update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #005CC5">enable-id</span><span style="color: #D73A49">-</span><span style="color: #24292E">token</span><span style="color: #D73A49">-</span><span style="color: #24292E">issuance </span><span style="color: #032F62">"true"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"ID tokens enabled."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Enabling ID tokens..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #79B8FF">enable-id</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">token</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">issuance </span><span style="color: #9ECBFF">"true"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"ID tokens enabled."</span></span></code></pre></div>
<p>The <code>User.Read</code> permission must be configured for the App Registration. This allows the authentication flow to request the <code>User.Read</code> scope on behalf of the app, enabling access to the user's email address and other necessary claims. The current permission list of the App Registration is retrieved, and it is ensured that permission for that scope exists in an idempotent way:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Getting existing permissions..."</span></span>
<span class="line"><span style="color: #24292E">$existingPermissions </span><span style="color: #D73A49">=</span><span style="color: #24292E"> az ad app permission list </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">ConvertFrom-Json</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Existing permissions gotten."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">$graphApiAppId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"00000003-0000-0000-c000-000000000000"</span></span>
<span class="line"><span style="color: #24292E">$userReadResourceAccessId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"e1fe6dd8-ba31-4d61-89e7-88639da4683d"</span></span>
<span class="line"><span style="color: #24292E">$existingUserReadPermission </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $existingPermissions </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.resourceAppId </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> $graphApiAppId </span><span style="color: #D73A49">-and</span><span style="color: #24292E"> (</span><span style="color: #005CC5">$_</span><span style="color: #24292E">.resourceAccess </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.id </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> $userReadResourceAccessId }) }</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> ($existingUserReadPermission) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"User.Read permission exists."</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding User.Read permission..."</span></span>
<span class="line"><span style="color: #24292E">    az ad app permission add </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">api $graphApiAppId </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">api</span><span style="color: #D73A49">-</span><span style="color: #24292E">permissions </span><span style="color: #032F62">"</span><span style="color: #24292E">$userReadResourceAccessId</span><span style="color: #032F62">=Scope"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"User.Read permission added."</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Getting existing permissions..."</span></span>
<span class="line"><span style="color: #E1E4E8">$existingPermissions </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> az ad app permission list </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">ConvertFrom-Json</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Existing permissions gotten."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">$graphApiAppId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"00000003-0000-0000-c000-000000000000"</span></span>
<span class="line"><span style="color: #E1E4E8">$userReadResourceAccessId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"e1fe6dd8-ba31-4d61-89e7-88639da4683d"</span></span>
<span class="line"><span style="color: #E1E4E8">$existingUserReadPermission </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> $existingPermissions </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.resourceAppId </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> $graphApiAppId </span><span style="color: #F97583">-and</span><span style="color: #E1E4E8"> (</span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.resourceAccess </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.id </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> $userReadResourceAccessId }) }</span></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($existingUserReadPermission) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"User.Read permission exists."</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding User.Read permission..."</span></span>
<span class="line"><span style="color: #E1E4E8">    az ad app permission add </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">api $graphApiAppId </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">api</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">permissions </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$userReadResourceAccessId</span><span style="color: #9ECBFF">=Scope"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"User.Read permission added."</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>The value of <code>$userReadResourceAccessId</code> corresponds to <a href="https://learn.microsoft.com/en-us/graph/migrate-azure-ad-graph-permissions-differences#delegated-12">a "well-known" globally unique identifier of the delegated <code>User.Read</code> permission in Microsoft Graph</a>.</p>
<p>Since the example application's users belong to the current tenant, admin consent is granted to the App Registration:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Granting admin consent..."</span></span>
<span class="line"><span style="color: #24292E">az ad app permission admin</span><span style="color: #D73A49">-</span><span style="color: #24292E">consent </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Admin consent granted."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Granting admin consent..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app permission admin</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">consent </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Admin consent granted."</span></span></code></pre></div>
<p>Next, the Enterprise App is set up by creating one with the same ID as the App Registration:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Creating enterprise app..."</span></span>
<span class="line"><span style="color: #24292E">az ad sp create </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Enterprise app created."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Creating enterprise app..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad sp create </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Enterprise app created."</span></span></code></pre></div>
<p>The example application uses the Enterprise App‚Äôs <em>App Roles</em> for authorization. To enforce this, an assignment to an App Role is required:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Setting assignment required..."</span></span>
<span class="line"><span style="color: #24292E">az ad sp update </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">set appRoleAssignmentRequired</span><span style="color: #D73A49">=</span><span style="color: #24292E">true </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Assignment set required."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Setting assignment required..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad sp update </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">set appRoleAssignmentRequired</span><span style="color: #F97583">=</span><span style="color: #E1E4E8">true </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Assignment set required."</span></span></code></pre></div>
<p>Later, when the application's infrastructure is set up in GitHub Actions, the Entra resources will need to be further configured using the GitHub Actions‚Äìassociated Service Principal. To grant sufficient privileges, ownership of the Enterprise App is assigned to this Service Principal. First, its Object ID is retrieved:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Getting github service principal object id..."</span></span>
<span class="line"><span style="color: #24292E">$githubSpObjectId </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ((az ad sp list </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">ConvertFrom-Json</span><span style="color: #24292E">) </span><span style="color: #D73A49">|</span><span style="color: #24292E"> </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.displayName </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$githubSpName</span><span style="color: #032F62">"</span><span style="color: #24292E"> })[</span><span style="color: #005CC5">0</span><span style="color: #24292E">].id</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Github service principal object id gotten."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Getting github service principal object id..."</span></span>
<span class="line"><span style="color: #E1E4E8">$githubSpObjectId </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> ((az ad sp list </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">ConvertFrom-Json</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">|</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.displayName </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$githubSpName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> })[</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">].id</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Github service principal object id gotten."</span></span></code></pre></div>
<p>The Service Principal is then assigned as the owner of the Enterprise App:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding github service principal as the owner of the app..."</span></span>
<span class="line"><span style="color: #24292E">az ad app owner add </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">owner</span><span style="color: #D73A49">-</span><span style="color: #24292E">object</span><span style="color: #D73A49">-</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$githubSpObjectId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Github SP added as the owner of the app."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding github service principal as the owner of the app..."</span></span>
<span class="line"><span style="color: #E1E4E8">az ad app owner add </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">owner</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">object</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$githubSpObjectId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Github SP added as the owner of the app."</span></span></code></pre></div>
<p>Finally, a <em>client secret</em> is created for the application to use when accessing the App Registration:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Creating client secret..."</span></span>
<span class="line"><span style="color: #24292E">$clientSecret </span><span style="color: #D73A49">=</span><span style="color: #24292E"> az ad app credential reset </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">id </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">display</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"client-secret"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">years </span><span style="color: #005CC5">2</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">query </span><span style="color: #032F62">"password"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"tsv"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Client secret created."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Creating client secret..."</span></span>
<span class="line"><span style="color: #E1E4E8">$clientSecret </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> az ad app credential reset </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">id </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">display</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"client-secret"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">years </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">query </span><span style="color: #9ECBFF">"password"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"tsv"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Client secret created."</span></span></code></pre></div>
<p>The <em>client secret</em> and the App Registration's <em>client ID</em> (which ‚Äî incidentally ‚Äî is equal to <code>$appRegId</code>) are stored in Key Vault, allowing easy synchronization with Azure based applications:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding client id to key vault..."</span></span>
<span class="line"><span style="color: #24292E">az keyvault secret set </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">vault</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"</span><span style="color: #24292E">$keyVaultName</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">name </span><span style="color: #032F62">"jcms-entra-clientid"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span><span style="color: #24292E"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">value </span><span style="color: #032F62">"</span><span style="color: #24292E">$appRegId</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Client id added to key vault."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Adding client secret to key vault..."</span></span>
<span class="line"><span style="color: #24292E">az keyvault secret set </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">vault</span><span style="color: #D73A49">-</span><span style="color: #24292E">name </span><span style="color: #032F62">"</span><span style="color: #24292E">$keyVaultName</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">name </span><span style="color: #032F62">"jcms-entra-clientsecret"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span><span style="color: #24292E"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">value </span><span style="color: #032F62">"</span><span style="color: #24292E">$clientSecret</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #D73A49">`</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">--</span><span style="color: #24292E">output </span><span style="color: #032F62">"none"</span></span>
<span class="line"><span style="color: #005CC5">Write-InfoLog</span><span style="color: #24292E"> </span><span style="color: #032F62">"Client secret added to key vault."</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding client id to key vault..."</span></span>
<span class="line"><span style="color: #E1E4E8">az keyvault secret set </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">vault</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$keyVaultName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"jcms-entra-clientid"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">value </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$appRegId</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Client id added to key vault."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Adding client secret to key vault..."</span></span>
<span class="line"><span style="color: #E1E4E8">az keyvault secret set </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">vault</span><span style="color: #F97583">-</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$keyVaultName</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">name </span><span style="color: #9ECBFF">"jcms-entra-clientsecret"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span><span style="color: #E1E4E8"> </span><span style="color: #6A737D"># ‚ö†Ô∏è Replace the secret name with your own!</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">value </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$clientSecret</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">`</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">--</span><span style="color: #E1E4E8">output </span><span style="color: #9ECBFF">"none"</span></span>
<span class="line"><span style="color: #79B8FF">Write-InfoLog</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Client secret added to key vault."</span></span></code></pre></div>
<h2 id="iac"><a href="#iac">IaC</a></h2>
<p>The example application runs on Azure Container Apps, so next a Container App is created using Terraform (irrelevant parts removed for brevity):</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="light"><code data-language="hcl" data-theme="light"><span class="line"><span style="color: #6F42C1">resource</span><span style="color: #24292E"> </span><span style="color: #005CC5">"azurerm_container_app"</span><span style="color: #24292E"> </span><span style="color: #005CC5">"ca_jcmsui"</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">template</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">container</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6F42C1">env</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        name</span><span style="color: #E36209">  </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"WEBSITE_AUTH_AAD_ALLOWED_TENANTS"</span></span>
<span class="line"><span style="color: #24292E">        value</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_client_config</span><span style="color: #D73A49">.</span><span style="color: #24292E">current</span><span style="color: #D73A49">.</span><span style="color: #24292E">tenant_id</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">secret</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    name</span><span style="color: #E36209">                </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #24292E">    key_vault_secret_id</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_key_vault_secret</span><span style="color: #D73A49">.</span><span style="color: #24292E">entra_clientsecret</span><span style="color: #D73A49">.</span><span style="color: #24292E">id</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="hcl" data-theme="dark"><code data-language="hcl" data-theme="dark"><span class="line"><span style="color: #B392F0">resource</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"azurerm_container_app"</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"ca_jcmsui"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">template</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">container</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #B392F0">env</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        name</span><span style="color: #FFAB70">  </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"WEBSITE_AUTH_AAD_ALLOWED_TENANTS"</span></span>
<span class="line"><span style="color: #E1E4E8">        value</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_client_config</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">current</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">tenant_id</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">secret</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    name</span><span style="color: #FFAB70">                </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #E1E4E8">    key_vault_secret_id</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_key_vault_secret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">entra_clientsecret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">id</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>The <code>WEBSITE_AUTH_AAD_ALLOWED_TENANTS</code> env variable is a standard setting for EasyAuth. In the example application, access is restricted to users of the current tenant. The client secret is also synchronized from Key Vault. Since the AzureRM Terraform provider does not (<em>naturally</em>) support configuring EasyAuth, it's hacked together using <code>azapi</code> and <code>null_resource</code>s instead. First, an <code>authConfigs</code> resource is created using <code>azapi</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="light"><code data-language="hcl" data-theme="light"><span class="line"><span style="color: #6F42C1">resource</span><span style="color: #24292E"> </span><span style="color: #005CC5">"azapi_resource"</span><span style="color: #24292E"> </span><span style="color: #005CC5">"auth_ca_jcmsui"</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  type</span><span style="color: #E36209">      </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"Microsoft.App/containerApps/authConfigs@2024-10-02-preview"</span></span>
<span class="line"><span style="color: #24292E">  name</span><span style="color: #E36209">      </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #032F62">"current"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># This `authConfigs` resource is a child of the Container App.</span></span>
<span class="line"><span style="color: #24292E">  parent_id</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">azurerm_container_app</span><span style="color: #D73A49">.</span><span style="color: #24292E">ca_jcmsui</span><span style="color: #D73A49">.</span><span style="color: #24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  body</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    properties </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># The globalValidation section redirects any unauthorized users to the</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># Entra login page. The nice thing is that this process is handled entirely</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># by Azure-managed reverse proxies in front of Container Apps,</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># ensuring that unauthorized requests never reach the application itself.</span></span>
<span class="line"><span style="color: #24292E">      globalValidation </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        redirectToProvider          </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"azureActiveDirectory"</span></span>
<span class="line"><span style="color: #24292E">        unauthenticatedClientAction </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"RedirectToLoginPage"</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># Only a single identity provider, Entra, is configured.</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># The secret synchronized from Key Vault is also used here.</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># The current tenant's ID serves as the issuer, limiting access to </span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #6A737D"># (a subset of) users from the current tenant.</span></span>
<span class="line"><span style="color: #24292E">      identityProviders </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">        azureActiveDirectory </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">          enabled </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span></span>
<span class="line"><span style="color: #24292E">          registration </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">            clientId                </span><span style="color: #D73A49">=</span><span style="color: #24292E"> data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #24292E">            clientSecretSettingName </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #24292E">            openIdIssuer            </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"https://login.microsoftonline.com/</span><span style="color: #D73A49">${</span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_client_config</span><span style="color: #D73A49">.</span><span style="color: #24292E">current</span><span style="color: #D73A49">.</span><span style="color: #24292E">tenant_id</span><span style="color: #D73A49">}</span><span style="color: #032F62">/v2.0"</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">          validation </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">            defaultAuthorizationPolicy </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">              allowedApplications </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #6A737D"># This thing lets the App Registration to authorize</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #6A737D"># users to the application.</span></span>
<span class="line"><span style="color: #24292E">                data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #24292E">              ]</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">      </span><span style="color: #D73A49">...</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="hcl" data-theme="dark"><code data-language="hcl" data-theme="dark"><span class="line"><span style="color: #B392F0">resource</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"azapi_resource"</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"auth_ca_jcmsui"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  type</span><span style="color: #FFAB70">      </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"Microsoft.App/containerApps/authConfigs@2024-10-02-preview"</span></span>
<span class="line"><span style="color: #E1E4E8">  name</span><span style="color: #FFAB70">      </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #9ECBFF">"current"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># This `authConfigs` resource is a child of the Container App.</span></span>
<span class="line"><span style="color: #E1E4E8">  parent_id</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">azurerm_container_app</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ca_jcmsui</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">id</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  body</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    properties </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># The globalValidation section redirects any unauthorized users to the</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># Entra login page. The nice thing is that this process is handled entirely</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># by Azure-managed reverse proxies in front of Container Apps,</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># ensuring that unauthorized requests never reach the application itself.</span></span>
<span class="line"><span style="color: #E1E4E8">      globalValidation </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        redirectToProvider          </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"azureActiveDirectory"</span></span>
<span class="line"><span style="color: #E1E4E8">        unauthenticatedClientAction </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"RedirectToLoginPage"</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># Only a single identity provider, Entra, is configured.</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># The secret synchronized from Key Vault is also used here.</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># The current tenant's ID serves as the issuer, limiting access to </span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #6A737D"># (a subset of) users from the current tenant.</span></span>
<span class="line"><span style="color: #E1E4E8">      identityProviders </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">        azureActiveDirectory </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">          enabled </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">true</span></span>
<span class="line"><span style="color: #E1E4E8">          registration </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">            clientId                </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #E1E4E8">            clientSecretSettingName </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"jcms-entra-clientsecret"</span></span>
<span class="line"><span style="color: #E1E4E8">            openIdIssuer            </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"https://login.microsoftonline.com/</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_client_config</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">current</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">tenant_id</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">/v2.0"</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">          validation </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">            defaultAuthorizationPolicy </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">              allowedApplications </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> [</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #6A737D"># This thing lets the App Registration to authorize</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #6A737D"># users to the application.</span></span>
<span class="line"><span style="color: #E1E4E8">                data.azurerm_key_vault_secret.entra_clientid.value</span></span>
<span class="line"><span style="color: #E1E4E8">              ]</span></span>
<span class="line"><span style="color: #E1E4E8">            }</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">        }</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #F97583">...</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>Finally, the App Registration's redirect URIs are updated (in case the <code>authConfigs</code> resource was created or recreated), using the same hash-set approach as before. This time, the actual Container App's EasyAuth AAD redirect URI is enforced instead of the localhost one. Note that at this stage, the GitHub Actions‚Äìassociated Service Principal requires owner privileges:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="hcl" data-theme="light"><code data-language="hcl" data-theme="light"><span class="line"><span style="color: #6F42C1">resource</span><span style="color: #24292E"> </span><span style="color: #005CC5">"null_resource"</span><span style="color: #24292E"> </span><span style="color: #005CC5">"app_redirect_uris"</span><span style="color: #24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># This lifecycle ensures that the redirect URIs are updated in the </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># App Registration only when necessary ‚Äî that is, when the Container App </span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6A737D"># is (re-)created and receives a new external ingress URL.</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">lifecycle</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    replace_triggered_by</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">[azurerm_container_app</span><span style="color: #D73A49">.</span><span style="color: #24292E">ca_jcmsui]</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">  triggers</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    command </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">&#x3C;&#x3C;-EOT</span></span>
<span class="line"><span style="color: #032F62">      $redirectUris = @{ "https://</span><span style="color: #D73A49">${</span><span style="color: #24292E">azurerm_container_app</span><span style="color: #D73A49">.</span><span style="color: #24292E">ca_jcmsui</span><span style="color: #D73A49">.</span><span style="color: #24292E">ingress</span><span style="color: #032F62">[</span><span style="color: #005CC5">0</span><span style="color: #032F62">]</span><span style="color: #D73A49">.</span><span style="color: #24292E">fqdn</span><span style="color: #D73A49">}</span><span style="color: #032F62">/.auth/login/aad/callback" = $true }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">      $appRegDetails = (az ad app show --id "</span><span style="color: #D73A49">${</span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_key_vault_secret</span><span style="color: #D73A49">.</span><span style="color: #24292E">entra_clientid</span><span style="color: #D73A49">.</span><span style="color: #24292E">value</span><span style="color: #D73A49">}</span><span style="color: #032F62">" | ConvertFrom-Json)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">      foreach ($uri in $appRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #032F62">        $redirectUris[$uri] = $true</span></span>
<span class="line"><span style="color: #032F62">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #032F62">      az ad app update `</span></span>
<span class="line"><span style="color: #032F62">        --id "</span><span style="color: #D73A49">${</span><span style="color: #24292E">data</span><span style="color: #D73A49">.</span><span style="color: #24292E">azurerm_key_vault_secret</span><span style="color: #D73A49">.</span><span style="color: #24292E">entra_clientid</span><span style="color: #D73A49">.</span><span style="color: #24292E">value</span><span style="color: #D73A49">}</span><span style="color: #032F62">" `</span></span>
<span class="line"><span style="color: #032F62">        --web-redirect-uris $redirectUris.Keys `</span></span>
<span class="line"><span style="color: #032F62">        --output "none"</span></span>
<span class="line"><span style="color: #D73A49">    EOT</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">provisioner</span><span style="color: #24292E"> </span><span style="color: #005CC5">"local-exec"</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    command</span><span style="color: #E36209">     </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">self</span><span style="color: #D73A49">.</span><span style="color: #24292E">triggers</span><span style="color: #D73A49">.</span><span style="color: #24292E">command</span></span>
<span class="line"><span style="color: #24292E">    interpreter</span><span style="color: #E36209"> </span><span style="color: #D73A49">=</span><span style="color: #E36209"> </span><span style="color: #24292E">[</span><span style="color: #032F62">"pwsh"</span><span style="color: #24292E">, </span><span style="color: #032F62">"-Command"</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="hcl" data-theme="dark"><code data-language="hcl" data-theme="dark"><span class="line"><span style="color: #B392F0">resource</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"null_resource"</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"app_redirect_uris"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># This lifecycle ensures that the redirect URIs are updated in the </span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># App Registration only when necessary ‚Äî that is, when the Container App </span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #6A737D"># is (re-)created and receives a new external ingress URL.</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">lifecycle</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    replace_triggered_by</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">[azurerm_container_app</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ca_jcmsui]</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">  triggers</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    command </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x3C;&#x3C;-EOT</span></span>
<span class="line"><span style="color: #9ECBFF">      $redirectUris = @{ "https://</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">azurerm_container_app</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ca_jcmsui</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">ingress</span><span style="color: #9ECBFF">[</span><span style="color: #79B8FF">0</span><span style="color: #9ECBFF">]</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">fqdn</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">/.auth/login/aad/callback" = $true }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9ECBFF">      $appRegDetails = (az ad app show --id "</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_key_vault_secret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">entra_clientid</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">value</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">" | ConvertFrom-Json)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9ECBFF">      foreach ($uri in $appRegDetails.web.redirectUris) {</span></span>
<span class="line"><span style="color: #9ECBFF">        $redirectUris[$uri] = $true</span></span>
<span class="line"><span style="color: #9ECBFF">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9ECBFF">      az ad app update `</span></span>
<span class="line"><span style="color: #9ECBFF">        --id "</span><span style="color: #F97583">${</span><span style="color: #E1E4E8">data</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">azurerm_key_vault_secret</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">entra_clientid</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">value</span><span style="color: #F97583">}</span><span style="color: #9ECBFF">" `</span></span>
<span class="line"><span style="color: #9ECBFF">        --web-redirect-uris $redirectUris.Keys `</span></span>
<span class="line"><span style="color: #9ECBFF">        --output "none"</span></span>
<span class="line"><span style="color: #F97583">    EOT</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">provisioner</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">"local-exec"</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    command</span><span style="color: #FFAB70">     </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">self</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">triggers</span><span style="color: #F97583">.</span><span style="color: #E1E4E8">command</span></span>
<span class="line"><span style="color: #E1E4E8">    interpreter</span><span style="color: #FFAB70"> </span><span style="color: #F97583">=</span><span style="color: #FFAB70"> </span><span style="color: #E1E4E8">[</span><span style="color: #9ECBFF">"pwsh"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"-Command"</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>And just like that, a few hours of automation saved a few minutes of manual clicking. Happy coding!</p>b:["$","div",null,{"className":"flex justify-center","children":["$","div",null,{"className":"md:px-10 min-w-0 max-w-7xl mb-12","children":["$","article",null,{"children":[["$","header",null,{"className":"px-5 mb-4 py-10 relative","children":[["$","h1",null,{"className":"text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100","children":"Fully Automated EasyAuth"}],["$","time",null,{"dateTime":"2025-05-05 20:00","className":"pl-1 font-serif text-slate-400 bottom-0 absolute","children":[["$","svg",null,{"className":"h-4 w-4 inline-block","width":"24","height":"24","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":"2","strokeLinecap":"round","strokeLinejoin":"round","children":[["$","path",null,{"d":"M12 19l7-7 3 3-7 7-3-3z"}]," ",["$","path",null,{"d":"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}]," ",["$","path",null,{"d":"M2 2l7.586 7.586"}]," ",["$","circle",null,{"cx":"11","cy":"11","r":"2"}]]}]," ","2025-05-05 20:00"]}]]}],["$","div",null,{"className":"bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg","children":["$undefined",["$","div",null,{"className":"space-y-4","dangerouslySetInnerHTML":{"__html":"$c"}}]]}]]}]}]}]
a:null
