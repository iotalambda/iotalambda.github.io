1:HL["/_next/static/media/3d9ea938b6afa941-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/7eaa4a2482b4df1a-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/css/488301a2e2aae266.css",{"as":"style"}]
0:["buvIpSi0HPVceg6z1qEXG",[[["",{"children":[["id","2025/03/09/Blazor-with-TypeScript-Interop","c"],{"children":["__PAGE__?{\"id\":[\"2025\",\"03\",\"09\",\"Blazor-with-TypeScript-Interop\"]}",{}]}]},"$undefined","$undefined",true],"$L4",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/488301a2e2aae266.css","precedence":"next"}]],"$L5"]]]]
6:HL["/_next/static/css/301e7291452e98cd.css",{"as":"style"}]
7:I{"id":6685,"chunks":["685:static/chunks/685-a8c11ad368fada34.js","185:static/chunks/app/layout-0afbb0e01943be7f.js"],"name":"","async":false}
8:I{"id":7767,"chunks":["272:static/chunks/webpack-b2aba447c1dc2205.js","971:static/chunks/fd9d1056-a99b58d3cc150217.js","596:static/chunks/596-9d43875837bd0b65.js"],"name":"default","async":false}
9:I{"id":7920,"chunks":["272:static/chunks/webpack-b2aba447c1dc2205.js","971:static/chunks/fd9d1056-a99b58d3cc150217.js","596:static/chunks/596-9d43875837bd0b65.js"],"name":"default","async":false}
4:[null,["$","html",null,{"lang":"en","className":"__variable_965427 __variable_9c011f","children":["$","body",null,{"className":"bg-slate-200 dark:bg-slate-700","children":[["$","nav",null,{"className":"w-full flex flex-row justify-between bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans","children":["$","div",null,{"className":"p-2","children":["$","$L7",null,{"className":"text-2xl font-semibold text-neutral-100 dark:text-neutral-200","href":"/","children":[["$","h1",null,{"className":"inline","children":"üçî food for ai"}]," ",["$","span",null,{"className":"font-mono font-light text-xs","children":"food.joona.cloud"}]]}]}]}],["$","main",null,{"className":"mt-4","children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children",["id","2025/03/09/Blazor-with-TypeScript-Interop","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$La","$Lb",null],"segment":"__PAGE__?{\"id\":[\"2025\",\"03\",\"09\",\"Blazor-with-TypeScript-Interop\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/301e7291452e98cd.css","precedence":"next"}]]}],"segment":["id","2025/03/09/Blazor-with-TypeScript-Interop","c"]},"styles":[]}]}]]}]}],null]
5:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Blazor with TypeScript Interop | Food for AI blog"}],["$","meta","2",{"name":"description","content":"Blog about .NET, Azure, React and whatever comes to mind."}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","5",{"name":"next-size-adjust"}]]
c:T28183,<p>Blazor has supported JavaScript interop since <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/javascript-interoperability/?view=aspnetcore-3.1">day one</a>. It's fine and all, but it's still JavaScript and inherently dynamically typed. In this article, we take a look at one approach that allows us to use TypeScript instead. We use Vite to build distributable JavaScript modules from our TypeScript modules. In addition to having strong types, we aim to achieve some other quality-of-life improvements as well:</p>
<ul>
<li>Changes should propagate seamlessly between C#'s and TypeScript's type systems.</li>
<li>TypeScript type checking should be automatic whenever types change.</li>
<li>Vite should build automatically whenever the Blazor app is built...</li>
<li>...but <strong>should NOT</strong> build if there are no relevant changes.</li>
<li>The distributables built by Vite should be reloadable while the Blazor app is running by simply refreshing the page, without requiring a full restart. Hot-reload could be tricky, so let's keep it out of scope.</li>
</ul>
<p>In this article, we'll use Blazor WASM, but the approach also works with Interactive Server.</p>
<h2 id="the-approach"><a href="#the-approach">The approach</a></h2>
<p>Ideally, we'd like to have <em>adapters</em> that we can invoke in our C# code, for example:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="razor" data-theme="light"><code data-language="razor" data-theme="light"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">@inject</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BrowserConsoleAdapter</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BrowserConsole</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">button</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onclick</span><span style="color: #24292E">=</span><span style="color: #032F62">@(()</span><span style="color: #24292E"> </span><span style="color: #B31D28; font-style: italic">=</span><span style="color: #24292E">> BrowserConsole.LogAsync("Greetings!"))></span></span>
<span class="line"><span style="color: #24292E">    Log greetings to browser console</span></span>
<span class="line"><span style="color: #24292E">&#x3C;/</span><span style="color: #22863A">button</span><span style="color: #24292E">></span></span></code></pre><pre data-language="razor" data-theme="dark"><code data-language="razor" data-theme="dark"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">@inject</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">BrowserConsoleAdapter</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">BrowserConsole</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">button</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">onclick</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">@(()</span><span style="color: #E1E4E8"> </span><span style="color: #FDAEB7; font-style: italic">=</span><span style="color: #E1E4E8">> BrowserConsole.LogAsync("Greetings!"))></span></span>
<span class="line"><span style="color: #E1E4E8">    Log greetings to browser console</span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;/</span><span style="color: #85E89D">button</span><span style="color: #E1E4E8">></span></span></code></pre></div>
<p>The <code>BrowserConsoleAdapter</code> class should be <em>somehow</em> mapped to a TypeScript module that includes a corresponding function for the <code>LogAsync</code> method:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="typescript" data-theme="light"><code data-language="typescript" data-theme="light"><span class="line"><span style="color: #6A737D">// browserConsoleAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">logAsync</span><span style="color: #24292E">(</span><span style="color: #E36209">message</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(message)</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">default</span><span style="color: #24292E"> { logAsync } </span><span style="color: #D73A49">as</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IBrowserConsoleAdapter</span></span></code></pre><pre data-language="typescript" data-theme="dark"><code data-language="typescript" data-theme="dark"><span class="line"><span style="color: #6A737D">// browserConsoleAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">logAsync</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">message</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">  console.</span><span style="color: #B392F0">log</span><span style="color: #E1E4E8">(message)</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> { logAsync } </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IBrowserConsoleAdapter</span></span></code></pre></div>
<p>If the signature of the <code>LogAsync</code> method changes, or if methods are added or removed from the <code>BrowserConsoleAdapter</code> class, then when building the Blazor application, we would get a build-time error from TypeScript's type checking.</p>
<p>In the scenario above, click events originate from the <code>button</code> Blazor component, and its <code>onclick</code> callback method simply invokes the <code>logAsync</code> TypeScript function over interop. But what if we also wanted to do the opposite: have an event listener instantiated in TypeScript that invokes a C# handler method over interop?</p>
<p>Let's say we want to listen for all click events and send information about their positions to a C# handler method, <code>HandleClickAtAsync</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="razor" data-theme="light"><code data-language="razor" data-theme="light"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">ol</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">@foreach</span><span style="color: #24292E"> (</span><span style="color: #D73A49">var</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">x</span><span style="color: #24292E">, </span><span style="color: #6F42C1">y</span><span style="color: #24292E">) </span><span style="color: #D73A49">in</span><span style="color: #24292E"> clickPositions)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        &#x3C;</span><span style="color: #22863A">li</span><span style="color: #24292E">>Clicked at </span><span style="color: #D73A49">@</span><span style="color: #24292E">x, </span><span style="color: #D73A49">@</span><span style="color: #24292E">y.&#x3C;/</span><span style="color: #22863A">li</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">&#x3C;/</span><span style="color: #22863A">ol</span><span style="color: #24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">@code</span><span style="color: #24292E"> </span><span style="color: #D73A49">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">List</span><span style="color: #24292E">&#x3C;(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">X</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Y</span><span style="color: #24292E">)> </span><span style="color: #6F42C1">clickPositions</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    [</span><span style="color: #6F42C1">JSInvokable</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E"> </span><span style="color: #6F42C1">HandleClickAtAsync</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">y</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        clickPositions.</span><span style="color: #6F42C1">Add</span><span style="color: #24292E">((x, y));</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">StateHasChanged</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Task.CompletedTask;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #D73A49">}</span></span></code></pre><pre data-language="razor" data-theme="dark"><code data-language="razor" data-theme="dark"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">ol</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">@foreach</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> (</span><span style="color: #B392F0">x</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> clickPositions)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        &#x3C;</span><span style="color: #85E89D">li</span><span style="color: #E1E4E8">>Clicked at </span><span style="color: #F97583">@</span><span style="color: #E1E4E8">x, </span><span style="color: #F97583">@</span><span style="color: #E1E4E8">y.&#x3C;/</span><span style="color: #85E89D">li</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;/</span><span style="color: #85E89D">ol</span><span style="color: #E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">@code</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">List</span><span style="color: #E1E4E8">&#x3C;(</span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">X</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Y</span><span style="color: #E1E4E8">)> </span><span style="color: #B392F0">clickPositions</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    [</span><span style="color: #B392F0">JSInvokable</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">HandleClickAtAsync</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">x</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        clickPositions.</span><span style="color: #B392F0">Add</span><span style="color: #E1E4E8">((x, y));</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">StateHasChanged</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Task.CompletedTask;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #F97583">}</span></span></code></pre></div>
<p>We want to be able to register a TypeScript event listener that invokes this method on click events. The invocation should still be strongly typed, so if the signature of the <code>HandleClickAtAsync</code> method changes, we should see type check errors at build time.</p>
<h2 id="reinforcedtypings"><a href="#reinforcedtypings"><code>Reinforced.Typings</code></a></h2>
<p>There is an awesome .NET library for our type auto-generation needs: <a href="https://github.com/reinforced/Reinforced.Typings"><code>Reinforced.Typings</code></a>. It allows us to automatically convert C# types into TypeScript types at build time by simply annotating the C# types with attributes like <code>TsInterfaceAttribute</code>, which specifically generates a TypeScript interface.</p>
<p>A skeleton of the <code>BrowserConsoleAdapter</code> class annotated with <code>Reinforced.Typings</code> attributes would look like this:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// BrowserConsoleAdapter.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #6F42C1">TsInterface</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BrowserConsoleAdapter</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LogAsync</span><span style="color: #24292E">(</span><span style="color: #D73A49">string</span><span style="color: #24292E"> </span><span style="color: #6F42C1">message</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">throw</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">NotImplementedException</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// BrowserConsoleAdapter.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">[</span><span style="color: #B392F0">TsInterface</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">BrowserConsoleAdapter</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">LogAsync</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">string</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">message</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">throw</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">NotImplementedException</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>In order to make the TypeScript type generation match our specific needs, we add the following three files to our C# project:</p>
<ul>
<li><code>Reinforced.Typings.Assembly.cs</code></li>
<li><code>ReinforcedTypingsConfiguration.cs</code></li>
<li><code>Reinforced.Typings.settings.xml</code>.</li>
</ul>
<h3 id="reinforcedtypingsassemblycs"><a href="#reinforcedtypingsassemblycs"><code>Reinforced.Typings.Assembly.cs</code></a></h3>
<p>This file contains just an assembly marker, which sets some necessary and nice-to-have preferences. We don't necessarily need an entire dedicated file for this, but I still added one for code organization purposes:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// Reinforced.Typings.Assembly.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #D73A49">assembly</span><span style="color: #24292E">: </span><span style="color: #6F42C1">Reinforced</span><span style="color: #24292E">.</span><span style="color: #6F42C1">Typings</span><span style="color: #24292E">.</span><span style="color: #6F42C1">Attributes</span><span style="color: #24292E">.</span><span style="color: #6F42C1">TsGlobal</span><span style="color: #24292E">(</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">UseModules</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">DiscardNamespacesWhenUsingModules</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">TabSymbol</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"    "</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">CamelCaseForMethods</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">CamelCaseForProperties</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">true</span></span>
<span class="line"><span style="color: #24292E">)]</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// Reinforced.Typings.Assembly.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">[</span><span style="color: #F97583">assembly</span><span style="color: #E1E4E8">: </span><span style="color: #B392F0">Reinforced</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">Typings</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">Attributes</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">TsGlobal</span><span style="color: #E1E4E8">(</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">UseModules</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">DiscardNamespacesWhenUsingModules</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">TabSymbol</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"    "</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">CamelCaseForMethods</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">CamelCaseForProperties</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">true</span></span>
<span class="line"><span style="color: #E1E4E8">)]</span></span></code></pre></div>
<p><code>UseModules = true</code> makes the auto-generated TypeScript interfaces to be exported from a module and thus importable to our TypeScript handler implementations. <code>DiscardNamespacesWhenUsingModules = true</code> omits generating the interfaces inside TypeScript namespaces. <code>TabSymbol = "    "</code> makes the auto-generated code use four tabs for indentation (adjust this as needed). <code>CamelCaseForMethods = true</code> and <code>CamelCaseForProperties = true</code> do exactly as they state: make auto-generated method and property names use camel casing instead of C# style pascal casing. Note that <code>CamelCaseForProperties = true</code> affects both parameter and return types (in case complex types are used).</p>
<h3 id="reinforcedtypingsconfigurationcs"><a href="#reinforcedtypingsconfigurationcs"><code>ReinforcedTypingsConfiguration.cs</code></a></h3>
<p>In this file we set up a <code>ReinforcedTypingsConfiguration</code> class that is used for fine-tuning the default type generation logic:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// ReinforcedTypingsConfiguration.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ReinforcedTypingsConfiguration</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">void</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Configure</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Reinforced</span><span style="color: #24292E">.</span><span style="color: #6F42C1">Typings</span><span style="color: #24292E">.</span><span style="color: #6F42C1">Fluent</span><span style="color: #24292E">.</span><span style="color: #6F42C1">ConfigurationBuilder</span><span style="color: #24292E"> </span><span style="color: #6F42C1">builder</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        builder.</span><span style="color: #6F42C1">Substitute</span><span style="color: #24292E">(</span><span style="color: #D73A49">typeof</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Task</span><span style="color: #24292E">), </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">RtSimpleTypeName</span><span style="color: #24292E">(</span><span style="color: #032F62">"Promise&#x3C;void>"</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">        builder.</span><span style="color: #6F42C1">Substitute</span><span style="color: #24292E">(</span><span style="color: #D73A49">typeof</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Task</span><span style="color: #24292E">&#x3C;>), </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">RtSimpleTypeName</span><span style="color: #24292E">(</span><span style="color: #032F62">"Promise"</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">        builder.</span><span style="color: #6F42C1">Substitute</span><span style="color: #24292E">(</span><span style="color: #D73A49">typeof</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Task</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">IJSObjectReference</span><span style="color: #24292E">>), </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">RtSimpleTypeName</span><span style="color: #24292E">(</span><span style="color: #032F62">"Promise&#x3C;any>"</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">        builder.</span><span style="color: #6F42C1">SubstituteGeneric</span><span style="color: #24292E">(</span><span style="color: #D73A49">typeof</span><span style="color: #24292E">(</span><span style="color: #6F42C1">DotNetObjectReference</span><span style="color: #24292E">&#x3C;>), (</span><span style="color: #6F42C1">_</span><span style="color: #24292E">, </span><span style="color: #6F42C1">_</span><span style="color: #24292E">) </span><span style="color: #D73A49">=></span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">RtSimpleTypeName</span><span style="color: #24292E">(</span><span style="color: #032F62">"DotNet.DotNetObject"</span><span style="color: #24292E">));</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// ReinforcedTypingsConfiguration.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">static</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ReinforcedTypingsConfiguration</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">static</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">void</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Configure</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">Reinforced</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">Typings</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">Fluent</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">ConfigurationBuilder</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">builder</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        builder.</span><span style="color: #B392F0">Substitute</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">typeof</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8">), </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RtSimpleTypeName</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"Promise&#x3C;void>"</span><span style="color: #E1E4E8">));</span></span>
<span class="line"><span style="color: #E1E4E8">        builder.</span><span style="color: #B392F0">Substitute</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">typeof</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8">&#x3C;>), </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RtSimpleTypeName</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"Promise"</span><span style="color: #E1E4E8">));</span></span>
<span class="line"><span style="color: #E1E4E8">        builder.</span><span style="color: #B392F0">Substitute</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">typeof</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">IJSObjectReference</span><span style="color: #E1E4E8">>), </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RtSimpleTypeName</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"Promise&#x3C;any>"</span><span style="color: #E1E4E8">));</span></span>
<span class="line"><span style="color: #E1E4E8">        builder.</span><span style="color: #B392F0">SubstituteGeneric</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">typeof</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">DotNetObjectReference</span><span style="color: #E1E4E8">&#x3C;>), (</span><span style="color: #B392F0">_</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">_</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">RtSimpleTypeName</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"DotNet.DotNetObject"</span><span style="color: #E1E4E8">));</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>First, we set up type substitution between generic and non-generic <code>Task</code>s (C#) and <code>Promise</code>s (TypeScript), which is not configured by default.</p>
<p>We also configure type substitution specifically from <code>Task&#x3C;IJSObjectReference></code> (C#) to <code>Promise&#x3C;any></code> (TypeScript). This is necessary when a TypeScript handler returns a reference to a JavaScript object, and we want to access it in a C# invoker.</p>
<p>Finally, we set up substitution from the generic <code>DotNetObjectReference</code> (C#) to the non-generic <code>DotNet.DotNetObject</code> (TypeScript). This is required when passing a reference ‚Äî or more accurately, a handle ‚Äî of a .NET object to a TypeScript handler, for example when we want TypeScript to invoke a method on that .NET object. This type substitution instructs <code>Reinforced.Typings</code> to avoid generating corresponding TypeScript types for the C# types of the objects we pass as arguments. As such, this would reduce type safety because breaking changes to the signatures of the C# handler methods would not cause TypeScript type checking to fail. We'll need to address this later.</p>
<p>The <code>DotNet.DotNetObject</code> (TypeScript) type is exported by the <a href="https://www.npmjs.com/package/@types/blazor__javascript-interop"><code>@types/blazor__javascript-interop</code></a> package. It is used in the Vite project to provide TypeScript types corresponding to Blazor's built-in object reference types.</p>
<h3 id="reinforcedtypingssettingsxml"><a href="#reinforcedtypingssettingsxml"><code>Reinforced.Typings.settings.xml</code></a></h3>
<p>This file contains a piece of MSBuild script that is imported to the C# project file each time the project is built:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="xml" data-theme="light"><code data-language="xml" data-theme="light"><span class="line"><span style="color: #6A737D">&#x3C;!-- Reinforced.Typings.settings.xml --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&#x3C;?</span><span style="color: #22863A">xml</span><span style="color: #6F42C1"> version</span><span style="color: #24292E">=</span><span style="color: #032F62">"1.0"</span><span style="color: #6F42C1"> encoding</span><span style="color: #24292E">=</span><span style="color: #032F62">"utf-8"</span><span style="color: #24292E">?></span></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">Project</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ToolsVersion</span><span style="color: #24292E">=</span><span style="color: #032F62">"4.0"</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DefaultTargets</span><span style="color: #24292E">=</span><span style="color: #032F62">"Build"</span><span style="color: #24292E"> </span><span style="color: #6F42C1">xmlns</span><span style="color: #24292E">=</span><span style="color: #032F62">"http://schemas.microsoft.com/developer/msbuild/2003"</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    &#x3C;</span><span style="color: #22863A">PropertyGroup</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">        &#x3C;</span><span style="color: #22863A">RtTargetFile</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">            $(ProjectDir)Adapters\blazortsinteropexample\src\typings.ts</span></span>
<span class="line"><span style="color: #24292E">        &#x3C;/</span><span style="color: #22863A">RtTargetFile</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">        &#x3C;</span><span style="color: #22863A">RtConfigurationMethod</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">            BlazorTsInteropExample.Stuff.ReinforcedTypings.ReinforcedTypingsConfiguration.Configure</span></span>
<span class="line"><span style="color: #24292E">        &#x3C;/</span><span style="color: #22863A">RtConfigurationMethod</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    &#x3C;/</span><span style="color: #22863A">PropertyGroup</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">&#x3C;/</span><span style="color: #22863A">Project</span><span style="color: #24292E">></span></span></code></pre><pre data-language="xml" data-theme="dark"><code data-language="xml" data-theme="dark"><span class="line"><span style="color: #6A737D">&#x3C;!-- Reinforced.Typings.settings.xml --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;?</span><span style="color: #85E89D">xml</span><span style="color: #B392F0"> version</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"1.0"</span><span style="color: #B392F0"> encoding</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"utf-8"</span><span style="color: #E1E4E8">?></span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">Project</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ToolsVersion</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"4.0"</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DefaultTargets</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"Build"</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">xmlns</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"http://schemas.microsoft.com/developer/msbuild/2003"</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;</span><span style="color: #85E89D">PropertyGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">        &#x3C;</span><span style="color: #85E89D">RtTargetFile</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">            $(ProjectDir)Adapters\blazortsinteropexample\src\typings.ts</span></span>
<span class="line"><span style="color: #E1E4E8">        &#x3C;/</span><span style="color: #85E89D">RtTargetFile</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">        &#x3C;</span><span style="color: #85E89D">RtConfigurationMethod</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">            BlazorTsInteropExample.Stuff.ReinforcedTypings.ReinforcedTypingsConfiguration.Configure</span></span>
<span class="line"><span style="color: #E1E4E8">        &#x3C;/</span><span style="color: #85E89D">RtConfigurationMethod</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;/</span><span style="color: #85E89D">PropertyGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;/</span><span style="color: #85E89D">Project</span><span style="color: #E1E4E8">></span></span></code></pre></div>
<p>With the <code>RtTargetFile</code> property, we instruct <code>Reinforced.Typings</code> to generate the types in the <code>typings.ts</code> file inside the <code>blazortsinteropexample</code> Vite project, which contains our TypeScript code. We also configure <code>Reinforced.Typings</code> to use the static <code>Configure</code> method of the <code>ReinforcedTypingsConfiguration</code> class we just implemented.</p>
<h2 id="wiring-the-up-the-c-project"><a href="#wiring-the-up-the-c-project">Wiring the up the C# project</a></h2>
<p>Before creating the <code>blazortsinteropexample</code> Vite project, let's configure our C# project so that type auto-generation and the Vite project build process are integrated into the incremental MSBuild build process:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="xml" data-theme="light"><code data-language="xml" data-theme="light"><span class="line"><span style="color: #6A737D">&#x3C;!-- BlazorTsInteropExample.csproj --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">Project</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Sdk</span><span style="color: #24292E">=</span><span style="color: #032F62">"Microsoft.NET.Sdk.BlazorWebAssembly"</span><span style="color: #24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  &#x3C;</span><span style="color: #22863A">PropertyGroup</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    &#x3C;</span><span style="color: #22863A">RtSettingsXml</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">        $([MSBuild]::EnsureTrailingSlash($(MSBuildProjectDirectory)))Stuff/ReinforcedTypings/Reinforced.Typings.settings.xml</span></span>
<span class="line"><span style="color: #24292E">    &#x3C;/</span><span style="color: #22863A">RtSettingsXml</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">  &#x3C;/</span><span style="color: #22863A">PropertyGroup</span><span style="color: #24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  &#x3C;</span><span style="color: #22863A">ItemGroup</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    &#x3C;</span><span style="color: #22863A">Folder</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Include</span><span style="color: #24292E">=</span><span style="color: #032F62">"wwwroot\js\"</span><span style="color: #24292E"> /></span></span>
<span class="line"><span style="color: #24292E">  &#x3C;/</span><span style="color: #22863A">ItemGroup</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">  &#x3C;</span><span style="color: #22863A">Target</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Name</span><span style="color: #24292E">=</span><span style="color: #032F62">"CompileTypeScript"</span><span style="color: #24292E">>&#x3C;/</span><span style="color: #22863A">Target</span><span style="color: #24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">  &#x3C;</span><span style="color: #22863A">PropertyGroup</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    &#x3C;</span><span style="color: #22863A">ProjectDirWithTrailing</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">        $([MSBuild]::EnsureTrailingSlash($(MSBuildProjectDirectory)))</span></span>
<span class="line"><span style="color: #24292E">    &#x3C;/</span><span style="color: #22863A">ProjectDirWithTrailing</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">  &#x3C;/</span><span style="color: #22863A">PropertyGroup</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">  &#x3C;</span><span style="color: #22863A">Target</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Name</span><span style="color: #24292E">=</span><span style="color: #032F62">"RunNpmBuild"</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BeforeTargets</span><span style="color: #24292E">=</span><span style="color: #032F62">"Build"</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    &#x3C;</span><span style="color: #22863A">Exec</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Command</span><span style="color: #24292E">=</span><span style="color: #032F62">"pwsh -File $(ProjectDirWithTrailing)Build/build_library.ps1 $(ProjectDirWithTrailing)"</span><span style="color: #24292E"> /></span></span>
<span class="line"><span style="color: #24292E">  &#x3C;/</span><span style="color: #22863A">Target</span><span style="color: #24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&#x3C;/</span><span style="color: #22863A">Project</span><span style="color: #24292E">></span></span></code></pre><pre data-language="xml" data-theme="dark"><code data-language="xml" data-theme="dark"><span class="line"><span style="color: #6A737D">&#x3C;!-- BlazorTsInteropExample.csproj --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">Project</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Sdk</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"Microsoft.NET.Sdk.BlazorWebAssembly"</span><span style="color: #E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;</span><span style="color: #85E89D">PropertyGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;</span><span style="color: #85E89D">RtSettingsXml</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">        $([MSBuild]::EnsureTrailingSlash($(MSBuildProjectDirectory)))Stuff/ReinforcedTypings/Reinforced.Typings.settings.xml</span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;/</span><span style="color: #85E89D">RtSettingsXml</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;/</span><span style="color: #85E89D">PropertyGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;</span><span style="color: #85E89D">ItemGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;</span><span style="color: #85E89D">Folder</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Include</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"wwwroot\js\"</span><span style="color: #E1E4E8"> /></span></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;/</span><span style="color: #85E89D">ItemGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;</span><span style="color: #85E89D">Target</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Name</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"CompileTypeScript"</span><span style="color: #E1E4E8">>&#x3C;/</span><span style="color: #85E89D">Target</span><span style="color: #E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;</span><span style="color: #85E89D">PropertyGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;</span><span style="color: #85E89D">ProjectDirWithTrailing</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">        $([MSBuild]::EnsureTrailingSlash($(MSBuildProjectDirectory)))</span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;/</span><span style="color: #85E89D">ProjectDirWithTrailing</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;/</span><span style="color: #85E89D">PropertyGroup</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;</span><span style="color: #85E89D">Target</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Name</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"RunNpmBuild"</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">BeforeTargets</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"Build"</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    &#x3C;</span><span style="color: #85E89D">Exec</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Command</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">"pwsh -File $(ProjectDirWithTrailing)Build/build_library.ps1 $(ProjectDirWithTrailing)"</span><span style="color: #E1E4E8"> /></span></span>
<span class="line"><span style="color: #E1E4E8">  &#x3C;/</span><span style="color: #85E89D">Target</span><span style="color: #E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;/</span><span style="color: #85E89D">Project</span><span style="color: #E1E4E8">></span></span></code></pre></div>
<p>First, we set a value for the <code>RtSettingsXml</code> property so that <code>Reinforced.Typings</code> knows where to find its settings at build time. We ensure there are no extra or missing slashes in the settings file's path by using the MSBuild utility function <code>EnsureTrailingSlash</code>.</p>
<p>Next, we explicitly include the <code>wwwroot\js\</code> folder in the project so that the JavaScript distributables it contains will be included in the .NET publish output.</p>
<p>We also override the default <code>CompileTypeScript</code> MSBuild target with an empty one to prevent MSBuild from attempting to build the TypeScript files inside the Vite project as part of the build process.</p>
<p>Finally, we create a new MSBuild target called <code>RunNpmBuild</code>. This target runs the <code>build_library.ps1</code> script using <code>pwsh</code> for cross-platform compatibility. The <code>build_library.ps1</code> script handles the incremental build of the Vite project. Before the C# project is built, we check whether the Vite project needs to be built, attempt to build it if necessary, and place the JavaScript distributables in the <code>wwwroot\js\</code> folder.</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #6A737D"># build_library.ps1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">param</span><span style="color: #24292E">(</span></span>
<span class="line"><span style="color: #24292E">    [</span><span style="color: #D73A49">string</span><span style="color: #24292E">]$projectDirWithTrailing</span></span>
<span class="line"><span style="color: #24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">$librarySourceDir </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $projectDirWithTrailing </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">'Adapters/blazortsinteropexample'</span></span>
<span class="line"><span style="color: #24292E">$npmBuildOutDir </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $projectDirWithTrailing </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">'wwwroot/js'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">$npmBuildOutDirExists </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">Test-Path</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">Path $npmBuildOutDir</span></span>
<span class="line"><span style="color: #24292E">$npmBuildOutDirIsEmpty </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ($npmBuildOutDirExists) {</span></span>
<span class="line"><span style="color: #24292E">    (</span><span style="color: #005CC5">Get-ChildItem</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">Path $npmBuildOutDir </span><span style="color: #D73A49">-</span><span style="color: #24292E">Recurse).Count </span><span style="color: #D73A49">-eq</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">$true</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> ($npmBuildOutDirIsEmpty) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-Host</span><span style="color: #24292E"> </span><span style="color: #032F62">'NpmBuildOutDir is empty. Running npm install...'</span></span>
<span class="line"><span style="color: #24292E">    cd $librarySourceDir</span></span>
<span class="line"><span style="color: #24292E">    npm install</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">Write-Host</span><span style="color: #24292E"> </span><span style="color: #032F62">'Building the library...'</span></span>
<span class="line"><span style="color: #24292E">    npm run build</span></span>
<span class="line"><span style="color: #24292E">} </span><span style="color: #D73A49">else</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    $dateA </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #005CC5">Get-ChildItem</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">LiteralPath $librarySourceDir </span><span style="color: #D73A49">-</span><span style="color: #24292E">File </span><span style="color: #D73A49">-</span><span style="color: #24292E">Recurse </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Where-Object</span><span style="color: #24292E"> { </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.FullName </span><span style="color: #D73A49">-notlike</span><span style="color: #24292E"> </span><span style="color: #032F62">'*\node_modules\*'</span><span style="color: #24292E"> </span><span style="color: #D73A49">-and</span><span style="color: #24292E"> </span><span style="color: #005CC5">$_</span><span style="color: #24292E">.Name </span><span style="color: #D73A49">-ne</span><span style="color: #24292E"> </span><span style="color: #032F62">'typings.ts'</span><span style="color: #24292E"> } </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Sort-Object</span><span style="color: #24292E"> LastWriteTime </span><span style="color: #D73A49">-</span><span style="color: #24292E">Descending </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Select-Object</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">First </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    ).LastWriteTime</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    $dateB </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #005CC5">Get-ChildItem</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">LiteralPath $npmBuildOutDir </span><span style="color: #D73A49">-</span><span style="color: #24292E">File </span><span style="color: #D73A49">-</span><span style="color: #24292E">Recurse </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Sort-Object</span><span style="color: #24292E"> LastWriteTime </span><span style="color: #D73A49">-</span><span style="color: #24292E">Descending </span><span style="color: #D73A49">|</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Select-Object</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E">First </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #24292E">    ).LastWriteTime</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> ($dateA </span><span style="color: #D73A49">-gt</span><span style="color: #24292E"> $dateB) {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">Write-Host</span><span style="color: #24292E"> </span><span style="color: #032F62">'Library source files are newer than dist. Building the library...'</span></span>
<span class="line"><span style="color: #24292E">        cd $librarySourceDir</span></span>
<span class="line"><span style="color: #24292E">        npm run build</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #6A737D"># build_library.ps1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">param</span><span style="color: #E1E4E8">(</span></span>
<span class="line"><span style="color: #E1E4E8">    [</span><span style="color: #F97583">string</span><span style="color: #E1E4E8">]$projectDirWithTrailing</span></span>
<span class="line"><span style="color: #E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">$librarySourceDir </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> $projectDirWithTrailing </span><span style="color: #F97583">+</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'Adapters/blazortsinteropexample'</span></span>
<span class="line"><span style="color: #E1E4E8">$npmBuildOutDir </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> $projectDirWithTrailing </span><span style="color: #F97583">+</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'wwwroot/js'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">$npmBuildOutDirExists </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">Test-Path</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">Path $npmBuildOutDir</span></span>
<span class="line"><span style="color: #E1E4E8">$npmBuildOutDirIsEmpty </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($npmBuildOutDirExists) {</span></span>
<span class="line"><span style="color: #E1E4E8">    (</span><span style="color: #79B8FF">Get-ChildItem</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">Path $npmBuildOutDir </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">Recurse).Count </span><span style="color: #F97583">-eq</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span></span>
<span class="line"><span style="color: #E1E4E8">} </span><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">$true</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($npmBuildOutDirIsEmpty) {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-Host</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'NpmBuildOutDir is empty. Running npm install...'</span></span>
<span class="line"><span style="color: #E1E4E8">    cd $librarySourceDir</span></span>
<span class="line"><span style="color: #E1E4E8">    npm install</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">Write-Host</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'Building the library...'</span></span>
<span class="line"><span style="color: #E1E4E8">    npm run build</span></span>
<span class="line"><span style="color: #E1E4E8">} </span><span style="color: #F97583">else</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    $dateA </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span><span style="color: #79B8FF">Get-ChildItem</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">LiteralPath $librarySourceDir </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">File </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">Recurse </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Where-Object</span><span style="color: #E1E4E8"> { </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.FullName </span><span style="color: #F97583">-notlike</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'*\node_modules\*'</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-and</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">$_</span><span style="color: #E1E4E8">.Name </span><span style="color: #F97583">-ne</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'typings.ts'</span><span style="color: #E1E4E8"> } </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Sort-Object</span><span style="color: #E1E4E8"> LastWriteTime </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">Descending </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Select-Object</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">First </span><span style="color: #79B8FF">1</span></span>
<span class="line"><span style="color: #E1E4E8">    ).LastWriteTime</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    $dateB </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span><span style="color: #79B8FF">Get-ChildItem</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">LiteralPath $npmBuildOutDir </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">File </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">Recurse </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Sort-Object</span><span style="color: #E1E4E8"> LastWriteTime </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">Descending </span><span style="color: #F97583">|</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Select-Object</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8">First </span><span style="color: #79B8FF">1</span></span>
<span class="line"><span style="color: #E1E4E8">    ).LastWriteTime</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> ($dateA </span><span style="color: #F97583">-gt</span><span style="color: #E1E4E8"> $dateB) {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">Write-Host</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'Library source files are newer than dist. Building the library...'</span></span>
<span class="line"><span style="color: #E1E4E8">        cd $librarySourceDir</span></span>
<span class="line"><span style="color: #E1E4E8">        npm run build</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span></code></pre></div>
<p>So we simply check if:</p>
<ul>
<li>There are no JavaScript distributables yet in the <code>wwwroot/js</code> directory,</li>
<li>OR if any files in the Vite project have a more recent <code>LastWriteTime</code> than the current distributables.</li>
</ul>
<p>If either condition is met, the Vite project is built. Note that we exclude the <code>typings.ts</code> file from the <code>LastWriteTime</code> comparison because <code>Reinforced.Typings</code> can regenerate the file even when no actual changes have been made.</p>
<h2 id="creating-the-vite-project"><a href="#creating-the-vite-project">Creating the Vite Project</a></h2>
<p>To create the Vite project, one should navigate to the desired directory ‚Äî <code>Adapters/</code> under the C# project directory in our case ‚Äî and run the following command:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="sh" data-theme="light"><code data-language="sh" data-theme="light"><span class="line"><span style="color: #6F42C1">npm</span><span style="color: #24292E"> </span><span style="color: #032F62">create</span><span style="color: #24292E"> </span><span style="color: #032F62">vite@latest</span></span>
<span class="line"></span></code></pre><pre data-language="sh" data-theme="dark"><code data-language="sh" data-theme="dark"><span class="line"><span style="color: #B392F0">npm</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">create</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">vite@latest</span></span>
<span class="line"></span></code></pre></div>
<p>In our case the project name is <code>blazortsinteropexample</code> and we want to use the vanilla Vite and the TypeScript variant.</p>
<p>Next, we install <code>@types/blazor__javascript-interop</code> as a dev dependency:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="sh" data-theme="light"><code data-language="sh" data-theme="light"><span class="line"><span style="color: #6F42C1">npm</span><span style="color: #24292E"> </span><span style="color: #032F62">install</span><span style="color: #24292E"> </span><span style="color: #005CC5">--save-dev</span><span style="color: #24292E"> </span><span style="color: #032F62">@types/blazor__javascript-interop</span></span></code></pre><pre data-language="sh" data-theme="dark"><code data-language="sh" data-theme="dark"><span class="line"><span style="color: #B392F0">npm</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">install</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">--save-dev</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">@types/blazor__javascript-interop</span></span></code></pre></div>
<p>Finally, since we use Prettier for code formatting, we want to exclude the auto-generated <code>typings.ts</code> file from its scope by adding a <code>.prettierignore</code> file under the Vite project with the following content:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="powershell" data-theme="light"><code data-language="powershell" data-theme="light"><span class="line"><span style="color: #24292E">typings.ts</span></span></code></pre><pre data-language="powershell" data-theme="dark"><code data-language="powershell" data-theme="dark"><span class="line"><span style="color: #E1E4E8">typings.ts</span></span></code></pre></div>
<p>Assuming we have added the previously discussed <code>BrowserConsoleAdapter</code> skeleton to the C# project and run MSBuild, we should see the <code>typings.ts</code> file generated under the <code>src</code> directory of the Vite project with the following content:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="typescript" data-theme="light"><code data-language="typescript" data-theme="light"><span class="line"><span style="color: #6A737D">//     This code was generated by a Reinforced.Typings tool.</span></span>
<span class="line"><span style="color: #6A737D">//     Changes to this file may cause incorrect behavior and will be lost if</span></span>
<span class="line"><span style="color: #6A737D">//     the code is regenerated.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">interface</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IBrowserConsoleAdapter</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">logAsync</span><span style="color: #24292E">(</span><span style="color: #E36209">message</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">)</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Promise</span><span style="color: #24292E">&#x3C;</span><span style="color: #005CC5">void</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="typescript" data-theme="dark"><code data-language="typescript" data-theme="dark"><span class="line"><span style="color: #6A737D">//     This code was generated by a Reinforced.Typings tool.</span></span>
<span class="line"><span style="color: #6A737D">//     Changes to this file may cause incorrect behavior and will be lost if</span></span>
<span class="line"><span style="color: #6A737D">//     the code is regenerated.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IBrowserConsoleAdapter</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">logAsync</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">message</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Promise</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #79B8FF">void</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>Next, let's implement the <code>logAsync</code> TypeScript handler according to the earlier planned approach:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="typescript" data-theme="light"><code data-language="typescript" data-theme="light"><span class="line"><span style="color: #6A737D">// browserConsoleAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> { IBrowserConsoleAdapter } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">"./typings"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">logAsync</span><span style="color: #24292E">(</span><span style="color: #E36209">message</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">  console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(message)</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">default</span><span style="color: #24292E"> { logAsync } </span><span style="color: #D73A49">as</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IBrowserConsoleAdapter</span></span></code></pre><pre data-language="typescript" data-theme="dark"><code data-language="typescript" data-theme="dark"><span class="line"><span style="color: #6A737D">// browserConsoleAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { IBrowserConsoleAdapter } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"./typings"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">logAsync</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">message</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">  console.</span><span style="color: #B392F0">log</span><span style="color: #E1E4E8">(message)</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> { logAsync } </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IBrowserConsoleAdapter</span></span></code></pre></div>
<p>Note that the last line, <code>export default { logAsync } as IBrowserConsoleAdapter</code>, binds everything together and ensures strong type safety:</p>
<ul>
<li>If members are added to or removed from the <code>BrowserConsoleAdapter</code> C# class, equivalent changes <strong>must</strong> be made to the <code>browserConsoleAdapter.ts</code> module's default export; otherwise, the Vite build ‚Äî and this the MSBuild ‚Äî will fail. üéâ</li>
<li>If the signature of an existing member in the <code>BrowserConsoleAdapter</code> C# class changes, equivalent changes <strong>must</strong> be made to the <code>browserConsoleAdapter.ts</code> module's default export; otherwise, the Vite build ‚Äî and thus the MSBuild ‚Äî will fail. üéâ</li>
</ul>
<p>Finally, let's configure Vite to generate a <code>browserConsoleAdapter.js</code> module from the <code>browserConsoleAdapter.ts</code> module during the build process and output it to the JavaScript distributables directory under <code>wwwroot/js</code>. Let's make the following changes to the <code>vite.config.js</code> file:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="javascript" data-theme="light"><code data-language="javascript" data-theme="light"><span class="line"><span style="color: #6A737D">// vite.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> { defineConfig } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">"vite"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">default</span><span style="color: #24292E"> </span><span style="color: #6F42C1">defineConfig</span><span style="color: #24292E">({</span></span>
<span class="line"><span style="color: #24292E">  build: {</span></span>
<span class="line"><span style="color: #24292E">    emptyOutDir: </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    outDir: </span><span style="color: #032F62">"../../wwwroot/js/dist"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    lib: {</span></span>
<span class="line"><span style="color: #24292E">      entry: [</span><span style="color: #032F62">"src/browserConsoleAdapter.ts"</span><span style="color: #24292E">],</span></span>
<span class="line"><span style="color: #24292E">      formats: [</span><span style="color: #032F62">"es"</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">})</span></span></code></pre><pre data-language="javascript" data-theme="dark"><code data-language="javascript" data-theme="dark"><span class="line"><span style="color: #6A737D">// vite.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { defineConfig } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"vite"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">defineConfig</span><span style="color: #E1E4E8">({</span></span>
<span class="line"><span style="color: #E1E4E8">  build: {</span></span>
<span class="line"><span style="color: #E1E4E8">    emptyOutDir: </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    outDir: </span><span style="color: #9ECBFF">"../../wwwroot/js/dist"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    lib: {</span></span>
<span class="line"><span style="color: #E1E4E8">      entry: [</span><span style="color: #9ECBFF">"src/browserConsoleAdapter.ts"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">      formats: [</span><span style="color: #9ECBFF">"es"</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">})</span></span></code></pre></div>
<p>We configure Vite to first clear the <code>wwwroot/js/dist</code> directory and then output the built JavaScript module for the <code>browserConsoleAdapter.ts</code> TypeScript module/entry point in the ESModule format. This allows us to import each module separately, either eagerly or lazily, as needed.</p>
<h2 id="browserconsoleadapter--from-c-to-typescript"><a href="#browserconsoleadapter--from-c-to-typescript"><code>BrowserConsoleAdapter</code> ‚Äì from C# to TypeScript</a></h2>
<p>Let's finalize the implementation of the <code>BrowserConsoleAdapter</code> class skeleton that we added earlier. To invoke the <code>logAsync</code> (TypeScript) function from the adapter, it first needs to ensure that the <code>browserConsoleAdapter.js</code> module has been imported. After that, it can invoke the <code>logAsync</code> function, which has been exported as part of the <code>default</code> object:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// BrowserConsoleAdapter.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #6F42C1">TsInterface</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BrowserConsoleAdapter</span><span style="color: #24292E">(IJSRuntime js)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">IJSObjectReference</span><span style="color: #24292E">? </span><span style="color: #6F42C1">module</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E"> </span><span style="color: #6F42C1">LogAsync</span><span style="color: #24292E">(</span><span style="color: #D73A49">string</span><span style="color: #24292E"> </span><span style="color: #6F42C1">message</span><span style="color: #24292E">, [</span><span style="color: #6F42C1">TsIgnore</span><span style="color: #24292E">] </span><span style="color: #6F42C1">CancellationToken</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cancellationToken</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> default)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        module </span><span style="color: #D73A49">??=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ImportModule</span><span style="color: #24292E">(cancellationToken);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">await</span><span style="color: #24292E"> module.</span><span style="color: #6F42C1">InvokeVoidAsync</span><span style="color: #24292E">(</span><span style="color: #032F62">"default.logAsync"</span><span style="color: #24292E">, cancellationToken, [message]);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    [</span><span style="color: #6F42C1">TsIgnore</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">IJSObjectReference</span><span style="color: #24292E">> </span><span style="color: #6F42C1">ImportModule</span><span style="color: #24292E">(</span><span style="color: #6F42C1">CancellationToken</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cancellationToken</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> js.</span><span style="color: #6F42C1">InvokeAsync</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">IJSObjectReference</span><span style="color: #24292E">>(</span><span style="color: #032F62">"import"</span><span style="color: #24292E">, cancellationToken, </span><span style="color: #032F62">"./js/dist/browserConsoleAdapter.js"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// BrowserConsoleAdapter.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">[</span><span style="color: #B392F0">TsInterface</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">BrowserConsoleAdapter</span><span style="color: #E1E4E8">(IJSRuntime js)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">IJSObjectReference</span><span style="color: #E1E4E8">? </span><span style="color: #B392F0">module</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">LogAsync</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">string</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">message</span><span style="color: #E1E4E8">, [</span><span style="color: #B392F0">TsIgnore</span><span style="color: #E1E4E8">] </span><span style="color: #B392F0">CancellationToken</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cancellationToken</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> default)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        module </span><span style="color: #F97583">??=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ImportModule</span><span style="color: #E1E4E8">(cancellationToken);</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> module.</span><span style="color: #B392F0">InvokeVoidAsync</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"default.logAsync"</span><span style="color: #E1E4E8">, cancellationToken, [message]);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    [</span><span style="color: #B392F0">TsIgnore</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">IJSObjectReference</span><span style="color: #E1E4E8">> </span><span style="color: #B392F0">ImportModule</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">CancellationToken</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cancellationToken</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> js.</span><span style="color: #B392F0">InvokeAsync</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">IJSObjectReference</span><span style="color: #E1E4E8">>(</span><span style="color: #9ECBFF">"import"</span><span style="color: #E1E4E8">, cancellationToken, </span><span style="color: #9ECBFF">"./js/dist/browserConsoleAdapter.js"</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>We can inject <code>IJSRuntime</code> into the <code>BrowserConsoleAdapter</code> object and use it to import the <code>browserConsoleAdapter.js</code> module located in the <code>wwwroot/js/dist</code> directory.</p>
<p>Note that we annotate the <code>ImportModule</code> method with <code>TsIgnoreAttribute</code> to exclude it from the <code>typings.ts</code> auto-generation. We also add a <code>CancellationToken</code> parameter to the <code>LogAsync</code> method so that both the import and the remote invocation over interop can be gracefully canceled if needed. This parameter is also annotated with <code>TsIgnoreAttribute</code> because we don't want to pass <code>CancellationToken</code> objects as serialized JSON over interop.</p>
<p>Using <code>??=</code>, we ensure that the module import is attempted only once within the scope of a single adapter object. If another adapter object is instantiated and the import is attempted again, the usual JavaScript module caching conventions of the user's browser apply.</p>
<p>Let's add the <code>BrowserConsoleAdapter</code> class as a scoped service to the C# project's Dependency Injection container in the <code>Program.cs</code> file and use it to print greetings to the browser console:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// Program.cs</span></span>
<span class="line"><span style="color: #24292E">builder.Services.</span><span style="color: #6F42C1">AddScoped</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">BrowserConsoleAdapter</span><span style="color: #24292E">>();</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// Program.cs</span></span>
<span class="line"><span style="color: #E1E4E8">builder.Services.</span><span style="color: #B392F0">AddScoped</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">BrowserConsoleAdapter</span><span style="color: #E1E4E8">>();</span></span></code></pre></div>
<div data-rehype-pretty-code-fragment=""><pre data-language="razor" data-theme="light"><code data-language="razor" data-theme="light"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">@inject</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BrowserConsoleAdapter</span><span style="color: #24292E"> </span><span style="color: #6F42C1">BrowserConsole</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">h1</span><span style="color: #24292E">>C# ‚Üí TypeScript&#x3C;/</span><span style="color: #22863A">h1</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">button</span><span style="color: #24292E"> </span><span style="color: #6F42C1">onclick</span><span style="color: #24292E">=</span><span style="color: #032F62">@(()</span><span style="color: #24292E"> </span><span style="color: #B31D28; font-style: italic">=</span><span style="color: #24292E">> BrowserConsole.LogAsync("Greetings!"))></span></span>
<span class="line"><span style="color: #24292E">    Log greetings to browser console</span></span>
<span class="line"><span style="color: #24292E">&#x3C;/</span><span style="color: #22863A">button</span><span style="color: #24292E">></span></span></code></pre><pre data-language="razor" data-theme="dark"><code data-language="razor" data-theme="dark"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">@inject</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">BrowserConsoleAdapter</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">BrowserConsole</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">h1</span><span style="color: #E1E4E8">>C# ‚Üí TypeScript&#x3C;/</span><span style="color: #85E89D">h1</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">button</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">onclick</span><span style="color: #E1E4E8">=</span><span style="color: #9ECBFF">@(()</span><span style="color: #E1E4E8"> </span><span style="color: #FDAEB7; font-style: italic">=</span><span style="color: #E1E4E8">> BrowserConsole.LogAsync("Greetings!"))></span></span>
<span class="line"><span style="color: #E1E4E8">    Log greetings to browser console</span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;/</span><span style="color: #85E89D">button</span><span style="color: #E1E4E8">></span></span></code></pre></div>
<p>Now, if we build and launch the Blazor application, the <code>button</code> component is shown which prints greetings to the browser console when clicked.</p>
<h2 id="pointereventsadapter--from-typescript-to-c"><a href="#pointereventsadapter--from-typescript-to-c"><code>PointerEventsAdapter</code> ‚Äì from TypeScript to C#</a></h2>
<p>Earlier, we added the <code>HandleClickAtAsync</code> C# handler method to the <code>Home.razor</code> file. We want this method to be invoked whenever a user clicks on the page.</p>
<p>The TypeScript invoker must have access to a <code>DotNet.DotNetObject</code> (TypeScript) handle for the <code>Home</code> component object that will handle the invocation. While initializing the <code>Home</code> component, let's create a <code>DotNetObjectReference</code> (C#) handle that refers to the <code>Home</code> component object itself:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="razor" data-theme="light"><code data-language="razor" data-theme="light"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">@inject</span><span style="color: #24292E"> </span><span style="color: #6F42C1">PointerEventsAdapter</span><span style="color: #24292E"> </span><span style="color: #6F42C1">PointerEvents</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">h1</span><span style="color: #24292E">>TypeScript ‚Üí C#&#x3C;/</span><span style="color: #22863A">h1</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">&#x3C;</span><span style="color: #22863A">ol</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">@foreach</span><span style="color: #24292E"> (</span><span style="color: #D73A49">var</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">x</span><span style="color: #24292E">, </span><span style="color: #6F42C1">y</span><span style="color: #24292E">) </span><span style="color: #D73A49">in</span><span style="color: #24292E"> clickPositions)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        &#x3C;</span><span style="color: #22863A">li</span><span style="color: #24292E">>Clicked at </span><span style="color: #D73A49">@</span><span style="color: #24292E">x, </span><span style="color: #D73A49">@</span><span style="color: #24292E">y.&#x3C;/</span><span style="color: #22863A">li</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">&#x3C;/</span><span style="color: #22863A">ol</span><span style="color: #24292E">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">@code</span><span style="color: #24292E"> </span><span style="color: #D73A49">{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">DotNetObjectReference</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">Home</span><span style="color: #24292E">>? </span><span style="color: #6F42C1">selfReference</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">List</span><span style="color: #24292E">&#x3C;(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">X</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Y</span><span style="color: #24292E">)> </span><span style="color: #6F42C1">clickPositions</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">protected</span><span style="color: #24292E"> </span><span style="color: #D73A49">override</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E"> </span><span style="color: #6F42C1">OnInitializedAsync</span><span style="color: #24292E">()</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        selfReference </span><span style="color: #D73A49">=</span><span style="color: #24292E"> DotNetObjectReference.</span><span style="color: #6F42C1">Create</span><span style="color: #24292E">(</span><span style="color: #D73A49">this</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">await</span><span style="color: #24292E"> PointerEvents.</span><span style="color: #6F42C1">AddForHandlerAsync</span><span style="color: #24292E">(selfReference, default);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    [</span><span style="color: #6F42C1">JSInvokable</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E"> </span><span style="color: #6F42C1">HandleClickAtAsync</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">y</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        clickPositions.</span><span style="color: #6F42C1">Add</span><span style="color: #24292E">((x, y));</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6F42C1">StateHasChanged</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> Task.CompletedTask;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #D73A49">}</span></span></code></pre><pre data-language="razor" data-theme="dark"><code data-language="razor" data-theme="dark"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">@inject</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PointerEventsAdapter</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PointerEvents</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">h1</span><span style="color: #E1E4E8">>TypeScript ‚Üí C#&#x3C;/</span><span style="color: #85E89D">h1</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;</span><span style="color: #85E89D">ol</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">@foreach</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> (</span><span style="color: #B392F0">x</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> clickPositions)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        &#x3C;</span><span style="color: #85E89D">li</span><span style="color: #E1E4E8">>Clicked at </span><span style="color: #F97583">@</span><span style="color: #E1E4E8">x, </span><span style="color: #F97583">@</span><span style="color: #E1E4E8">y.&#x3C;/</span><span style="color: #85E89D">li</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">&#x3C;/</span><span style="color: #85E89D">ol</span><span style="color: #E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">@code</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">{</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">DotNetObjectReference</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">Home</span><span style="color: #E1E4E8">>? </span><span style="color: #B392F0">selfReference</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">List</span><span style="color: #E1E4E8">&#x3C;(</span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">X</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Y</span><span style="color: #E1E4E8">)> </span><span style="color: #B392F0">clickPositions</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">protected</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">override</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">OnInitializedAsync</span><span style="color: #E1E4E8">()</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        selfReference </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> DotNetObjectReference.</span><span style="color: #B392F0">Create</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">this</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> PointerEvents.</span><span style="color: #B392F0">AddForHandlerAsync</span><span style="color: #E1E4E8">(selfReference, default);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    [</span><span style="color: #B392F0">JSInvokable</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">HandleClickAtAsync</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">x</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        clickPositions.</span><span style="color: #B392F0">Add</span><span style="color: #E1E4E8">((x, y));</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #B392F0">StateHasChanged</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> Task.CompletedTask;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #F97583">}</span></span></code></pre></div>
<p>We also inject a <code>PointerEventsAdapter</code> object into the component and invoke its <code>AddForHandlerAsync</code> method. This method essentially passes the <code>DotNetObjectReference&#x3C;Home></code> (C#) handle from C# to TypeScript by invoking the <code>addForHandlerAsync</code> handler function of <code>pointerEventsAdapter.js</code>, a new JavaScript module that will be introduced shortly.</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// PointerEventsAdapter.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #6F42C1">TsInterface</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">class</span><span style="color: #24292E"> </span><span style="color: #6F42C1">PointerEventsAdapter</span><span style="color: #24292E">(IJSRuntime js) : </span><span style="color: #6F42C1">IAsyncDisposable</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">IJSObjectReference</span><span style="color: #24292E">? </span><span style="color: #6F42C1">module</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E"> </span><span style="color: #6F42C1">AddForHandlerAsync</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">THandler</span><span style="color: #24292E">>(</span><span style="color: #6F42C1">DotNetObjectReference</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">THandler</span><span style="color: #24292E">> </span><span style="color: #6F42C1">handlerReference</span><span style="color: #24292E">, [</span><span style="color: #6F42C1">TsIgnore</span><span style="color: #24292E">] </span><span style="color: #6F42C1">CancellationToken</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cancellationToken</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">where</span><span style="color: #24292E"> </span><span style="color: #6F42C1">THandler</span><span style="color: #24292E"> : </span><span style="color: #D73A49">class</span><span style="color: #24292E">, </span><span style="color: #6F42C1">IPointerEventsAdapterHandler</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        module </span><span style="color: #D73A49">??=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ImportModule</span><span style="color: #24292E">(cancellationToken);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">await</span><span style="color: #24292E"> module.</span><span style="color: #6F42C1">InvokeVoidAsync</span><span style="color: #24292E">(</span><span style="color: #032F62">"default.addForHandlerAsync"</span><span style="color: #24292E">, cancellationToken, [handlerReference]);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    [</span><span style="color: #6F42C1">TsIgnore</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">IJSObjectReference</span><span style="color: #24292E">> </span><span style="color: #6F42C1">ImportModule</span><span style="color: #24292E">(</span><span style="color: #6F42C1">CancellationToken</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cancellationToken</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> js.</span><span style="color: #6F42C1">InvokeAsync</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">IJSObjectReference</span><span style="color: #24292E">>(</span><span style="color: #032F62">"import"</span><span style="color: #24292E">, cancellationToken, </span><span style="color: #032F62">"./js/dist/pointerEventsAdapter.js"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// PointerEventsAdapter.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">[</span><span style="color: #B392F0">TsInterface</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">class</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PointerEventsAdapter</span><span style="color: #E1E4E8">(IJSRuntime js) : </span><span style="color: #B392F0">IAsyncDisposable</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">IJSObjectReference</span><span style="color: #E1E4E8">? </span><span style="color: #B392F0">module</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">AddForHandlerAsync</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8">>(</span><span style="color: #B392F0">DotNetObjectReference</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8">> </span><span style="color: #B392F0">handlerReference</span><span style="color: #E1E4E8">, [</span><span style="color: #B392F0">TsIgnore</span><span style="color: #E1E4E8">] </span><span style="color: #B392F0">CancellationToken</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cancellationToken</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">where</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8"> : </span><span style="color: #F97583">class</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">IPointerEventsAdapterHandler</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        module </span><span style="color: #F97583">??=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ImportModule</span><span style="color: #E1E4E8">(cancellationToken);</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> module.</span><span style="color: #B392F0">InvokeVoidAsync</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"default.addForHandlerAsync"</span><span style="color: #E1E4E8">, cancellationToken, [handlerReference]);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    [</span><span style="color: #B392F0">TsIgnore</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">IJSObjectReference</span><span style="color: #E1E4E8">> </span><span style="color: #B392F0">ImportModule</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">CancellationToken</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cancellationToken</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> js.</span><span style="color: #B392F0">InvokeAsync</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">IJSObjectReference</span><span style="color: #E1E4E8">>(</span><span style="color: #9ECBFF">"import"</span><span style="color: #E1E4E8">, cancellationToken, </span><span style="color: #9ECBFF">"./js/dist/pointerEventsAdapter.js"</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>Instead of requiring the passed <code>DotNetObjectReference</code> handle to strictly refer to a <code>Home</code> component object, we use a generic parameter <code>THandler</code> with an interface constraint. This allows any class implementing the <code>IPointerEventsAdapterHandler</code> interface to be used for instantiating compatible C# handler objects.</p>
<p>So, let's create the <code>IPointerEventsAdapterHandler</code> interface and make the <code>Home</code> component implement it:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// IPointerEventsAdapterHandler.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">[</span><span style="color: #6F42C1">TsInterface</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">interface</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IPointerEventsAdapterHandler</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">Task</span><span style="color: #24292E"> </span><span style="color: #6F42C1">HandleClickAtAsync</span><span style="color: #24292E">(</span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">x</span><span style="color: #24292E">, </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">y</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// IPointerEventsAdapterHandler.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">[</span><span style="color: #B392F0">TsInterface</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IPointerEventsAdapterHandler</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">HandleClickAtAsync</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">x</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<div data-rehype-pretty-code-fragment=""><pre data-language="razor" data-theme="light"><code data-language="razor" data-theme="light"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">@implements</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IPointerEventsAdapterHandler</span></span>
<span class="line"><span style="color: #D73A49">@inject</span><span style="color: #24292E"> </span><span style="color: #6F42C1">PointerEventsAdapter</span><span style="color: #24292E"> </span><span style="color: #6F42C1">PointerEvents</span></span></code></pre><pre data-language="razor" data-theme="dark"><code data-language="razor" data-theme="dark"><span class="line"><span style="color: #6A737D">&#x3C;!-- Home.razor --></span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">@implements</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IPointerEventsAdapterHandler</span></span>
<span class="line"><span style="color: #F97583">@inject</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PointerEventsAdapter</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PointerEvents</span></span></code></pre></div>
<p>Note that the <code>HandleClickAtAsync</code> signature can't include a <code>CancellationToken</code> parameter because, in this case, invocations originate from TypeScript, where the concept of <code>CancellationToken</code> doesn't exist.</p>
<p>While we're at it, let's register the <code>PointerEventsAdapter</code> class as a scoped service in the <code>Program.cs</code> file:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #6A737D">// Program.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">builder.Services.</span><span style="color: #6F42C1">AddScoped</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">PointerEventsAdapter</span><span style="color: #24292E">>();</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #6A737D">// Program.cs</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">builder.Services.</span><span style="color: #B392F0">AddScoped</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">PointerEventsAdapter</span><span style="color: #E1E4E8">>();</span></span></code></pre></div>
<p>Now, when the C# project is built, new auto-generated types will be added to the <code>typings.ts</code> file:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="typescript" data-theme="light"><code data-language="typescript" data-theme="light"><span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">interface</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IPointerEventsAdapterHandler</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">handleClickAtAsync</span><span style="color: #24292E">(</span><span style="color: #E36209">x</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">number</span><span style="color: #24292E">, </span><span style="color: #E36209">y</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">number</span><span style="color: #24292E">)</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Promise</span><span style="color: #24292E">&#x3C;</span><span style="color: #005CC5">void</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">interface</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IPointerEventsAdapter</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">addForHandlerAsync</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">THandler</span><span style="color: #24292E">>(</span><span style="color: #E36209">handlerReference</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DotNet</span><span style="color: #24292E">.</span><span style="color: #6F42C1">DotNetObject</span><span style="color: #24292E">)</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Promise</span><span style="color: #24292E">&#x3C;</span><span style="color: #005CC5">void</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="typescript" data-theme="dark"><code data-language="typescript" data-theme="dark"><span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IPointerEventsAdapterHandler</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">handleClickAtAsync</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">x</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">y</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">number</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Promise</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #79B8FF">void</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">interface</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IPointerEventsAdapter</span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #B392F0">addForHandlerAsync</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8">>(</span><span style="color: #FFAB70">handlerReference</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DotNet</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DotNetObject</span><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Promise</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #79B8FF">void</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>We can now implement the <code>pointerEventsAdapter</code> (TypeScript) handler module, which should export the <code>addForHandlerAsync</code> handler function. A na√Øve implementation of the handler would look like this:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="typescript" data-theme="light"><code data-language="typescript" data-theme="light"><span class="line"><span style="color: #6A737D">// pointerEventsAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">let</span><span style="color: #24292E"> handlerRef</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DotNet</span><span style="color: #24292E">.</span><span style="color: #6F42C1">DotNetObject</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addForHandlerAsync</span><span style="color: #24292E">(</span><span style="color: #E36209">handlerReference</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DotNet</span><span style="color: #24292E">.</span><span style="color: #6F42C1">DotNetObject</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">  handlerRef </span><span style="color: #D73A49">=</span><span style="color: #24292E"> handlerReference</span></span>
<span class="line"><span style="color: #24292E">  window.</span><span style="color: #6F42C1">addEventListener</span><span style="color: #24292E">(</span><span style="color: #032F62">"click"</span><span style="color: #24292E">, </span><span style="color: #E36209">ev</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    handlerRef.</span><span style="color: #6F42C1">invokeMethodAsync</span><span style="color: #24292E">(</span><span style="color: #032F62">"HandleClickAtAsync"</span><span style="color: #24292E">, ev.x, ev.y)</span></span>
<span class="line"><span style="color: #24292E">  })</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">default</span><span style="color: #24292E"> { addForHandlerAsync } </span><span style="color: #D73A49">as</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IPointerEventsAdapter</span></span></code></pre><pre data-language="typescript" data-theme="dark"><code data-language="typescript" data-theme="dark"><span class="line"><span style="color: #6A737D">// pointerEventsAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">let</span><span style="color: #E1E4E8"> handlerRef</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DotNet</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DotNetObject</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">addForHandlerAsync</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">handlerReference</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DotNet</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DotNetObject</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">  handlerRef </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> handlerReference</span></span>
<span class="line"><span style="color: #E1E4E8">  window.</span><span style="color: #B392F0">addEventListener</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"click"</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">ev</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    handlerRef.</span><span style="color: #B392F0">invokeMethodAsync</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"HandleClickAtAsync"</span><span style="color: #E1E4E8">, ev.x, ev.y)</span></span>
<span class="line"><span style="color: #E1E4E8">  })</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> { addForHandlerAsync } </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IPointerEventsAdapter</span></span></code></pre></div>
<p>With the na√Øve implementation, invoking the <code>HandleClickAtAsync</code> (C#) handler method would not utilize any of our auto-generated interfaces and would be fully dynamically typed.</p>
<p>Instead, let's create an <code>invokeHandler</code> utility TypeScript function to ensure that all C# handler method invocations from TypeScript are covered by TypeScript type checking:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="typescript" data-theme="light"><code data-language="typescript" data-theme="light"><span class="line"><span style="color: #6A737D">// utils.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">type</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ExtractParams</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">, </span><span style="color: #6F42C1">K</span><span style="color: #24292E"> </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> </span><span style="color: #D73A49">keyof</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&#x26;</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">[</span><span style="color: #6F42C1">K</span><span style="color: #24292E">] </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> (</span><span style="color: #D73A49">...</span><span style="color: #E36209">args</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #D73A49">infer</span><span style="color: #24292E"> </span><span style="color: #6F42C1">P</span><span style="color: #24292E">) </span><span style="color: #D73A49">=></span><span style="color: #24292E"> </span><span style="color: #005CC5">any</span><span style="color: #24292E"> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #6F42C1">P</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">never</span></span>
<span class="line"><span style="color: #D73A49">type</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ExtractReturn</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">T</span><span style="color: #24292E">, </span><span style="color: #6F42C1">K</span><span style="color: #24292E"> </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> </span><span style="color: #D73A49">keyof</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E"> </span><span style="color: #D73A49">&#x26;</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">T</span><span style="color: #24292E">[</span><span style="color: #6F42C1">K</span><span style="color: #24292E">] </span><span style="color: #D73A49">extends</span><span style="color: #24292E"> (</span><span style="color: #D73A49">...</span><span style="color: #E36209">args</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">any</span><span style="color: #24292E">[]) </span><span style="color: #D73A49">=></span><span style="color: #24292E"> </span><span style="color: #6F42C1">Promise</span><span style="color: #24292E">&#x3C;</span><span style="color: #D73A49">infer</span><span style="color: #24292E"> </span><span style="color: #6F42C1">R</span><span style="color: #24292E">> </span><span style="color: #D73A49">?</span><span style="color: #24292E"> </span><span style="color: #6F42C1">R</span><span style="color: #24292E"> </span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #005CC5">never</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">invokeHandler</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">THandler</span><span style="color: #24292E">>(</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #E36209">handlerRef</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DotNet</span><span style="color: #24292E">.</span><span style="color: #6F42C1">DotNetObject</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #E36209">member</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #D73A49">keyof</span><span style="color: #24292E"> </span><span style="color: #6F42C1">THandler</span><span style="color: #24292E"> </span><span style="color: #D73A49">&#x26;</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #E36209">args</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ExtractParams</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">THandler</span><span style="color: #24292E">, </span><span style="color: #D73A49">keyof</span><span style="color: #24292E"> </span><span style="color: #6F42C1">THandler</span><span style="color: #24292E"> </span><span style="color: #D73A49">&#x26;</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">></span></span>
<span class="line"><span style="color: #24292E">)</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Promise</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">ExtractReturn</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">THandler</span><span style="color: #24292E">, </span><span style="color: #D73A49">keyof</span><span style="color: #24292E"> </span><span style="color: #6F42C1">THandler</span><span style="color: #24292E"> </span><span style="color: #D73A49">&#x26;</span><span style="color: #24292E"> </span><span style="color: #005CC5">string</span><span style="color: #24292E">>> {</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">methodName</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> member.</span><span style="color: #6F42C1">charAt</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">).</span><span style="color: #6F42C1">toUpperCase</span><span style="color: #24292E">() </span><span style="color: #D73A49">+</span><span style="color: #24292E"> member.</span><span style="color: #6F42C1">slice</span><span style="color: #24292E">(</span><span style="color: #005CC5">1</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">return</span><span style="color: #24292E"> handlerRef.</span><span style="color: #6F42C1">invokeMethodAsync</span><span style="color: #24292E">(methodName, </span><span style="color: #D73A49">...</span><span style="color: #24292E">args)</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="typescript" data-theme="dark"><code data-language="typescript" data-theme="dark"><span class="line"><span style="color: #6A737D">// utils.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">type</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ExtractParams</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">K</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">extends</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">keyof</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">[</span><span style="color: #B392F0">K</span><span style="color: #E1E4E8">] </span><span style="color: #F97583">extends</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">...</span><span style="color: #FFAB70">args</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">infer</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">P</span><span style="color: #E1E4E8">) </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">any</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">P</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">never</span></span>
<span class="line"><span style="color: #F97583">type</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ExtractReturn</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">K</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">extends</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">keyof</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">T</span><span style="color: #E1E4E8">[</span><span style="color: #B392F0">K</span><span style="color: #E1E4E8">] </span><span style="color: #F97583">extends</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">...</span><span style="color: #FFAB70">args</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">any</span><span style="color: #E1E4E8">[]) </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Promise</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #F97583">infer</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">R</span><span style="color: #E1E4E8">> </span><span style="color: #F97583">?</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">R</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">never</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">invokeHandler</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8">>(</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">handlerRef</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DotNet</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DotNetObject</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #FFAB70">member</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">keyof</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">...</span><span style="color: #FFAB70">args</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ExtractParams</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">keyof</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">></span></span>
<span class="line"><span style="color: #E1E4E8">)</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Promise</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">ExtractReturn</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8">, </span><span style="color: #F97583">keyof</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">THandler</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">&#x26;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">string</span><span style="color: #E1E4E8">>> {</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">methodName</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> member.</span><span style="color: #B392F0">charAt</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">).</span><span style="color: #B392F0">toUpperCase</span><span style="color: #E1E4E8">() </span><span style="color: #F97583">+</span><span style="color: #E1E4E8"> member.</span><span style="color: #B392F0">slice</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> handlerRef.</span><span style="color: #B392F0">invokeMethodAsync</span><span style="color: #E1E4E8">(methodName, </span><span style="color: #F97583">...</span><span style="color: #E1E4E8">args)</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>By passing an auto-generated interface as an argument to the generic parameter <code>THandler</code>, <code>invokeHandler</code> ensures that the C# handler method we attempt to invoke is a member of the interface <strong>and</strong> that the passed parameters and return type match the member's signature üéâ.</p>
<p>So, our final implementation of the <code>pointerEventsAdapter</code> (TypeScript) handler looks like this:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="typescript" data-theme="light"><code data-language="typescript" data-theme="light"><span class="line"><span style="color: #6A737D">// pointerEventsAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">let</span><span style="color: #24292E"> handlerRef</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DotNet</span><span style="color: #24292E">.</span><span style="color: #6F42C1">DotNetObject</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #D73A49">function</span><span style="color: #24292E"> </span><span style="color: #6F42C1">addForHandlerAsync</span><span style="color: #24292E">(</span><span style="color: #E36209">handlerReference</span><span style="color: #D73A49">:</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DotNet</span><span style="color: #24292E">.</span><span style="color: #6F42C1">DotNetObject</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">  handlerRef </span><span style="color: #D73A49">=</span><span style="color: #24292E"> handlerReference</span></span>
<span class="line"><span style="color: #24292E">  window.</span><span style="color: #6F42C1">addEventListener</span><span style="color: #24292E">(</span><span style="color: #032F62">"click"</span><span style="color: #24292E">, </span><span style="color: #E36209">ev</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">invokeHandler</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">IPointerEventsAdapterHandler</span><span style="color: #24292E">>(handlerRef, </span><span style="color: #032F62">"handleClickAtAsync"</span><span style="color: #24292E">, ev.x, ev.y)</span></span>
<span class="line"><span style="color: #24292E">  })</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">default</span><span style="color: #24292E"> { addForHandlerAsync } </span><span style="color: #D73A49">as</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IPointerEventsAdapter</span></span></code></pre><pre data-language="typescript" data-theme="dark"><code data-language="typescript" data-theme="dark"><span class="line"><span style="color: #6A737D">// pointerEventsAdapter.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">let</span><span style="color: #E1E4E8"> handlerRef</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DotNet</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DotNetObject</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">function</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">addForHandlerAsync</span><span style="color: #E1E4E8">(</span><span style="color: #FFAB70">handlerReference</span><span style="color: #F97583">:</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DotNet</span><span style="color: #E1E4E8">.</span><span style="color: #B392F0">DotNetObject</span><span style="color: #E1E4E8">) {</span></span>
<span class="line"><span style="color: #E1E4E8">  handlerRef </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> handlerReference</span></span>
<span class="line"><span style="color: #E1E4E8">  window.</span><span style="color: #B392F0">addEventListener</span><span style="color: #E1E4E8">(</span><span style="color: #9ECBFF">"click"</span><span style="color: #E1E4E8">, </span><span style="color: #FFAB70">ev</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">invokeHandler</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">IPointerEventsAdapterHandler</span><span style="color: #E1E4E8">>(handlerRef, </span><span style="color: #9ECBFF">"handleClickAtAsync"</span><span style="color: #E1E4E8">, ev.x, ev.y)</span></span>
<span class="line"><span style="color: #E1E4E8">  })</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> { addForHandlerAsync } </span><span style="color: #F97583">as</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IPointerEventsAdapter</span></span></code></pre></div>
<p>Note that we store the <code>handlerReference</code> argument in the <code>handlerRef</code> variable so that other TypeScript handler functions added to the <code>pointerEventsAdapter</code> handler can reuse it. However, in our example implementation, this is not strictly required.</p>
<p>Finally, let's add the <code>pointerEventsAdapter.ts</code> file as a new entry point in <code>vite.config.js</code>, so that Vite will build the <code>pointerEventsAdapter.js</code> module:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="javascript" data-theme="light"><code data-language="javascript" data-theme="light"><span class="line"><span style="color: #6A737D">// vite.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">import</span><span style="color: #24292E"> { defineConfig } </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">"vite"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">default</span><span style="color: #24292E"> </span><span style="color: #6F42C1">defineConfig</span><span style="color: #24292E">({</span></span>
<span class="line"><span style="color: #24292E">  build: {</span></span>
<span class="line"><span style="color: #24292E">    emptyOutDir: </span><span style="color: #005CC5">true</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    outDir: </span><span style="color: #032F62">"../../wwwroot/js/dist"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    lib: {</span></span>
<span class="line"><span style="color: #24292E">      entry: [</span><span style="color: #032F62">"src/browserConsoleAdapter.ts"</span><span style="color: #24292E">, </span><span style="color: #032F62">"src/pointerEventsAdapter.ts"</span><span style="color: #24292E">],</span></span>
<span class="line"><span style="color: #24292E">      formats: [</span><span style="color: #032F62">"es"</span><span style="color: #24292E">]</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">})</span></span></code></pre><pre data-language="javascript" data-theme="dark"><code data-language="javascript" data-theme="dark"><span class="line"><span style="color: #6A737D">// vite.config.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">import</span><span style="color: #E1E4E8"> { defineConfig } </span><span style="color: #F97583">from</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"vite"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color: #F97583">export</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">default</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">defineConfig</span><span style="color: #E1E4E8">({</span></span>
<span class="line"><span style="color: #E1E4E8">  build: {</span></span>
<span class="line"><span style="color: #E1E4E8">    emptyOutDir: </span><span style="color: #79B8FF">true</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    outDir: </span><span style="color: #9ECBFF">"../../wwwroot/js/dist"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    lib: {</span></span>
<span class="line"><span style="color: #E1E4E8">      entry: [</span><span style="color: #9ECBFF">"src/browserConsoleAdapter.ts"</span><span style="color: #E1E4E8">, </span><span style="color: #9ECBFF">"src/pointerEventsAdapter.ts"</span><span style="color: #E1E4E8">],</span></span>
<span class="line"><span style="color: #E1E4E8">      formats: [</span><span style="color: #9ECBFF">"es"</span><span style="color: #E1E4E8">]</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">})</span></span></code></pre></div>
<p>Now, if we build and launch the Blazor application, we should see new entries appearing in the list on the page each time we click somewhere.</p>
<h2 id="evaluation"><a href="#evaluation">Evaluation</a></h2>
<p>The goals we set in the introduction of this article were met relatively well:</p>
<ul>
<li>Type changes in C# are automatically propagated to TypeScript by <code>Reinforced.Typings</code>. ‚úÖ</li>
<li>We fully leverage TypeScript's type-checking capabilities, and type mismatches are automatically detected as part of the Blazor app's MSBuild process. ‚úÖ</li>
<li>The Vite project is automatically built when necessary ‚Äî and skipped when it's not ‚Äî as part of the Blazor app's MSBuild process. ‚úÖ</li>
<li>JavaScript modules can be re-imported during a Blazor debug session by simply refreshing the page. We can even configure Vite to watch for changes in files within the Vite project and automatically rebuild the distributables using the <code>npm watch</code> command. <code>npm watch</code> can run in parallel with a Blazor debug session. ‚úÖ</li>
</ul>
<p>Naturally, the standard limitations of Blazor's JavaScript interop still apply. For example, our TypeScript handlers don't really understand C# object references, aside from the limited support provided by <code>DotNet.DotNetObject</code> handles. All communication still relies on simple JSON serialization.</p>
<p>Additionally, the caveats of TypeScript's duck-typing remain. For instance, if we removed the <code>message</code> parameter from the <code>logAsync</code> function in the <code>browserConsoleAdapter</code> (TypeScript) module, <code>logAsync</code> would still comply with the auto-generated <code>IBrowserConsoleAdapter</code> (TypeScript) interface due to duck-typing. However, changing the type of the <code>message</code> parameter or adding more parameters to the <code>logAsync</code> function ‚Äî without making corresponding updates to the <code>BrowserConsoleAdapter</code> (C#) class ‚Äî would be caught by type checking.</p>b:["$","div",null,{"className":"flex justify-center","children":["$","div",null,{"className":"md:px-10 min-w-0 max-w-7xl mb-12","children":["$","article",null,{"children":[["$","header",null,{"className":"px-5 mb-4 py-10 relative","children":[["$","h1",null,{"className":"text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100","children":"Blazor with TypeScript Interop"}],["$","time",null,{"dateTime":"2025-03-09 16:00","className":"pl-1 font-serif text-slate-400 bottom-0 absolute","children":[["$","svg",null,{"className":"h-4 w-4 inline-block","width":"24","height":"24","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":"2","strokeLinecap":"round","strokeLinejoin":"round","children":[["$","path",null,{"d":"M12 19l7-7 3 3-7 7-3-3z"}]," ",["$","path",null,{"d":"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}]," ",["$","path",null,{"d":"M2 2l7.586 7.586"}]," ",["$","circle",null,{"cx":"11","cy":"11","r":"2"}]]}]," ","2025-03-09 16:00"]}]]}],["$","div",null,{"className":"bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg","children":[[["$","p",null,{"className":"italic text-slate-400 p-4","dangerouslySetInnerHTML":{"__html":"You can find the full code for the example discussed here in its <a href=\"https://github.com/iotalambda/BlazorTsInteropExample\">Github repo</a>. It's also running and available at <a href=\"https://food.joona.cloud/BlazorTsInteropExample\">https://food.joona.cloud/BlazorTsInteropExample</a>."}}],["$","hr",null,{"className":"h-px my-4 bg-gray-200 border-0 dark:bg-gray-700"}]],["$","div",null,{"className":"space-y-4","dangerouslySetInnerHTML":{"__html":"$c"}}]]}]]}]}]}]
a:null
