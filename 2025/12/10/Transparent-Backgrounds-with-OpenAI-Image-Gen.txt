1:HL["/_next/static/media/583a894d7b920fb7-s.p.woff2",{"as":"font","type":"font/woff2"}]
2:HL["/_next/static/media/e807dee2426166ad-s.p.woff2",{"as":"font","type":"font/woff2"}]
3:HL["/_next/static/css/cf6d346f04b2f900.css",{"as":"style"}]
0:["7Cce29R_3lXrjKEkZGNQO",[[["",{"children":[["id","2025/12/10/Transparent-Backgrounds-with-OpenAI-Image-Gen","c"],{"children":["__PAGE__?{\"id\":[\"2025\",\"12\",\"10\",\"Transparent-Backgrounds-with-OpenAI-Image-Gen\"]}",{}]}]},"$undefined","$undefined",true],"$L4",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/cf6d346f04b2f900.css","precedence":"next"}]],"$L5"]]]]
6:HL["/_next/static/css/4823b726c835f640.css",{"as":"style"}]
7:I{"id":6685,"chunks":["685:static/chunks/685-8c2a2ee442f8842a.js","185:static/chunks/app/layout-4978ca41370bd554.js"],"name":"","async":false}
8:I{"id":6112,"chunks":["685:static/chunks/685-8c2a2ee442f8842a.js","185:static/chunks/app/layout-4978ca41370bd554.js"],"name":"","async":false}
9:I{"id":7767,"chunks":["272:static/chunks/webpack-efd16f5debe934f5.js","971:static/chunks/fd9d1056-9200b628bfbdc6da.js","596:static/chunks/596-98393ace57ba3968.js"],"name":"default","async":false}
a:I{"id":7920,"chunks":["272:static/chunks/webpack-efd16f5debe934f5.js","971:static/chunks/fd9d1056-9200b628bfbdc6da.js","596:static/chunks/596-98393ace57ba3968.js"],"name":"default","async":false}
4:[null,["$","html",null,{"lang":"en","className":"__variable_eb9fb7 __variable_2fad4c","children":["$","body",null,{"className":"bg-slate-200 dark:bg-slate-700","children":[["$","nav",null,{"className":"w-full flex flex-row justify-between items-center bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans","children":[["$","div",null,{"className":"p-2","children":["$","$L7",null,{"className":"text-2xl font-semibold text-neutral-100 dark:text-neutral-200","href":"/","children":[["$","h1",null,{"className":"inline","children":"üçî food for ai"}]," ",["$","span",null,{"className":"font-mono font-light text-xs","children":"food.joona.cloud"}]]}]}],["$","$L8",null,{"className":"mr-2"}]]}],["$","main",null,{"className":"mt-4","children":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children",["id","2025/12/10/Transparent-Backgrounds-with-OpenAI-Image-Gen","c"],"children"],"loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lb","$Lc",null],"segment":"__PAGE__?{\"id\":[\"2025\",\"12\",\"10\",\"Transparent-Backgrounds-with-OpenAI-Image-Gen\"]}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4823b726c835f640.css","precedence":"next"}]]}],"segment":["id","2025/12/10/Transparent-Backgrounds-with-OpenAI-Image-Gen","c"]},"styles":[]}]}]]}]}],null]
5:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Transparent Backgrounds with OpenAI DALL-E 3 | Food for AI blog"}],["$","meta","2",{"name":"description","content":"Blog about .NET, Azure, React and whatever comes to mind."}],["$","meta","3",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link","4",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","5",{"name":"next-size-adjust"}]]
d:T1112c,<p>OpenAI's new <a href="https://platform.openai.com/docs/models/gpt-image-1"><code>gpt-image-1</code></a> model supports <a href="https://docs.aimlapi.com/api-references/image-models/openai/gpt-image-1#generate-image">native transparent backgrounds</a> via a simple <code>background: "transparent"</code> parameter. Unfortunately, accessing this model via API requires verifying your organization by submitting a copy of your government-issued ID to <a href="https://withpersona.com/">Persona</a>, a third-party American identity verification service. This has <a href="https://community.openai.com/t/the-broken-openai-persona-identity-verification-what-it-is-and-why-its-problematic/1354535">proven to have several problems</a>, confidentiality not being the least of them.</p>
<p>Luckily, OpenAI's deprecated (but still active) <a href="https://platform.openai.com/docs/models/dall-e">DALL-E 3</a> model can achieve the same result with a workaround: <a href="https://en.wikipedia.org/wiki/Chroma_key">green screen</a>.</p>
<img src="/dalle3-greenscreen-example.png" alt="Case in point" width="400" style="float: right; margin-right: 1rem; margin-bottom: 0.5rem" />
<h2 id="prompting-for-green-screen"><a href="#prompting-for-green-screen">Prompting for Green Screen</a></h2>
<p>Append the following to your image generation prompt:</p>
<pre><code>IMPORTANT: The background MUST be a solid, flat, unlit, pure green color
with hex value #00b140. No gradients, no shadows, no variations - just
perfectly uniform #00b140 green background. The background is essentially
a green screen for chroma keying later in the process, so avoid that color
in the actual image content.
</code></pre>
<p>The hex value <code>#00b140</code> is a specific shade of green that's unlikely to appear in the actual image subject. You could use other green shades, but this one works well in practice.</p>
<h2 id="detecting-the-actual-background-color"><a href="#detecting-the-actual-background-color">Detecting the Actual Background Color</a></h2>
<p>LLMs are not precise when it comes to exact colors. Even with explicit instructions to use <code>#00b140</code>, the generated image might have a slightly different green tone or vary slightly across the image.</p>
<p>This can be managed by sampling pixels near the generated image's borders (where background is most likely to be) and calculating their median color:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DetectBackgroundColor</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Image</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E">> </span><span style="color: #6F42C1">image</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">random</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Random</span><span style="color: #24292E">(</span><span style="color: #005CC5">42</span><span style="color: #24292E">); </span><span style="color: #6A737D">// Fixed seed for reproducibility</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">samples</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">List</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E">>();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">width</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> image.Width;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">height</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> image.Height;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">// Sample 100 pixels near the borders (within 5% of width/height)</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">maxBorderX</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)(width </span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.05</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">maxBorderY</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)(height </span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.05</span><span style="color: #24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">i</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; i </span><span style="color: #D73A49">&#x3C;</span><span style="color: #24292E"> </span><span style="color: #005CC5">100</span><span style="color: #24292E">; i</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">x</span><span style="color: #24292E">, </span><span style="color: #6F42C1">y</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D">// Randomly choose which border region to sample from</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">edge</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(</span><span style="color: #005CC5">4</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">switch</span><span style="color: #24292E"> (edge)</span></span>
<span class="line"><span style="color: #24292E">        {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">: </span><span style="color: #6A737D">// Top edge</span></span>
<span class="line"><span style="color: #24292E">                x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(width);</span></span>
<span class="line"><span style="color: #24292E">                y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(maxBorderY);</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E">: </span><span style="color: #6A737D">// Bottom edge</span></span>
<span class="line"><span style="color: #24292E">                x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(width);</span></span>
<span class="line"><span style="color: #24292E">                y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> height </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(maxBorderY);</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">case</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">: </span><span style="color: #6A737D">// Left edge</span></span>
<span class="line"><span style="color: #24292E">                x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(maxBorderX);</span></span>
<span class="line"><span style="color: #24292E">                y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(height);</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">default</span><span style="color: #24292E">: </span><span style="color: #6A737D">// Right edge</span></span>
<span class="line"><span style="color: #24292E">                x </span><span style="color: #D73A49">=</span><span style="color: #24292E"> width </span><span style="color: #D73A49">-</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #D73A49">-</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(maxBorderX);</span></span>
<span class="line"><span style="color: #24292E">                y </span><span style="color: #D73A49">=</span><span style="color: #24292E"> random.</span><span style="color: #6F42C1">Next</span><span style="color: #24292E">(height);</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">break</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">        samples.</span><span style="color: #6F42C1">Add</span><span style="color: #24292E">(image[x, y]);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">// Calculate median for each channel</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">rValues</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> samples.</span><span style="color: #6F42C1">Select</span><span style="color: #24292E">(</span><span style="color: #6F42C1">p</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)p.R).</span><span style="color: #6F42C1">OrderBy</span><span style="color: #24292E">(</span><span style="color: #6F42C1">v</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> v).</span><span style="color: #6F42C1">ToList</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">gValues</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> samples.</span><span style="color: #6F42C1">Select</span><span style="color: #24292E">(</span><span style="color: #6F42C1">p</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)p.G).</span><span style="color: #6F42C1">OrderBy</span><span style="color: #24292E">(</span><span style="color: #6F42C1">v</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> v).</span><span style="color: #6F42C1">ToList</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">bValues</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> samples.</span><span style="color: #6F42C1">Select</span><span style="color: #24292E">(</span><span style="color: #6F42C1">p</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> (</span><span style="color: #D73A49">int</span><span style="color: #24292E">)p.B).</span><span style="color: #6F42C1">OrderBy</span><span style="color: #24292E">(</span><span style="color: #6F42C1">v</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span><span style="color: #24292E"> v).</span><span style="color: #6F42C1">ToList</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">medianR</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">byte</span><span style="color: #24292E">)rValues[rValues.Count </span><span style="color: #D73A49">/</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">medianG</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">byte</span><span style="color: #24292E">)gValues[gValues.Count </span><span style="color: #D73A49">/</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">medianB</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #D73A49">byte</span><span style="color: #24292E">)bValues[bValues.Count </span><span style="color: #D73A49">/</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E">(medianR, medianG, medianB, </span><span style="color: #005CC5">255</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #F97583">private</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">static</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DetectBackgroundColor</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">Image</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8">> </span><span style="color: #B392F0">image</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">random</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Random</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">42</span><span style="color: #E1E4E8">); </span><span style="color: #6A737D">// Fixed seed for reproducibility</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">samples</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">List</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8">>();</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">width</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> image.Width;</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">height</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> image.Height;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">// Sample 100 pixels near the borders (within 5% of width/height)</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">maxBorderX</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">int</span><span style="color: #E1E4E8">)(width </span><span style="color: #F97583">*</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.05</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">maxBorderY</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">int</span><span style="color: #E1E4E8">)(height </span><span style="color: #F97583">*</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0.05</span><span style="color: #E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">for</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">i</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">; i </span><span style="color: #F97583">&#x3C;</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">100</span><span style="color: #E1E4E8">; i</span><span style="color: #F97583">++</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">x</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">y</span><span style="color: #E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #6A737D">// Randomly choose which border region to sample from</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">edge</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">4</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">switch</span><span style="color: #E1E4E8"> (edge)</span></span>
<span class="line"><span style="color: #E1E4E8">        {</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">case</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">: </span><span style="color: #6A737D">// Top edge</span></span>
<span class="line"><span style="color: #E1E4E8">                x </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(width);</span></span>
<span class="line"><span style="color: #E1E4E8">                y </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(maxBorderY);</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #F97583">break</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">case</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8">: </span><span style="color: #6A737D">// Bottom edge</span></span>
<span class="line"><span style="color: #E1E4E8">                x </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(width);</span></span>
<span class="line"><span style="color: #E1E4E8">                y </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> height </span><span style="color: #F97583">-</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(maxBorderY);</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #F97583">break</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">case</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8">: </span><span style="color: #6A737D">// Left edge</span></span>
<span class="line"><span style="color: #E1E4E8">                x </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(maxBorderX);</span></span>
<span class="line"><span style="color: #E1E4E8">                y </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(height);</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #F97583">break</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">default</span><span style="color: #E1E4E8">: </span><span style="color: #6A737D">// Right edge</span></span>
<span class="line"><span style="color: #E1E4E8">                x </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> width </span><span style="color: #F97583">-</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">1</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(maxBorderX);</span></span>
<span class="line"><span style="color: #E1E4E8">                y </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> random.</span><span style="color: #B392F0">Next</span><span style="color: #E1E4E8">(height);</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #F97583">break</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">        samples.</span><span style="color: #B392F0">Add</span><span style="color: #E1E4E8">(image[x, y]);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">// Calculate median for each channel</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">rValues</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> samples.</span><span style="color: #B392F0">Select</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">p</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">int</span><span style="color: #E1E4E8">)p.R).</span><span style="color: #B392F0">OrderBy</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">v</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> v).</span><span style="color: #B392F0">ToList</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">gValues</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> samples.</span><span style="color: #B392F0">Select</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">p</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">int</span><span style="color: #E1E4E8">)p.G).</span><span style="color: #B392F0">OrderBy</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">v</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> v).</span><span style="color: #B392F0">ToList</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">bValues</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> samples.</span><span style="color: #B392F0">Select</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">p</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">int</span><span style="color: #E1E4E8">)p.B).</span><span style="color: #B392F0">OrderBy</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">v</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span><span style="color: #E1E4E8"> v).</span><span style="color: #B392F0">ToList</span><span style="color: #E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">medianR</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">byte</span><span style="color: #E1E4E8">)rValues[rValues.Count </span><span style="color: #F97583">/</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8">];</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">medianG</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">byte</span><span style="color: #E1E4E8">)gValues[gValues.Count </span><span style="color: #F97583">/</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8">];</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">medianB</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">byte</span><span style="color: #E1E4E8">)bValues[bValues.Count </span><span style="color: #F97583">/</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8">(medianR, medianG, medianB, </span><span style="color: #79B8FF">255</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>Using the median (rather than the mean) makes the detection robust against outliers ‚Äî edge pixels might include parts of the subject that spill into the border region.</p>
<h2 id="applying-tolerance"><a href="#applying-tolerance">Applying Tolerance</a></h2>
<p>After detecting the actual background color, we still need <em>tolerance</em> when comparing pixels, due to subtle variations in the generated background.</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">IsChromaKeyGreen</span><span style="color: #24292E">(</span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pixel</span><span style="color: #24292E">, </span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E"> </span><span style="color: #6F42C1">target</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #D73A49">int</span><span style="color: #24292E"> </span><span style="color: #6F42C1">tolerance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">40</span><span style="color: #24292E">; </span><span style="color: #6A737D">// Adjust this as needed</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dr</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Math.</span><span style="color: #6F42C1">Abs</span><span style="color: #24292E">(pixel.R </span><span style="color: #D73A49">-</span><span style="color: #24292E"> target.R);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">dg</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Math.</span><span style="color: #6F42C1">Abs</span><span style="color: #24292E">(pixel.G </span><span style="color: #D73A49">-</span><span style="color: #24292E"> target.G);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">db</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Math.</span><span style="color: #6F42C1">Abs</span><span style="color: #24292E">(pixel.B </span><span style="color: #D73A49">-</span><span style="color: #24292E"> target.B);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> dr </span><span style="color: #D73A49">&#x3C;=</span><span style="color: #24292E"> tolerance </span><span style="color: #D73A49">&#x26;&#x26;</span><span style="color: #24292E"> dg </span><span style="color: #D73A49">&#x3C;=</span><span style="color: #24292E"> tolerance </span><span style="color: #D73A49">&#x26;&#x26;</span><span style="color: #24292E"> db </span><span style="color: #D73A49">&#x3C;=</span><span style="color: #24292E"> tolerance;</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #F97583">private</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">static</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">bool</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">IsChromaKeyGreen</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">pixel</span><span style="color: #E1E4E8">, </span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">target</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">const</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">int</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">tolerance</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">40</span><span style="color: #E1E4E8">; </span><span style="color: #6A737D">// Adjust this as needed</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">dr</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">Abs</span><span style="color: #E1E4E8">(pixel.R </span><span style="color: #F97583">-</span><span style="color: #E1E4E8"> target.R);</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">dg</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">Abs</span><span style="color: #E1E4E8">(pixel.G </span><span style="color: #F97583">-</span><span style="color: #E1E4E8"> target.G);</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">db</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> Math.</span><span style="color: #B392F0">Abs</span><span style="color: #E1E4E8">(pixel.B </span><span style="color: #F97583">-</span><span style="color: #E1E4E8"> target.B);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> dr </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> tolerance </span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #E1E4E8"> dg </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> tolerance </span><span style="color: #F97583">&#x26;&#x26;</span><span style="color: #E1E4E8"> db </span><span style="color: #F97583">&#x3C;=</span><span style="color: #E1E4E8"> tolerance;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>A tolerance of 40 (out of 255) seems to catch most background variations while avoiding false positives on the subject.</p>
<h2 id="the-complete-implementation"><a href="#the-complete-implementation">The Complete Implementation</a></h2>
<p>Here's a complete C# implementation using <a href="https://github.com/SixLabors/ImageSharp">ImageSharp</a> for image processing:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="csharp" data-theme="light"><code data-language="csharp" data-theme="light"><span class="line"><span style="color: #D73A49">public</span><span style="color: #24292E"> </span><span style="color: #D73A49">async</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Task</span><span style="color: #24292E">&#x3C;</span><span style="color: #D73A49">byte</span><span style="color: #24292E">[]> </span><span style="color: #6F42C1">GenerateImageAsync</span><span style="color: #24292E">(</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">string</span><span style="color: #24292E"> </span><span style="color: #6F42C1">model</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">string</span><span style="color: #24292E"> </span><span style="color: #6F42C1">prompt</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">bool</span><span style="color: #24292E"> </span><span style="color: #6F42C1">transparentBackground</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">false</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">CancellationToken</span><span style="color: #24292E"> </span><span style="color: #6F42C1">cancellationToken</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> default)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">client</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ImageClient</span><span style="color: #24292E">(model, _config.OpenAi.ApiKey);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">finalPrompt</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> prompt;</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (transparentBackground)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        finalPrompt </span><span style="color: #D73A49">+=</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #032F62">"</span><span style="color: #005CC5">\n\n</span><span style="color: #032F62">IMPORTANT: The background MUST be a solid, flat, unlit, "</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #032F62">"pure green color with hex value #00b140. No gradients, no shadows, "</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #032F62">"no variations - just perfectly uniform #00b140 green background. "</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #032F62">"The background is essentially a green screen for chroma keying later "</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #032F62">"in the process, so avoid that color in the actual image content."</span><span style="color: #24292E">;</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">options</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ImageGenerationOptions</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        ResponseFormat </span><span style="color: #D73A49">=</span><span style="color: #24292E"> GeneratedImageFormat.Bytes,</span></span>
<span class="line"><span style="color: #24292E">        Size </span><span style="color: #D73A49">=</span><span style="color: #24292E"> GeneratedImageSize.W1024xH1024,</span></span>
<span class="line"><span style="color: #24292E">        Quality </span><span style="color: #D73A49">=</span><span style="color: #24292E"> GeneratedImageQuality.High,</span></span>
<span class="line"><span style="color: #24292E">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">result</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> client.</span><span style="color: #6F42C1">GenerateImageAsync</span><span style="color: #24292E">(finalPrompt, options, cancellationToken);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">imageBytes</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> result.Value.ImageBytes.</span><span style="color: #6F42C1">ToArray</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (transparentBackground)</span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        imageBytes </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">ChromaKeyGreen</span><span style="color: #24292E">(imageBytes);</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> imageBytes;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">private</span><span style="color: #24292E"> </span><span style="color: #D73A49">static</span><span style="color: #24292E"> </span><span style="color: #D73A49">byte</span><span style="color: #24292E">[] </span><span style="color: #6F42C1">ChromaKeyGreen</span><span style="color: #24292E">(</span><span style="color: #D73A49">byte</span><span style="color: #24292E">[] </span><span style="color: #6F42C1">imageBytes</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">image</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Image.</span><span style="color: #6F42C1">Load</span><span style="color: #24292E">&#x3C;</span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E">>(imageBytes);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">targetGreen</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #6F42C1">DetectBackgroundColor</span><span style="color: #24292E">(image);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    image.</span><span style="color: #6F42C1">ProcessPixelRows</span><span style="color: #24292E">(</span><span style="color: #6F42C1">accessor</span><span style="color: #24292E"> </span><span style="color: #D73A49">=></span></span>
<span class="line"><span style="color: #24292E">    {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">y</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; y </span><span style="color: #D73A49">&#x3C;</span><span style="color: #24292E"> accessor.Height; y</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">        {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">row</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> accessor.</span><span style="color: #6F42C1">GetRowSpan</span><span style="color: #24292E">(y);</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">x</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">; x </span><span style="color: #D73A49">&#x3C;</span><span style="color: #24292E"> row.Length; x</span><span style="color: #D73A49">++</span><span style="color: #24292E">)</span></span>
<span class="line"><span style="color: #24292E">            {</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">pixel</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> row[x];</span></span>
<span class="line"><span style="color: #24292E">                </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (</span><span style="color: #6F42C1">IsChromaKeyGreen</span><span style="color: #24292E">(pixel, targetGreen))</span></span>
<span class="line"><span style="color: #24292E">                {</span></span>
<span class="line"><span style="color: #24292E">                    row[x] </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">Rgba32</span><span style="color: #24292E">(</span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">, </span><span style="color: #005CC5">0</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">                }</span></span>
<span class="line"><span style="color: #24292E">            }</span></span>
<span class="line"><span style="color: #24292E">        }</span></span>
<span class="line"><span style="color: #24292E">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">using</span><span style="color: #24292E"> </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">outputStream</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">MemoryStream</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">var</span><span style="color: #24292E"> </span><span style="color: #6F42C1">encoder</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #6F42C1">PngEncoder</span><span style="color: #24292E"> { ColorType </span><span style="color: #D73A49">=</span><span style="color: #24292E"> PngColorType.RgbWithAlpha };</span></span>
<span class="line"><span style="color: #24292E">    image.</span><span style="color: #6F42C1">SaveAsPng</span><span style="color: #24292E">(outputStream, encoder);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">return</span><span style="color: #24292E"> outputStream.</span><span style="color: #6F42C1">ToArray</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="csharp" data-theme="dark"><code data-language="csharp" data-theme="dark"><span class="line"><span style="color: #F97583">public</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">async</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Task</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #F97583">byte</span><span style="color: #E1E4E8">[]> </span><span style="color: #B392F0">GenerateImageAsync</span><span style="color: #E1E4E8">(</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">string</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">model</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">string</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">prompt</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">bool</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">transparentBackground</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">false</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">CancellationToken</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">cancellationToken</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> default)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">client</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ImageClient</span><span style="color: #E1E4E8">(model, _config.OpenAi.ApiKey);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">finalPrompt</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> prompt;</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> (transparentBackground)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        finalPrompt </span><span style="color: #F97583">+=</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">"</span><span style="color: #79B8FF">\n\n</span><span style="color: #9ECBFF">IMPORTANT: The background MUST be a solid, flat, unlit, "</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">+</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">"pure green color with hex value #00b140. No gradients, no shadows, "</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">+</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">"no variations - just perfectly uniform #00b140 green background. "</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">+</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">"The background is essentially a green screen for chroma keying later "</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">+</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #9ECBFF">"in the process, so avoid that color in the actual image content."</span><span style="color: #E1E4E8">;</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">options</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ImageGenerationOptions</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        ResponseFormat </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> GeneratedImageFormat.Bytes,</span></span>
<span class="line"><span style="color: #E1E4E8">        Size </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> GeneratedImageSize.W1024xH1024,</span></span>
<span class="line"><span style="color: #E1E4E8">        Quality </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> GeneratedImageQuality.High,</span></span>
<span class="line"><span style="color: #E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">result</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">await</span><span style="color: #E1E4E8"> client.</span><span style="color: #B392F0">GenerateImageAsync</span><span style="color: #E1E4E8">(finalPrompt, options, cancellationToken);</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">imageBytes</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> result.Value.ImageBytes.</span><span style="color: #B392F0">ToArray</span><span style="color: #E1E4E8">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> (transparentBackground)</span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        imageBytes </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">ChromaKeyGreen</span><span style="color: #E1E4E8">(imageBytes);</span></span>
<span class="line"><span style="color: #E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> imageBytes;</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">private</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">static</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">byte</span><span style="color: #E1E4E8">[] </span><span style="color: #B392F0">ChromaKeyGreen</span><span style="color: #E1E4E8">(</span><span style="color: #F97583">byte</span><span style="color: #E1E4E8">[] </span><span style="color: #B392F0">imageBytes</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">using</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">image</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> Image.</span><span style="color: #B392F0">Load</span><span style="color: #E1E4E8">&#x3C;</span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8">>(imageBytes);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">targetGreen</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">DetectBackgroundColor</span><span style="color: #E1E4E8">(image);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    image.</span><span style="color: #B392F0">ProcessPixelRows</span><span style="color: #E1E4E8">(</span><span style="color: #B392F0">accessor</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=></span></span>
<span class="line"><span style="color: #E1E4E8">    {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #F97583">for</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">y</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">; y </span><span style="color: #F97583">&#x3C;</span><span style="color: #E1E4E8"> accessor.Height; y</span><span style="color: #F97583">++</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">        {</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">row</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> accessor.</span><span style="color: #B392F0">GetRowSpan</span><span style="color: #E1E4E8">(y);</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #F97583">for</span><span style="color: #E1E4E8"> (</span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">x</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">; x </span><span style="color: #F97583">&#x3C;</span><span style="color: #E1E4E8"> row.Length; x</span><span style="color: #F97583">++</span><span style="color: #E1E4E8">)</span></span>
<span class="line"><span style="color: #E1E4E8">            {</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">pixel</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> row[x];</span></span>
<span class="line"><span style="color: #E1E4E8">                </span><span style="color: #F97583">if</span><span style="color: #E1E4E8"> (</span><span style="color: #B392F0">IsChromaKeyGreen</span><span style="color: #E1E4E8">(pixel, targetGreen))</span></span>
<span class="line"><span style="color: #E1E4E8">                {</span></span>
<span class="line"><span style="color: #E1E4E8">                    row[x] </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">Rgba32</span><span style="color: #E1E4E8">(</span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">, </span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">, </span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">, </span><span style="color: #79B8FF">0</span><span style="color: #E1E4E8">);</span></span>
<span class="line"><span style="color: #E1E4E8">                }</span></span>
<span class="line"><span style="color: #E1E4E8">            }</span></span>
<span class="line"><span style="color: #E1E4E8">        }</span></span>
<span class="line"><span style="color: #E1E4E8">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">using</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">outputStream</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">MemoryStream</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">var</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">encoder</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">new</span><span style="color: #E1E4E8"> </span><span style="color: #B392F0">PngEncoder</span><span style="color: #E1E4E8"> { ColorType </span><span style="color: #F97583">=</span><span style="color: #E1E4E8"> PngColorType.RgbWithAlpha };</span></span>
<span class="line"><span style="color: #E1E4E8">    image.</span><span style="color: #B392F0">SaveAsPng</span><span style="color: #E1E4E8">(outputStream, encoder);</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #F97583">return</span><span style="color: #E1E4E8"> outputStream.</span><span style="color: #B392F0">ToArray</span><span style="color: #E1E4E8">();</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<h2 id="evaluation"><a href="#evaluation">Evaluation</a></h2>
<p>This approach works well for most use cases, but has some limitations:</p>
<ul>
<li>
<p><strong>No anti-aliasing</strong> between the transparent background and the foreground. A proper solution would involve calculating partial transparency based on how close each pixel is to the target color.</p>
</li>
<li>
<p><strong>Green pixel islands</strong>: Occasionally, small isolated patches of greenish pixels remain in what should be transparent areas. Ideally these would be detected and removed.</p>
</li>
</ul>
<p>...and also DALL-E 3 is <a href="https://community.openai.com/t/openai-is-making-a-huge-mistake-by-deprecating-dall-e-3/1367228">scheduled to shut down</a> in 2026.</p>c:["$","div",null,{"className":"flex justify-center","children":["$","div",null,{"className":"md:px-10 min-w-0 max-w-7xl mb-12","children":["$","article",null,{"children":[["$","header",null,{"className":"px-5 mb-4 py-10 relative","children":[["$","h1",null,{"className":"text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100","children":"Transparent Backgrounds with OpenAI DALL-E 3"}],["$","time",null,{"dateTime":"2025-12-10 16:00","className":"pl-1 font-serif text-slate-400 bottom-0 absolute","children":[["$","svg",null,{"className":"h-4 w-4 inline-block","width":"24","height":"24","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":"2","strokeLinecap":"round","strokeLinejoin":"round","children":[["$","path",null,{"d":"M12 19l7-7 3 3-7 7-3-3z"}]," ",["$","path",null,{"d":"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}]," ",["$","path",null,{"d":"M2 2l7.586 7.586"}]," ",["$","circle",null,{"cx":"11","cy":"11","r":"2"}]]}]," ","2025-12-10 16:00"]}]]}],["$","div",null,{"className":"bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg","children":["$undefined",["$","div",null,{"className":"space-y-4","dangerouslySetInnerHTML":{"__html":"$d"}}]]}]]}]}]}]
b:null
