<!DOCTYPE html><html lang="en" class="__variable_eb9fb7 __variable_2fad4c"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="font" href="/_next/static/media/583a894d7b920fb7-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="font" href="/_next/static/media/e807dee2426166ad-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/cf6d346f04b2f900.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/4823b726c835f640.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-efd16f5debe934f5.js" as="script" fetchPriority="low"/><script src="/_next/static/chunks/fd9d1056-9200b628bfbdc6da.js" async=""></script><script src="/_next/static/chunks/596-98393ace57ba3968.js" async=""></script><script src="/_next/static/chunks/main-app-d44f2405d2730b2d.js" async=""></script><title>Env Vars in Claude Code Sub-Agent Chain | Food for AI blog</title><meta name="description" content="Blog about .NET, Azure, React and whatever comes to mind."/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="bg-slate-200 dark:bg-slate-700"><nav class="w-full flex flex-row justify-between items-center bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans"><div class="p-2"><a class="text-2xl font-semibold text-neutral-100 dark:text-neutral-200" href="/"><h1 class="inline">üçî food for ai</h1> <span class="font-mono font-light text-xs">food.joona.cloud</span></a></div></nav><main class="mt-4"><div class="flex justify-center"><div class="md:px-10 min-w-0 max-w-7xl mb-12"><article><header class="px-5 mb-4 py-10 relative"><h1 class="text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100">Env Vars in Claude Code Sub-Agent Chain</h1><time dateTime="2025-12-01 16:00" class="pl-1 font-serif text-slate-400 bottom-0 absolute"><svg class="h-4 w-4 inline-block" width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"></path> <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path> <path d="M2 2l7.586 7.586"></path> <circle cx="11" cy="11" r="2"></circle></svg> <!-- -->2025-12-01 16:00</time></header><div class="bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg"><p class="italic text-slate-400 p-4">This article was written based on Claude Code v2.0.55.</p><hr class="h-px my-4 bg-gray-200 border-0 dark:bg-gray-700"/><div class="space-y-4"><p><a href="https://docs.anthropic.com/en/docs/claude-code/overview">Claude Code</a>'s <a href="https://code.claude.com/docs/en/sub-agents">sub-agent</a> system is powerful for breaking down complex tasks, but there's a gap: environment variables set in a parent agent don't automatically propagate to child sub-agents. This article presents a hooks-based solution that enables environment variable inheritance across the entire agent chain.</p>
<h2 id="the-problem"><a href="#the-problem">The Problem</a></h2>
<p>Consider this scenario: you ask Claude Code to set an environment variable and then spawn a sub-agent, expecting the sub-agent to read that variable:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="light"><code data-language="bash" data-theme="light"><span class="line"><span style="color: #6F42C1">USER:</span></span>
<span class="line"><span style="color: #032F62">"Hi! Please set env var MYSTERY to 42 and then spawn a sub-agent and ask them</span></span>
<span class="line"><span style="color: #032F62"> to check what value they have in their MYSTERY env var."</span></span></code></pre><pre data-language="bash" data-theme="dark"><code data-language="bash" data-theme="dark"><span class="line"><span style="color: #B392F0">USER:</span></span>
<span class="line"><span style="color: #9ECBFF">"Hi! Please set env var MYSTERY to 42 and then spawn a sub-agent and ask them</span></span>
<span class="line"><span style="color: #9ECBFF"> to check what value they have in their MYSTERY env var."</span></span></code></pre></div>
<p>The sub-agent won't see <code>MYSTERY=42</code>. Sub-agents are separate processes ‚Äî when Claude Code spawns one, it creates a new instance with a fresh environment. Variables set in the parent exist only in that parent's memory space and don't propagate to children created later.</p>
<p>This creates friction in agent orchestration. Without variable inheritance, passing context and parameters to sub-agents requires either including them in downstream prompts or adding instructions to sub-agent workflows ‚Äî both of which <strong>waste inference time and tokens</strong>.</p>
<h2 id="the-solution-a-file-based-environment-stack"><a href="#the-solution-a-file-based-environment-stack">The Solution: A File-Based Environment Stack</a></h2>
<p>The key insight is to use the filesystem as a shared state mechanism, combined with Claude Code's <a href="https://docs.claude.com/en/docs/claude-code/hooks">hooks</a> system to manage the lifecycle. Here's the high-level approach:</p>
<ol>
<li><strong>A working directory</strong> (<code>.claude/env-vars/</code>) stores environment variable files</li>
<li><strong>A helper script</strong> writes variables to the current env file</li>
<li><strong>Hooks</strong> manage the stack of env files and inject them into Bash commands</li>
</ol>
<p>Hooks are shell commands that Claude Code executes automatically at specific lifecycle events ‚Äî when the user submits a prompt, before a tool runs, or when a sub-agent completes. They can inspect and modify tool inputs, block actions, or perform side effects. This makes them ideal for injecting our environment variable logic at exactly the right moments.</p>
<p>The "stack" is crucial for nested sub-agents. When a root agent spawns a sub-agent (level 1), which then spawns another sub-agent (level 2), we need separate env files for each level. The stack ensures that:</p>
<ul>
<li>Each agent writes to its own file (avoiding conflicts)</li>
<li>All agents see variables from parent agents (via sourcing all files in order)</li>
<li>When an agent completes, only its file is removed (preserving parent state)</li>
</ul>
<h2 id="implementation"><a href="#implementation">Implementation</a></h2>
<h3 id="directory-structure"><a href="#directory-structure">Directory Structure</a></h3>
<pre><code>your-project/
  .claude/
    settings.local.json
    env-vars/
      env-vars1
      env-vars2
      ...
    hooks/
      user-prompt-submit.sh
      pre-tool-use-task.sh
      pre-tool-use-bash.sh
      subagent-stop.sh
  setenv.sh
</code></pre>
<h3 id="hook-configuration"><a href="#hook-configuration">Hook Configuration</a></h3>
<p>In <code>.claude/settings.local.json</code>:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="json" data-theme="light"><code data-language="json" data-theme="light"><span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #005CC5">"hooks"</span><span style="color: #24292E">: {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">"UserPromptSubmit"</span><span style="color: #24292E">: [</span></span>
<span class="line"><span style="color: #24292E">      {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"matcher"</span><span style="color: #24292E">: </span><span style="color: #032F62">""</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"hooks"</span><span style="color: #24292E">: [</span></span>
<span class="line"><span style="color: #24292E">          {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"type"</span><span style="color: #24292E">: </span><span style="color: #032F62">"command"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"command"</span><span style="color: #24292E">: </span><span style="color: #032F62">"./.claude/hooks/user-prompt-submit.sh"</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">        ]</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    ],</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">"PreToolUse"</span><span style="color: #24292E">: [</span></span>
<span class="line"><span style="color: #24292E">      {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"matcher"</span><span style="color: #24292E">: </span><span style="color: #032F62">"Task"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"hooks"</span><span style="color: #24292E">: [</span></span>
<span class="line"><span style="color: #24292E">          {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"type"</span><span style="color: #24292E">: </span><span style="color: #032F62">"command"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"command"</span><span style="color: #24292E">: </span><span style="color: #032F62">"./.claude/hooks/pre-tool-use-task.sh"</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">        ]</span></span>
<span class="line"><span style="color: #24292E">      },</span></span>
<span class="line"><span style="color: #24292E">      {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"matcher"</span><span style="color: #24292E">: </span><span style="color: #032F62">"Bash"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"hooks"</span><span style="color: #24292E">: [</span></span>
<span class="line"><span style="color: #24292E">          {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"type"</span><span style="color: #24292E">: </span><span style="color: #032F62">"command"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"command"</span><span style="color: #24292E">: </span><span style="color: #032F62">"./.claude/hooks/pre-tool-use-bash.sh"</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">        ]</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    ],</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">"SubagentStop"</span><span style="color: #24292E">: [</span></span>
<span class="line"><span style="color: #24292E">      {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"matcher"</span><span style="color: #24292E">: </span><span style="color: #032F62">""</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #005CC5">"hooks"</span><span style="color: #24292E">: [</span></span>
<span class="line"><span style="color: #24292E">          {</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"type"</span><span style="color: #24292E">: </span><span style="color: #032F62">"command"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">            </span><span style="color: #005CC5">"command"</span><span style="color: #24292E">: </span><span style="color: #032F62">"./.claude/hooks/subagent-stop.sh"</span></span>
<span class="line"><span style="color: #24292E">          }</span></span>
<span class="line"><span style="color: #24292E">        ]</span></span>
<span class="line"><span style="color: #24292E">      }</span></span>
<span class="line"><span style="color: #24292E">    ]</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span></code></pre><pre data-language="json" data-theme="dark"><code data-language="json" data-theme="dark"><span class="line"><span style="color: #E1E4E8">{</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #79B8FF">"hooks"</span><span style="color: #E1E4E8">: {</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"UserPromptSubmit"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">      {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"matcher"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">""</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"hooks"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">          {</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"command"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"command"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"./.claude/hooks/user-prompt-submit.sh"</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">        ]</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"><span style="color: #E1E4E8">    ],</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"PreToolUse"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">      {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"matcher"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Task"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"hooks"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">          {</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"command"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"command"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"./.claude/hooks/pre-tool-use-task.sh"</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">        ]</span></span>
<span class="line"><span style="color: #E1E4E8">      },</span></span>
<span class="line"><span style="color: #E1E4E8">      {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"matcher"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"Bash"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"hooks"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">          {</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"command"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"command"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"./.claude/hooks/pre-tool-use-bash.sh"</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">        ]</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"><span style="color: #E1E4E8">    ],</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">"SubagentStop"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">      {</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"matcher"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">""</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">        </span><span style="color: #79B8FF">"hooks"</span><span style="color: #E1E4E8">: [</span></span>
<span class="line"><span style="color: #E1E4E8">          {</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"type"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"command"</span><span style="color: #E1E4E8">,</span></span>
<span class="line"><span style="color: #E1E4E8">            </span><span style="color: #79B8FF">"command"</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"./.claude/hooks/subagent-stop.sh"</span></span>
<span class="line"><span style="color: #E1E4E8">          }</span></span>
<span class="line"><span style="color: #E1E4E8">        ]</span></span>
<span class="line"><span style="color: #E1E4E8">      }</span></span>
<span class="line"><span style="color: #E1E4E8">    ]</span></span>
<span class="line"><span style="color: #E1E4E8">  }</span></span>
<span class="line"><span style="color: #E1E4E8">}</span></span></code></pre></div>
<p>The hooks serve distinct purposes:</p>
<ul>
<li><a href="https://docs.claude.com/en/docs/claude-code/hooks#hook-events"><strong>UserPromptSubmit</strong></a>: Fires when the user sends a message; we use it to reset state for new conversations</li>
<li><a href="https://docs.claude.com/en/docs/claude-code/hooks#hook-events"><strong>PreToolUse</strong></a>(Task): Fires before spawning a sub-agent; we push a new env file onto the stack</li>
<li><strong>PreToolUse</strong>(Bash): Fires before every Bash command; we inject env vars by modifying the command</li>
<li><a href="https://docs.claude.com/en/docs/claude-code/hooks#hook-events"><strong>SubagentStop</strong></a>: Fires when a sub-agent completes; we pop its env file from the stack</li>
</ul>
<h3 id="the-hooks"><a href="#the-hooks">The Hooks</a></h3>
<h4 id="1-userpromptsubmit-hook---session-reset"><a href="#1-userpromptsubmit-hook---session-reset"><strong>1. UserPromptSubmit Hook - Session Reset</strong></a></h4>
<p>This hook clears the working directory when a new user prompt is submitted, ensuring a fresh start:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="light"><code data-language="bash" data-theme="light"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: UserPromptSubmit - clears env-vars directory</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">-d</span><span style="color: #032F62"> ".claude/env-vars"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">rm</span><span style="color: #24292E"> </span><span style="color: #005CC5">-rf</span><span style="color: #24292E"> </span><span style="color: #032F62">.claude/env-vars</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span></code></pre><pre data-language="bash" data-theme="dark"><code data-language="bash" data-theme="dark"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: UserPromptSubmit - clears env-vars directory</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">-d</span><span style="color: #9ECBFF"> ".claude/env-vars"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">rm</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">-rf</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">.claude/env-vars</span></span>
<span class="line"><span style="color: #F97583">fi</span></span></code></pre></div>
<p>This reset ensures that each new conversation starts with a clean slate.</p>
<h4 id="2-pretoolusetask-hook---stack-push"><a href="#2-pretoolusetask-hook---stack-push"><strong>2. PreToolUse(Task) Hook - Stack Push</strong></a></h4>
<p>When a sub-agent is spawned, create a new env file for that level:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="light"><code data-language="bash" data-theme="light"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: PreToolUse(Task) - adds new env file for sub-agent</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">!</span><span style="color: #24292E"> </span><span style="color: #D73A49">-d</span><span style="color: #032F62"> ".claude/env-vars"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">exit</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># Find the last env file number and create the next one</span></span>
<span class="line"><span style="color: #24292E">last_file</span><span style="color: #D73A49">=</span><span style="color: #032F62">$(</span><span style="color: #6F42C1">ls</span><span style="color: #032F62"> </span><span style="color: #005CC5">-1</span><span style="color: #032F62"> .claude/env-vars/env-vars</span><span style="color: #005CC5">*</span><span style="color: #032F62"> </span><span style="color: #D73A49">2></span><span style="color: #032F62">/dev/null </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">sort</span><span style="color: #032F62"> </span><span style="color: #005CC5">-V</span><span style="color: #032F62"> </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">tail</span><span style="color: #032F62"> </span><span style="color: #005CC5">-1</span><span style="color: #032F62">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">-z</span><span style="color: #032F62"> "</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    next_num</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #D73A49">else</span></span>
<span class="line"><span style="color: #24292E">    last_num</span><span style="color: #D73A49">=</span><span style="color: #032F62">$(</span><span style="color: #6F42C1">basename</span><span style="color: #032F62"> "</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">" </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">sed</span><span style="color: #032F62"> 's/env-vars//')</span></span>
<span class="line"><span style="color: #24292E">    next_num</span><span style="color: #D73A49">=</span><span style="color: #032F62">$((last_num </span><span style="color: #D73A49">+</span><span style="color: #032F62"> </span><span style="color: #005CC5">1</span><span style="color: #032F62">))</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">touch</span><span style="color: #24292E"> </span><span style="color: #032F62">".claude/env-vars/env-vars${next_num}"</span></span></code></pre><pre data-language="bash" data-theme="dark"><code data-language="bash" data-theme="dark"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: PreToolUse(Task) - adds new env file for sub-agent</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">!</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-d</span><span style="color: #9ECBFF"> ".claude/env-vars"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">exit</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># Find the last env file number and create the next one</span></span>
<span class="line"><span style="color: #E1E4E8">last_file</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$(</span><span style="color: #B392F0">ls</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-1</span><span style="color: #9ECBFF"> .claude/env-vars/env-vars</span><span style="color: #79B8FF">*</span><span style="color: #9ECBFF"> </span><span style="color: #F97583">2></span><span style="color: #9ECBFF">/dev/null </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">sort</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-V</span><span style="color: #9ECBFF"> </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">tail</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-1</span><span style="color: #9ECBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">-z</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    next_num</span><span style="color: #F97583">=</span><span style="color: #79B8FF">1</span></span>
<span class="line"><span style="color: #F97583">else</span></span>
<span class="line"><span style="color: #E1E4E8">    last_num</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$(</span><span style="color: #B392F0">basename</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">" </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">sed</span><span style="color: #9ECBFF"> 's/env-vars//')</span></span>
<span class="line"><span style="color: #E1E4E8">    next_num</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$((last_num </span><span style="color: #F97583">+</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">1</span><span style="color: #9ECBFF">))</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B392F0">touch</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">".claude/env-vars/env-vars${next_num}"</span></span></code></pre></div>
<h4 id="3-pretoolusebash-hook---environment-injection"><a href="#3-pretoolusebash-hook---environment-injection"><strong>3. PreToolUse(Bash) Hook - Environment Injection</strong></a></h4>
<p>This hook prepends sourcing of all env files to <em>every Bash command</em>:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="light"><code data-language="bash" data-theme="light"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: PreToolUse(Bash) - injects env vars into commands</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">!</span><span style="color: #24292E"> </span><span style="color: #D73A49">-d</span><span style="color: #032F62"> ".claude/env-vars"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">exit</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">envvars_files</span><span style="color: #D73A49">=</span><span style="color: #032F62">$(</span><span style="color: #6F42C1">ls</span><span style="color: #032F62"> </span><span style="color: #005CC5">-1</span><span style="color: #032F62"> .claude/env-vars/env-vars</span><span style="color: #005CC5">*</span><span style="color: #032F62"> </span><span style="color: #D73A49">2></span><span style="color: #032F62">/dev/null </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">sort</span><span style="color: #032F62"> </span><span style="color: #005CC5">-V</span><span style="color: #032F62">)</span></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">-z</span><span style="color: #032F62"> "</span><span style="color: #24292E">$envvars_files</span><span style="color: #032F62">"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">exit</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">input</span><span style="color: #D73A49">=</span><span style="color: #032F62">$(</span><span style="color: #6F42C1">cat</span><span style="color: #032F62">)</span></span>
<span class="line"><span style="color: #24292E">command</span><span style="color: #D73A49">=</span><span style="color: #032F62">$(</span><span style="color: #005CC5">echo</span><span style="color: #032F62"> "</span><span style="color: #24292E">$input</span><span style="color: #032F62">" </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">jq</span><span style="color: #032F62"> </span><span style="color: #005CC5">-r</span><span style="color: #032F62"> '.tool_input.command // empty')</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">-z</span><span style="color: #032F62"> "</span><span style="color: #24292E">$command</span><span style="color: #032F62">"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">exit</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># Build source prefix for all env files</span></span>
<span class="line"><span style="color: #24292E">source_prefix</span><span style="color: #D73A49">=</span><span style="color: #032F62">""</span></span>
<span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> envvars_file </span><span style="color: #D73A49">in</span><span style="color: #24292E"> $envvars_files; </span><span style="color: #D73A49">do</span></span>
<span class="line"><span style="color: #24292E">    source_prefix</span><span style="color: #D73A49">=</span><span style="color: #032F62">"${source_prefix}set -a; source </span><span style="color: #005CC5">\"</span><span style="color: #24292E">$envvars_file</span><span style="color: #005CC5">\"</span><span style="color: #032F62">; set +a; "</span></span>
<span class="line"><span style="color: #D73A49">done</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">new_command</span><span style="color: #D73A49">=</span><span style="color: #032F62">"${source_prefix}${command}"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">jq</span><span style="color: #24292E"> </span><span style="color: #005CC5">-n</span><span style="color: #24292E"> </span><span style="color: #005CC5">--arg</span><span style="color: #24292E"> </span><span style="color: #032F62">cmd</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$new_command</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #032F62">'{</span></span>
<span class="line"><span style="color: #032F62">  "hookSpecificOutput": {</span></span>
<span class="line"><span style="color: #032F62">    "hookEventName": "PreToolUse",</span></span>
<span class="line"><span style="color: #032F62">    "permissionDecision": "allow",</span></span>
<span class="line"><span style="color: #032F62">    "updatedInput": {"command": $cmd}</span></span>
<span class="line"><span style="color: #032F62">  }</span></span>
<span class="line"><span style="color: #032F62">}'</span></span></code></pre><pre data-language="bash" data-theme="dark"><code data-language="bash" data-theme="dark"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: PreToolUse(Bash) - injects env vars into commands</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">!</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-d</span><span style="color: #9ECBFF"> ".claude/env-vars"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">exit</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">envvars_files</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$(</span><span style="color: #B392F0">ls</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-1</span><span style="color: #9ECBFF"> .claude/env-vars/env-vars</span><span style="color: #79B8FF">*</span><span style="color: #9ECBFF"> </span><span style="color: #F97583">2></span><span style="color: #9ECBFF">/dev/null </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">sort</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-V</span><span style="color: #9ECBFF">)</span></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">-z</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$envvars_files</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">exit</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">input</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$(</span><span style="color: #B392F0">cat</span><span style="color: #9ECBFF">)</span></span>
<span class="line"><span style="color: #E1E4E8">command</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$(</span><span style="color: #79B8FF">echo</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$input</span><span style="color: #9ECBFF">" </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">jq</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-r</span><span style="color: #9ECBFF"> '.tool_input.command // empty')</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">-z</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$command</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">exit</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># Build source prefix for all env files</span></span>
<span class="line"><span style="color: #E1E4E8">source_prefix</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">""</span></span>
<span class="line"><span style="color: #F97583">for</span><span style="color: #E1E4E8"> envvars_file </span><span style="color: #F97583">in</span><span style="color: #E1E4E8"> $envvars_files; </span><span style="color: #F97583">do</span></span>
<span class="line"><span style="color: #E1E4E8">    source_prefix</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"${source_prefix}set -a; source </span><span style="color: #79B8FF">\"</span><span style="color: #E1E4E8">$envvars_file</span><span style="color: #79B8FF">\"</span><span style="color: #9ECBFF">; set +a; "</span></span>
<span class="line"><span style="color: #F97583">done</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">new_command</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"${source_prefix}${command}"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B392F0">jq</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">-n</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">--arg</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">cmd</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$new_command</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">'{</span></span>
<span class="line"><span style="color: #9ECBFF">  "hookSpecificOutput": {</span></span>
<span class="line"><span style="color: #9ECBFF">    "hookEventName": "PreToolUse",</span></span>
<span class="line"><span style="color: #9ECBFF">    "permissionDecision": "allow",</span></span>
<span class="line"><span style="color: #9ECBFF">    "updatedInput": {"command": $cmd}</span></span>
<span class="line"><span style="color: #9ECBFF">  }</span></span>
<span class="line"><span style="color: #9ECBFF">}'</span></span></code></pre></div>
<p>If a child agent redefines a parent's variable, the child's value takes precedence. Since we source files in order (parent first, then children), later assignments override earlier ones.</p>
<h4 id="4-subagentstop-hook---stack-pop"><a href="#4-subagentstop-hook---stack-pop"><strong>4. SubagentStop Hook - Stack Pop</strong></a></h4>
<p>When a sub-agent completes, remove its env file:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="light"><code data-language="bash" data-theme="light"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: SubagentStop - removes the sub-agent's env file</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">!</span><span style="color: #24292E"> </span><span style="color: #D73A49">-d</span><span style="color: #032F62"> ".claude/env-vars"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">exit</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">last_file</span><span style="color: #D73A49">=</span><span style="color: #032F62">$(</span><span style="color: #6F42C1">ls</span><span style="color: #032F62"> </span><span style="color: #005CC5">-1</span><span style="color: #032F62"> .claude/env-vars/env-vars</span><span style="color: #005CC5">*</span><span style="color: #032F62"> </span><span style="color: #D73A49">2></span><span style="color: #032F62">/dev/null </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">sort</span><span style="color: #032F62"> </span><span style="color: #005CC5">-V</span><span style="color: #032F62"> </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">tail</span><span style="color: #032F62"> </span><span style="color: #005CC5">-1</span><span style="color: #032F62">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">-n</span><span style="color: #032F62"> "</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">rm</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span></code></pre><pre data-language="bash" data-theme="dark"><code data-language="bash" data-theme="dark"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Hook: SubagentStop - removes the sub-agent's env file</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">!</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-d</span><span style="color: #9ECBFF"> ".claude/env-vars"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">exit</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">0</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">last_file</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$(</span><span style="color: #B392F0">ls</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-1</span><span style="color: #9ECBFF"> .claude/env-vars/env-vars</span><span style="color: #79B8FF">*</span><span style="color: #9ECBFF"> </span><span style="color: #F97583">2></span><span style="color: #9ECBFF">/dev/null </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">sort</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-V</span><span style="color: #9ECBFF"> </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">tail</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-1</span><span style="color: #9ECBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">-n</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">rm</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span></span>
<span class="line"><span style="color: #F97583">fi</span></span></code></pre></div>
<p>This implements a classic stack "pop" operation ‚Äî the last file always belongs to the most recently spawned sub-agent.</p>
<h3 id="the-setenv-script"><a href="#the-setenv-script">The Setenv Script</a></h3>
<p>A helper script to write variables to the current agent's env file:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="light"><code data-language="bash" data-theme="light"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Sets a variable in the current agent's env file</span></span>
<span class="line"><span style="color: #6A737D"># Usage: ./setenv.sh VAR_NAME "value"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">$#</span><span style="color: #24292E"> </span><span style="color: #D73A49">-lt</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">echo</span><span style="color: #24292E"> </span><span style="color: #032F62">"Usage: </span><span style="color: #005CC5">$0</span><span style="color: #032F62"> VAR_NAME value"</span><span style="color: #24292E"> </span><span style="color: #D73A49">>&#x26;2</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">exit</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">var_name</span><span style="color: #D73A49">=</span><span style="color: #032F62">"</span><span style="color: #005CC5">$1</span><span style="color: #032F62">"</span></span>
<span class="line"><span style="color: #24292E">var_value</span><span style="color: #D73A49">=</span><span style="color: #032F62">"</span><span style="color: #005CC5">$2</span><span style="color: #032F62">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">SCRIPT_DIR</span><span style="color: #D73A49">=</span><span style="color: #032F62">"$(</span><span style="color: #005CC5">cd</span><span style="color: #032F62"> "$(</span><span style="color: #6F42C1">dirname</span><span style="color: #032F62"> "${BASH_SOURCE[0]}")" &#x26;&#x26; </span><span style="color: #005CC5">pwd</span><span style="color: #032F62">)"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">mkdir</span><span style="color: #24292E"> </span><span style="color: #005CC5">-p</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$SCRIPT_DIR</span><span style="color: #032F62">/.claude/env-vars"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">last_file</span><span style="color: #D73A49">=</span><span style="color: #032F62">$(</span><span style="color: #6F42C1">ls</span><span style="color: #032F62"> </span><span style="color: #005CC5">-1</span><span style="color: #032F62"> "</span><span style="color: #24292E">$SCRIPT_DIR</span><span style="color: #032F62">/.claude/env-vars"/env-vars</span><span style="color: #005CC5">*</span><span style="color: #032F62"> </span><span style="color: #D73A49">2></span><span style="color: #032F62">/dev/null </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">sort</span><span style="color: #032F62"> </span><span style="color: #005CC5">-V</span><span style="color: #032F62"> </span><span style="color: #D73A49">|</span><span style="color: #032F62"> </span><span style="color: #6F42C1">tail</span><span style="color: #032F62"> </span><span style="color: #005CC5">-1</span><span style="color: #032F62">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> [ </span><span style="color: #D73A49">-z</span><span style="color: #032F62"> "</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span><span style="color: #24292E"> ]; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    last_file</span><span style="color: #D73A49">=</span><span style="color: #032F62">"</span><span style="color: #24292E">$SCRIPT_DIR</span><span style="color: #032F62">/.claude/env-vars/env-vars1"</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">touch</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> grep -q</span><span style="color: #032F62"> "^${var_name}=" "</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span><span style="color: #24292E"> </span><span style="color: #005CC5">2</span><span style="color: #D73A49">></span><span style="color: #24292E">/dev/null; </span><span style="color: #D73A49">then</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6F42C1">sed</span><span style="color: #24292E"> </span><span style="color: #005CC5">-i</span><span style="color: #24292E"> </span><span style="color: #032F62">"s|^${var_name}=.*|${var_name}=${var_value}|"</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span></span>
<span class="line"><span style="color: #D73A49">else</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #005CC5">echo</span><span style="color: #24292E"> </span><span style="color: #032F62">"${var_name}=${var_value}"</span><span style="color: #24292E"> </span><span style="color: #D73A49">>></span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #24292E">$last_file</span><span style="color: #032F62">"</span></span>
<span class="line"><span style="color: #D73A49">fi</span></span></code></pre><pre data-language="bash" data-theme="dark"><code data-language="bash" data-theme="dark"><span class="line"><span style="color: #6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color: #6A737D"># Sets a variable in the current agent's env file</span></span>
<span class="line"><span style="color: #6A737D"># Usage: ./setenv.sh VAR_NAME "value"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #79B8FF">$#</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">-lt</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">2</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">echo</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"Usage: </span><span style="color: #79B8FF">$0</span><span style="color: #9ECBFF"> VAR_NAME value"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">>&#x26;2</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">exit</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">1</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">var_name</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"</span><span style="color: #79B8FF">$1</span><span style="color: #9ECBFF">"</span></span>
<span class="line"><span style="color: #E1E4E8">var_value</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"</span><span style="color: #79B8FF">$2</span><span style="color: #9ECBFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">SCRIPT_DIR</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"$(</span><span style="color: #79B8FF">cd</span><span style="color: #9ECBFF"> "$(</span><span style="color: #B392F0">dirname</span><span style="color: #9ECBFF"> "${BASH_SOURCE[0]}")" &#x26;&#x26; </span><span style="color: #79B8FF">pwd</span><span style="color: #9ECBFF">)"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B392F0">mkdir</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">-p</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$SCRIPT_DIR</span><span style="color: #9ECBFF">/.claude/env-vars"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E1E4E8">last_file</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">$(</span><span style="color: #B392F0">ls</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-1</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$SCRIPT_DIR</span><span style="color: #9ECBFF">/.claude/env-vars"/env-vars</span><span style="color: #79B8FF">*</span><span style="color: #9ECBFF"> </span><span style="color: #F97583">2></span><span style="color: #9ECBFF">/dev/null </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">sort</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-V</span><span style="color: #9ECBFF"> </span><span style="color: #F97583">|</span><span style="color: #9ECBFF"> </span><span style="color: #B392F0">tail</span><span style="color: #9ECBFF"> </span><span style="color: #79B8FF">-1</span><span style="color: #9ECBFF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> [ </span><span style="color: #F97583">-z</span><span style="color: #9ECBFF"> "</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> ]; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    last_file</span><span style="color: #F97583">=</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$SCRIPT_DIR</span><span style="color: #9ECBFF">/.claude/env-vars/env-vars1"</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">touch</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span></span>
<span class="line"><span style="color: #F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F97583">if</span><span style="color: #E1E4E8"> grep -q</span><span style="color: #9ECBFF"> "^${var_name}=" "</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">2</span><span style="color: #F97583">></span><span style="color: #E1E4E8">/dev/null; </span><span style="color: #F97583">then</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #B392F0">sed</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">-i</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"s|^${var_name}=.*|${var_name}=${var_value}|"</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span></span>
<span class="line"><span style="color: #F97583">else</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #79B8FF">echo</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"${var_name}=${var_value}"</span><span style="color: #E1E4E8"> </span><span style="color: #F97583">>></span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">"</span><span style="color: #E1E4E8">$last_file</span><span style="color: #9ECBFF">"</span></span>
<span class="line"><span style="color: #F97583">fi</span></span></code></pre></div>
<p>Don't forget to make this script executable: <code>chmod +x ./setenv.sh</code>. All hook scripts in <code>.claude/hooks/</code> also need execute permissions.</p>
<h2 id="example"><a href="#example">Example</a></h2>
<p>Here's a conversation demonstrating the environment variable inheritance:</p>
<div data-rehype-pretty-code-fragment=""><pre data-language="bash" data-theme="light"><code data-language="bash" data-theme="light"><span class="line"><span style="color: #6F42C1">USER:</span></span>
<span class="line"><span style="color: #032F62">"Set MYSTERY to 42 using setenv.sh, then spawn a sub-agent. The sub-agent</span></span>
<span class="line"><span style="color: #032F62"> should check the MYSTERY value, set ANOTHER to 67, then complete. After that,</span></span>
<span class="line"><span style="color: #032F62"> check if ANOTHER is still available."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">AGENT:</span></span>
<span class="line"><span style="color: #032F62">"I'll set MYSTERY and spawn a sub-agent."</span></span>
<span class="line"><span style="color: #6F42C1">$</span><span style="color: #24292E"> </span><span style="color: #032F62">./setenv.sh</span><span style="color: #24292E"> </span><span style="color: #032F62">MYSTERY</span><span style="color: #24292E"> </span><span style="color: #005CC5">42</span></span>
<span class="line"><span style="color: #032F62">"Now spawning a sub-agent to check MYSTERY and set ANOTHER..."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">SUB-AGENT:</span></span>
<span class="line"><span style="color: #6F42C1">$</span><span style="color: #24292E"> </span><span style="color: #032F62">echo</span><span style="color: #24292E"> $MYSTERY</span></span>
<span class="line"><span style="color: #005CC5">42</span></span>
<span class="line"><span style="color: #6F42C1">$</span><span style="color: #24292E"> </span><span style="color: #032F62">./setenv.sh</span><span style="color: #24292E"> </span><span style="color: #032F62">ANOTHER</span><span style="color: #24292E"> </span><span style="color: #005CC5">67</span></span>
<span class="line"><span style="color: #6F42C1">$</span><span style="color: #24292E"> </span><span style="color: #032F62">echo</span><span style="color: #24292E"> $ANOTHER</span></span>
<span class="line"><span style="color: #005CC5">67</span></span>
<span class="line"><span style="color: #6A737D"># Task complete.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">AGENT:</span></span>
<span class="line"><span style="color: #032F62">"The sub-agent confirmed MYSTERY=42 and set ANOTHER=67. Let me check if</span></span>
<span class="line"><span style="color: #032F62"> ANOTHER persists:"</span></span>
<span class="line"><span style="color: #6F42C1">$</span><span style="color: #24292E"> </span><span style="color: #032F62">echo</span><span style="color: #24292E"> $ANOTHER</span></span>
<span class="line"><span style="color: #6A737D"># (empty)</span></span></code></pre><pre data-language="bash" data-theme="dark"><code data-language="bash" data-theme="dark"><span class="line"><span style="color: #B392F0">USER:</span></span>
<span class="line"><span style="color: #9ECBFF">"Set MYSTERY to 42 using setenv.sh, then spawn a sub-agent. The sub-agent</span></span>
<span class="line"><span style="color: #9ECBFF"> should check the MYSTERY value, set ANOTHER to 67, then complete. After that,</span></span>
<span class="line"><span style="color: #9ECBFF"> check if ANOTHER is still available."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B392F0">AGENT:</span></span>
<span class="line"><span style="color: #9ECBFF">"I'll set MYSTERY and spawn a sub-agent."</span></span>
<span class="line"><span style="color: #B392F0">$</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">./setenv.sh</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">MYSTERY</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">42</span></span>
<span class="line"><span style="color: #9ECBFF">"Now spawning a sub-agent to check MYSTERY and set ANOTHER..."</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B392F0">SUB-AGENT:</span></span>
<span class="line"><span style="color: #B392F0">$</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">echo</span><span style="color: #E1E4E8"> $MYSTERY</span></span>
<span class="line"><span style="color: #79B8FF">42</span></span>
<span class="line"><span style="color: #B392F0">$</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">./setenv.sh</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">ANOTHER</span><span style="color: #E1E4E8"> </span><span style="color: #79B8FF">67</span></span>
<span class="line"><span style="color: #B392F0">$</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">echo</span><span style="color: #E1E4E8"> $ANOTHER</span></span>
<span class="line"><span style="color: #79B8FF">67</span></span>
<span class="line"><span style="color: #6A737D"># Task complete.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #B392F0">AGENT:</span></span>
<span class="line"><span style="color: #9ECBFF">"The sub-agent confirmed MYSTERY=42 and set ANOTHER=67. Let me check if</span></span>
<span class="line"><span style="color: #9ECBFF"> ANOTHER persists:"</span></span>
<span class="line"><span style="color: #B392F0">$</span><span style="color: #E1E4E8"> </span><span style="color: #9ECBFF">echo</span><span style="color: #E1E4E8"> $ANOTHER</span></span>
<span class="line"><span style="color: #6A737D"># (empty)</span></span></code></pre></div>
<p>As expected, <code>ANOTHER</code> is not available. When the sub-agent completed, its env file (containing <code>ANOTHER=67</code>) was removed by the SubagentStop hook. Only the parent's variables persist.</p>
<h2 id="conclusion"><a href="#conclusion">Conclusion</a></h2>
<p>We achieved transparent environment variable inheritance across the agent hierarchy without modifying prompts or wasting tokens on parameter passing. The stack-based approach correctly handles nested sub-agents and ensures proper cleanup when agents complete.</p>
<p>Note that this solution is simplified and supports only one Claude Code session at a time.</p></div></div></article></div></div></main><script src="/_next/static/chunks/webpack-efd16f5debe934f5.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/583a894d7b920fb7-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/e807dee2426166ad-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n3:HL[\"/_next/static/css/cf6d346f04b2f900.css\",{\"as\":\"style\"}]\n0:\"$L4\"\n"])</script><script>self.__next_f.push([1,"5:HL[\"/_next/static/css/4823b726c835f640.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"6:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-98393ace57ba3968.js\"],\"name\":\"default\",\"async\":false}\n8:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-98393ace57ba3968.js\"],\"name\":\"\",\"async\":false}\n9:I{\"id\":6685,\"chunks\":[\"685:static/chunks/685-8c2a2ee442f8842a.js\",\"185:static/chunks/app/layout-4978ca41370bd554.js\"],\"na"])</script><script>self.__next_f.push([1,"me\":\"\",\"async\":false}\na:I{\"id\":6112,\"chunks\":[\"685:static/chunks/685-8c2a2ee442f8842a.js\",\"185:static/chunks/app/layout-4978ca41370bd554.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-98393ace57ba3968.js\"],\"name\":\"default\",\"async\":false}\nc:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-efd16f5debe934f5.js\",\"971:static/chunks/fd9d1056-9200b628bfbdc6da.js\",\"596:static/chunks/596-983"])</script><script>self.__next_f.push([1,"93ace57ba3968.js\"],\"name\":\"default\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"4:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/cf6d346f04b2f900.css\",\"precedence\":\"next\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"VCasLb-gA5eaYkvFoeITl\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/2025/12/01/Env-Vars-in-Claude-Code-Sub-Agent-Chain\",\"initialTree\":[\"\",{\"children\":[[\"id\",\"2025/12/01/Env-Vars-in-Claude-Code-Sub-Agent-Chain\",\"c\"],{\"children\":[\"__PAGE__?{\\\"id\\\":[\\\"2025\\\",\\\"12\\\",\\\"01\\\",\\\"Env-Vars-in-Claude-Code-Sub-Agent-Chain\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L7\"],\"globalErrorComponent\":\"$8\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__variable_eb9fb7 __variable_2fad4c\",\"children\":[\"$\",\"body\",null,{\"className\":\"bg-slate-200 dark:bg-slate-700\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"w-full flex flex-row justify-between items-center bg-indigo-600 shadow-indigo-300 dark:shadow-indigo-800 shadow-2xl font-sans\",\"children\":[[\"$\",\"div\",null,{\"className\":\"p-2\",\"children\":[\"$\",\"$L9\",null,{\"className\":\"text-2xl font-semibold text-neutral-100 dark:text-neutral-200\",\"href\":\"/\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"inline\",\"children\":\"üçî food for ai\"}],\" \",[\"$\",\"span\",null,{\"className\":\"font-mono font-light text-xs\",\"children\":\"food.joona.cloud\"}]]}]}],[\"$\",\"$La\",null,{\"className\":\"mr-2\"}]]}],[\"$\",\"main\",null,{\"className\":\"mt-4\",\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",[\"id\",\"2025/12/01/Env-Vars-in-Claude-Code-Sub-Agent-Chain\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Ld\",\"$Le\",null],\"segment\":\"__PAGE__?{\\\"id\\\":[\\\"2025\\\",\\\"12\\\",\\\"01\\\",\\\"Env-Vars-in-Claude-Code-Sub-Agent-Chain\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4823b726c835f640.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"id\",\"2025/12/01/Env-Vars-in-Claude-Code-Sub-Agent-Chain\",\"c\"]},\"styles\":[]}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"f:Tf8a7,"])</script><script>self.__next_f.push([1,"\u003cp\u003e\u003ca href=\"https://docs.anthropic.com/en/docs/claude-code/overview\"\u003eClaude Code\u003c/a\u003e's \u003ca href=\"https://code.claude.com/docs/en/sub-agents\"\u003esub-agent\u003c/a\u003e system is powerful for breaking down complex tasks, but there's a gap: environment variables set in a parent agent don't automatically propagate to child sub-agents. This article presents a hooks-based solution that enables environment variable inheritance across the entire agent chain.\u003c/p\u003e\n\u003ch2 id=\"the-problem\"\u003e\u003ca href=\"#the-problem\"\u003eThe Problem\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eConsider this scenario: you ask Claude Code to set an environment variable and then spawn a sub-agent, expecting the sub-agent to read that variable:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"bash\" data-theme=\"light\"\u003e\u003ccode data-language=\"bash\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eUSER:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e\"Hi! Please set env var MYSTERY to 42 and then spawn a sub-agent and ask them\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e to check what value they have in their MYSTERY env var.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"bash\" data-theme=\"dark\"\u003e\u003ccode data-language=\"bash\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eUSER:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Hi! Please set env var MYSTERY to 42 and then spawn a sub-agent and ask them\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e to check what value they have in their MYSTERY env var.\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe sub-agent won't see \u003ccode\u003eMYSTERY=42\u003c/code\u003e. Sub-agents are separate processes ‚Äî when Claude Code spawns one, it creates a new instance with a fresh environment. Variables set in the parent exist only in that parent's memory space and don't propagate to children created later.\u003c/p\u003e\n\u003cp\u003eThis creates friction in agent orchestration. Without variable inheritance, passing context and parameters to sub-agents requires either including them in downstream prompts or adding instructions to sub-agent workflows ‚Äî both of which \u003cstrong\u003ewaste inference time and tokens\u003c/strong\u003e.\u003c/p\u003e\n\u003ch2 id=\"the-solution-a-file-based-environment-stack\"\u003e\u003ca href=\"#the-solution-a-file-based-environment-stack\"\u003eThe Solution: A File-Based Environment Stack\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe key insight is to use the filesystem as a shared state mechanism, combined with Claude Code's \u003ca href=\"https://docs.claude.com/en/docs/claude-code/hooks\"\u003ehooks\u003c/a\u003e system to manage the lifecycle. Here's the high-level approach:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eA working directory\u003c/strong\u003e (\u003ccode\u003e.claude/env-vars/\u003c/code\u003e) stores environment variable files\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eA helper script\u003c/strong\u003e writes variables to the current env file\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHooks\u003c/strong\u003e manage the stack of env files and inject them into Bash commands\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eHooks are shell commands that Claude Code executes automatically at specific lifecycle events ‚Äî when the user submits a prompt, before a tool runs, or when a sub-agent completes. They can inspect and modify tool inputs, block actions, or perform side effects. This makes them ideal for injecting our environment variable logic at exactly the right moments.\u003c/p\u003e\n\u003cp\u003eThe \"stack\" is crucial for nested sub-agents. When a root agent spawns a sub-agent (level 1), which then spawns another sub-agent (level 2), we need separate env files for each level. The stack ensures that:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEach agent writes to its own file (avoiding conflicts)\u003c/li\u003e\n\u003cli\u003eAll agents see variables from parent agents (via sourcing all files in order)\u003c/li\u003e\n\u003cli\u003eWhen an agent completes, only its file is removed (preserving parent state)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"implementation\"\u003e\u003ca href=\"#implementation\"\u003eImplementation\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"directory-structure\"\u003e\u003ca href=\"#directory-structure\"\u003eDirectory Structure\u003c/a\u003e\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003eyour-project/\n  .claude/\n    settings.local.json\n    env-vars/\n      env-vars1\n      env-vars2\n      ...\n    hooks/\n      user-prompt-submit.sh\n      pre-tool-use-task.sh\n      pre-tool-use-bash.sh\n      subagent-stop.sh\n  setenv.sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"hook-configuration\"\u003e\u003ca href=\"#hook-configuration\"\u003eHook Configuration\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eIn \u003ccode\u003e.claude/settings.local.json\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"json\" data-theme=\"light\"\u003e\u003ccode data-language=\"json\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"UserPromptSubmit\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"./.claude/hooks/user-prompt-submit.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    ],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"PreToolUse\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Task\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"./.claude/hooks/pre-tool-use-task.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Bash\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"./.claude/hooks/pre-tool-use-bash.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    ],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"SubagentStop\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"./.claude/hooks/subagent-stop.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"json\" data-theme=\"dark\"\u003e\u003ccode data-language=\"json\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"UserPromptSubmit\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"./.claude/hooks/user-prompt-submit.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    ],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"PreToolUse\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Task\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"./.claude/hooks/pre-tool-use-task.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Bash\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"./.claude/hooks/pre-tool-use-bash.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    ],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"SubagentStop\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"matcher\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"hooks\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: [\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"type\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e            \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\"command\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"./.claude/hooks/subagent-stop.sh\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe hooks serve distinct purposes:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.claude.com/en/docs/claude-code/hooks#hook-events\"\u003e\u003cstrong\u003eUserPromptSubmit\u003c/strong\u003e\u003c/a\u003e: Fires when the user sends a message; we use it to reset state for new conversations\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.claude.com/en/docs/claude-code/hooks#hook-events\"\u003e\u003cstrong\u003ePreToolUse\u003c/strong\u003e\u003c/a\u003e(Task): Fires before spawning a sub-agent; we push a new env file onto the stack\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ePreToolUse\u003c/strong\u003e(Bash): Fires before every Bash command; we inject env vars by modifying the command\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.claude.com/en/docs/claude-code/hooks#hook-events\"\u003e\u003cstrong\u003eSubagentStop\u003c/strong\u003e\u003c/a\u003e: Fires when a sub-agent completes; we pop its env file from the stack\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"the-hooks\"\u003e\u003ca href=\"#the-hooks\"\u003eThe Hooks\u003c/a\u003e\u003c/h3\u003e\n\u003ch4 id=\"1-userpromptsubmit-hook---session-reset\"\u003e\u003ca href=\"#1-userpromptsubmit-hook---session-reset\"\u003e\u003cstrong\u003e1. UserPromptSubmit Hook - Session Reset\u003c/strong\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eThis hook clears the working directory when a new user prompt is submitted, ensuring a fresh start:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"bash\" data-theme=\"light\"\u003e\u003ccode data-language=\"bash\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: UserPromptSubmit - clears env-vars directory\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003erm\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-rf\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e.claude/env-vars\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"bash\" data-theme=\"dark\"\u003e\u003ccode data-language=\"bash\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: UserPromptSubmit - clears env-vars directory\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003erm\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-rf\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e.claude/env-vars\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis reset ensures that each new conversation starts with a clean slate.\u003c/p\u003e\n\u003ch4 id=\"2-pretoolusetask-hook---stack-push\"\u003e\u003ca href=\"#2-pretoolusetask-hook---stack-push\"\u003e\u003cstrong\u003e2. PreToolUse(Task) Hook - Stack Push\u003c/strong\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eWhen a sub-agent is spawned, create a new env file for that level:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"bash\" data-theme=\"light\"\u003e\u003ccode data-language=\"bash\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: PreToolUse(Task) - adds new env file for sub-agent\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Find the last env file number and create the next one\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003elast_file\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003els\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e .claude/env-vars/env-vars\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003etail\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    next_num\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    last_num\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ebasename\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\" \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esed\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e 's/env-vars//')\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    next_num\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$((last_num \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e+\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003etouch\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\".claude/env-vars/env-vars${next_num}\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"bash\" data-theme=\"dark\"\u003e\u003ccode data-language=\"bash\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: PreToolUse(Task) - adds new env file for sub-agent\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Find the last env file number and create the next one\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003elast_file\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003els\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e .claude/env-vars/env-vars\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003etail\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    next_num\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    last_num\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003ebasename\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\" \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003esed\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e 's/env-vars//')\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    next_num\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$((last_num \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e+\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003etouch\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\".claude/env-vars/env-vars${next_num}\"\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"3-pretoolusebash-hook---environment-injection\"\u003e\u003ca href=\"#3-pretoolusebash-hook---environment-injection\"\u003e\u003cstrong\u003e3. PreToolUse(Bash) Hook - Environment Injection\u003c/strong\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eThis hook prepends sourcing of all env files to \u003cem\u003eevery Bash command\u003c/em\u003e:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"bash\" data-theme=\"light\"\u003e\u003ccode data-language=\"bash\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: PreToolUse(Bash) - injects env vars into commands\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eenvvars_files\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003els\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e .claude/env-vars/env-vars\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$envvars_files\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003einput\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003ecommand\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$input\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\" \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ejq\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-r\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e '.tool_input.command // empty')\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$command\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Build source prefix for all env files\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003esource_prefix\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efor\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e envvars_file \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $envvars_files; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003edo\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    source_prefix\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"${source_prefix}set -a; source \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$envvars_file\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e; set +a; \"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003edone\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003enew_command\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"${source_prefix}${command}\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003ejq\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-n\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e--arg\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003ecmd\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$new_command\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e  \"hookSpecificOutput\": {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e    \"hookEventName\": \"PreToolUse\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e    \"permissionDecision\": \"allow\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e    \"updatedInput\": {\"command\": $cmd}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e}'\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"bash\" data-theme=\"dark\"\u003e\u003ccode data-language=\"bash\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: PreToolUse(Bash) - injects env vars into commands\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eenvvars_files\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003els\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e .claude/env-vars/env-vars\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$envvars_files\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003einput\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003ecat\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003ecommand\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$input\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\" \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003ejq\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-r\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e '.tool_input.command // empty')\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$command\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Build source prefix for all env files\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003esource_prefix\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efor\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e envvars_file \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ein\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $envvars_files; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003edo\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    source_prefix\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"${source_prefix}set -a; source \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$envvars_file\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e\\\"\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e; set +a; \"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003edone\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003enew_command\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"${source_prefix}${command}\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003ejq\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-n\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e--arg\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003ecmd\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$new_command\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e'{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e  \"hookSpecificOutput\": {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e    \"hookEventName\": \"PreToolUse\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e    \"permissionDecision\": \"allow\",\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e    \"updatedInput\": {\"command\": $cmd}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e}'\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf a child agent redefines a parent's variable, the child's value takes precedence. Since we source files in order (parent first, then children), later assignments override earlier ones.\u003c/p\u003e\n\u003ch4 id=\"4-subagentstop-hook---stack-pop\"\u003e\u003ca href=\"#4-subagentstop-hook---stack-pop\"\u003e\u003cstrong\u003e4. SubagentStop Hook - Stack Pop\u003c/strong\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eWhen a sub-agent completes, remove its env file:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"bash\" data-theme=\"light\"\u003e\u003ccode data-language=\"bash\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: SubagentStop - removes the sub-agent's env file\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003elast_file\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003els\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e .claude/env-vars/env-vars\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003etail\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-n\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003erm\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"bash\" data-theme=\"dark\"\u003e\u003ccode data-language=\"bash\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Hook: SubagentStop - removes the sub-agent's env file\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e!\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-d\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \".claude/env-vars\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e0\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003elast_file\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003els\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e .claude/env-vars/env-vars\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003etail\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-n\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003erm\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis implements a classic stack \"pop\" operation ‚Äî the last file always belongs to the most recently spawned sub-agent.\u003c/p\u003e\n\u003ch3 id=\"the-setenv-script\"\u003e\u003ca href=\"#the-setenv-script\"\u003eThe Setenv Script\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eA helper script to write variables to the current agent's env file:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"bash\" data-theme=\"light\"\u003e\u003ccode data-language=\"bash\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Sets a variable in the current agent's env file\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Usage: ./setenv.sh VAR_NAME \"value\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$#\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-lt\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Usage: \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$0\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e VAR_NAME value\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e\u003e\u0026#x26;2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003evar_name\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003evar_value\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e$2\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eSCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"$(\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003ecd\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"$(\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003edirname\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"${BASH_SOURCE[0]}\")\" \u0026#x26;\u0026#x26; \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003epwd\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e)\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003emkdir\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-p\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$SCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/.claude/env-vars\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003elast_file\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003els\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$SCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/.claude/env-vars\"/env-vars\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003etail\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    last_file\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$SCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e/.claude/env-vars/env-vars1\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003etouch\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e grep -q\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e \"^${var_name}=\" \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e/dev/null; \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esed\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e-i\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"s|^${var_name}=.*|${var_name}=${var_value}|\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"${var_name}=${var_value}\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"bash\" data-theme=\"dark\"\u003e\u003ccode data-language=\"bash\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e#!/bin/bash\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Sets a variable in the current agent's env file\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Usage: ./setenv.sh VAR_NAME \"value\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$#\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-lt\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Usage: \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$0\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e VAR_NAME value\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e\u003e\u0026#x26;2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eexit\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003evar_name\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003evar_value\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e$2\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003eSCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"$(\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003ecd\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"$(\u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003edirname\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"${BASH_SOURCE[0]}\")\" \u0026#x26;\u0026#x26; \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003epwd\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e)\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003emkdir\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-p\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$SCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/.claude/env-vars\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003elast_file\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e$(\u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003els\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$SCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/.claude/env-vars\"/env-vars\u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e2\u003e\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/dev/null \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003esort\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-V\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e|\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003etail\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-1\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e [ \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e-z\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e ]; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    last_file\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$SCRIPT_DIR\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e/.claude/env-vars/env-vars1\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003etouch\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e grep -q\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e \"^${var_name}=\" \"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e2\u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e/dev/null; \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003ethen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #B392F0\"\u003esed\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e-i\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"s|^${var_name}=.*|${var_name}=${var_value}|\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #E1E4E8\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"${var_name}=${var_value}\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #F97583\"\u003e\u003e\u003e\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e$last_file\u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #F97583\"\u003efi\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eDon't forget to make this script executable: \u003ccode\u003echmod +x ./setenv.sh\u003c/code\u003e. All hook scripts in \u003ccode\u003e.claude/hooks/\u003c/code\u003e also need execute permissions.\u003c/p\u003e\n\u003ch2 id=\"example\"\u003e\u003ca href=\"#example\"\u003eExample\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eHere's a conversation demonstrating the environment variable inheritance:\u003c/p\u003e\n\u003cdiv data-rehype-pretty-code-fragment=\"\"\u003e\u003cpre data-language=\"bash\" data-theme=\"light\"\u003e\u003ccode data-language=\"bash\" data-theme=\"light\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eUSER:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e\"Set MYSTERY to 42 using setenv.sh, then spawn a sub-agent. The sub-agent\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e should check the MYSTERY value, set ANOTHER to 67, then complete. After that,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e check if ANOTHER is still available.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eAGENT:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e\"I'll set MYSTERY and spawn a sub-agent.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e./setenv.sh\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003eMYSTERY\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e42\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e\"Now spawning a sub-agent to check MYSTERY and set ANOTHER...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eSUB-AGENT:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $MYSTERY\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003e42\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e./setenv.sh\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003eANOTHER\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e67\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $ANOTHER\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #005CC5\"\u003e67\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Task complete.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eAGENT:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e\"The sub-agent confirmed MYSTERY=42 and set ANOTHER=67. Let me check if\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e ANOTHER persists:\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $ANOTHER\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# (empty)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cpre data-language=\"bash\" data-theme=\"dark\"\u003e\u003ccode data-language=\"bash\" data-theme=\"dark\"\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eUSER:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Set MYSTERY to 42 using setenv.sh, then spawn a sub-agent. The sub-agent\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e should check the MYSTERY value, set ANOTHER to 67, then complete. After that,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e check if ANOTHER is still available.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eAGENT:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"I'll set MYSTERY and spawn a sub-agent.\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e./setenv.sh\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003eMYSTERY\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e42\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"Now spawning a sub-agent to check MYSTERY and set ANOTHER...\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eSUB-AGENT:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $MYSTERY\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003e42\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003e./setenv.sh\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003eANOTHER\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #79B8FF\"\u003e67\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $ANOTHER\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #79B8FF\"\u003e67\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Task complete.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003eAGENT:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e\"The sub-agent confirmed MYSTERY=42 and set ANOTHER=67. Let me check if\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #9ECBFF\"\u003e ANOTHER persists:\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B392F0\"\u003e$\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e \u003c/span\u003e\u003cspan style=\"color: #9ECBFF\"\u003eecho\u003c/span\u003e\u003cspan style=\"color: #E1E4E8\"\u003e $ANOTHER\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# (empty)\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs expected, \u003ccode\u003eANOTHER\u003c/code\u003e is not available. When the sub-agent completed, its env file (containing \u003ccode\u003eANOTHER=67\u003c/code\u003e) was removed by the SubagentStop hook. Only the parent's variables persist.\u003c/p\u003e\n\u003ch2 id=\"conclusion\"\u003e\u003ca href=\"#conclusion\"\u003eConclusion\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eWe achieved transparent environment variable inheritance across the agent hierarchy without modifying prompts or wasting tokens on parameter passing. The stack-based approach correctly handles nested sub-agents and ensures proper cleanup when agents complete.\u003c/p\u003e\n\u003cp\u003eNote that this solution is simplified and supports only one Claude Code session at a time.\u003c/p\u003e"])</script><script>self.__next_f.push([1,"e:[\"$\",\"div\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"md:px-10 min-w-0 max-w-7xl mb-12\",\"children\":[\"$\",\"article\",null,{\"children\":[[\"$\",\"header\",null,{\"className\":\"px-5 mb-4 py-10 relative\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-gray-100\",\"children\":\"Env Vars in Claude Code Sub-Agent Chain\"}],[\"$\",\"time\",null,{\"dateTime\":\"2025-12-01 16:00\",\"className\":\"pl-1 font-serif text-slate-400 bottom-0 absolute\",\"children\":[[\"$\",\"svg\",null,{\"className\":\"h-4 w-4 inline-block\",\"width\":\"24\",\"height\":\"24\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":\"2\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12 19l7-7 3 3-7 7-3-3z\"}],\" \",[\"$\",\"path\",null,{\"d\":\"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\"}],\" \",[\"$\",\"path\",null,{\"d\":\"M2 2l7.586 7.586\"}],\" \",[\"$\",\"circle\",null,{\"cx\":\"11\",\"cy\":\"11\",\"r\":\"2\"}]]}],\" \",\"2025-12-01 16:00\"]}]]}],[\"$\",\"div\",null,{\"className\":\"bg-slate-100 dark:bg-slate-800 p-5 pb-12 rounded shadow-lg\",\"children\":[[[\"$\",\"p\",null,{\"className\":\"italic text-slate-400 p-4\",\"dangerouslySetInnerHTML\":{\"__html\":\"This article was written based on Claude Code v2.0.55.\"}}],[\"$\",\"hr\",null,{\"className\":\"h-px my-4 bg-gray-200 border-0 dark:bg-gray-700\"}]],[\"$\",\"div\",null,{\"className\":\"space-y-4\",\"dangerouslySetInnerHTML\":{\"__html\":\"$f\"}}]]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Env Vars in Claude Code Sub-Agent Chain | Food for AI blog\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Blog about .NET, Azure, React and whatever comes to mind.\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"meta\",\"5\",{\"name\":\"next-size-adjust\"}]]\nd:null\n"])</script></body></html>